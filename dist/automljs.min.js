(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.aml=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";module.exports=asPromise;function asPromise(fn,ctx){var params=new Array(arguments.length-1),offset=0,index=2,pending=true;while(index<arguments.length)params[offset++]=arguments[index++];return new Promise(function executor(resolve,reject){params[offset]=function callback(err){if(pending){pending=false;if(err)reject(err);else{var params=new Array(arguments.length-1),offset=0;while(offset<params.length)params[offset++]=arguments[offset];resolve.apply(null,params)}}};try{fn.apply(ctx||null,params)}catch(err){if(pending){pending=false;reject(err)}}})}},{}],2:[function(require,module,exports){"use strict";var base64=exports;base64.length=function length(string){var p=string.length;if(!p)return 0;var n=0;while(--p%4>1&&string.charAt(p)==="=")++n;return Math.ceil(string.length*3)/4-n};var b64=new Array(64);var s64=new Array(123);for(var i=0;i<64;)s64[b64[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;base64.encode=function encode(buffer,start,end){var parts=null,chunk=[];var i=0,j=0,t;while(start<end){var b=buffer[start++];switch(j){case 0:chunk[i++]=b64[b>>2];t=(b&3)<<4;j=1;break;case 1:chunk[i++]=b64[t|b>>4];t=(b&15)<<2;j=2;break;case 2:chunk[i++]=b64[t|b>>6];chunk[i++]=b64[b&63];j=0;break}if(i>8191){(parts||(parts=[])).push(String.fromCharCode.apply(String,chunk));i=0}}if(j){chunk[i++]=b64[t];chunk[i++]=61;if(j===1)chunk[i++]=61}if(parts){if(i)parts.push(String.fromCharCode.apply(String,chunk.slice(0,i)));return parts.join("")}return String.fromCharCode.apply(String,chunk.slice(0,i))};var invalidEncoding="invalid encoding";base64.decode=function decode(string,buffer,offset){var start=offset;var j=0,t;for(var i=0;i<string.length;){var c=string.charCodeAt(i++);if(c===61&&j>1)break;if((c=s64[c])===undefined)throw Error(invalidEncoding);switch(j){case 0:t=c;j=1;break;case 1:buffer[offset++]=t<<2|(c&48)>>4;t=c;j=2;break;case 2:buffer[offset++]=(t&15)<<4|(c&60)>>2;t=c;j=3;break;case 3:buffer[offset++]=(t&3)<<6|c;j=0;break}}if(j===1)throw Error(invalidEncoding);return offset-start};base64.test=function test(string){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(string)}},{}],3:[function(require,module,exports){"use strict";module.exports=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function on(evt,fn,ctx){(this._listeners[evt]||(this._listeners[evt]=[])).push({fn:fn,ctx:ctx||this});return this};EventEmitter.prototype.off=function off(evt,fn){if(evt===undefined)this._listeners={};else{if(fn===undefined)this._listeners[evt]=[];else{var listeners=this._listeners[evt];for(var i=0;i<listeners.length;)if(listeners[i].fn===fn)listeners.splice(i,1);else++i}}return this};EventEmitter.prototype.emit=function emit(evt){var listeners=this._listeners[evt];if(listeners){var args=[],i=1;for(;i<arguments.length;)args.push(arguments[i++]);for(i=0;i<listeners.length;)listeners[i].fn.apply(listeners[i++].ctx,args)}return this}},{}],4:[function(require,module,exports){"use strict";module.exports=factory(factory);function factory(exports){if(typeof Float32Array!=="undefined")(function(){var f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer),le=f8b[3]===128;function writeFloat_f32_cpy(val,buf,pos){f32[0]=val;buf[pos]=f8b[0];buf[pos+1]=f8b[1];buf[pos+2]=f8b[2];buf[pos+3]=f8b[3]}function writeFloat_f32_rev(val,buf,pos){f32[0]=val;buf[pos]=f8b[3];buf[pos+1]=f8b[2];buf[pos+2]=f8b[1];buf[pos+3]=f8b[0]}exports.writeFloatLE=le?writeFloat_f32_cpy:writeFloat_f32_rev;exports.writeFloatBE=le?writeFloat_f32_rev:writeFloat_f32_cpy;function readFloat_f32_cpy(buf,pos){f8b[0]=buf[pos];f8b[1]=buf[pos+1];f8b[2]=buf[pos+2];f8b[3]=buf[pos+3];return f32[0]}function readFloat_f32_rev(buf,pos){f8b[3]=buf[pos];f8b[2]=buf[pos+1];f8b[1]=buf[pos+2];f8b[0]=buf[pos+3];return f32[0]}exports.readFloatLE=le?readFloat_f32_cpy:readFloat_f32_rev;exports.readFloatBE=le?readFloat_f32_rev:readFloat_f32_cpy})();else(function(){function writeFloat_ieee754(writeUint,val,buf,pos){var sign=val<0?1:0;if(sign)val=-val;if(val===0)writeUint(1/val>0?0:2147483648,buf,pos);else if(isNaN(val))writeUint(2143289344,buf,pos);else if(val>3.4028234663852886e38)writeUint((sign<<31|2139095040)>>>0,buf,pos);else if(val<1.1754943508222875e-38)writeUint((sign<<31|Math.round(val/1.401298464324817e-45))>>>0,buf,pos);else{var exponent=Math.floor(Math.log(val)/Math.LN2),mantissa=Math.round(val*Math.pow(2,-exponent)*8388608)&8388607;writeUint((sign<<31|exponent+127<<23|mantissa)>>>0,buf,pos)}}exports.writeFloatLE=writeFloat_ieee754.bind(null,writeUintLE);exports.writeFloatBE=writeFloat_ieee754.bind(null,writeUintBE);function readFloat_ieee754(readUint,buf,pos){var uint=readUint(buf,pos),sign=(uint>>31)*2+1,exponent=uint>>>23&255,mantissa=uint&8388607;return exponent===255?mantissa?NaN:sign*Infinity:exponent===0?sign*1.401298464324817e-45*mantissa:sign*Math.pow(2,exponent-150)*(mantissa+8388608)}exports.readFloatLE=readFloat_ieee754.bind(null,readUintLE);exports.readFloatBE=readFloat_ieee754.bind(null,readUintBE)})();if(typeof Float64Array!=="undefined")(function(){var f64=new Float64Array([-0]),f8b=new Uint8Array(f64.buffer),le=f8b[7]===128;function writeDouble_f64_cpy(val,buf,pos){f64[0]=val;buf[pos]=f8b[0];buf[pos+1]=f8b[1];buf[pos+2]=f8b[2];buf[pos+3]=f8b[3];buf[pos+4]=f8b[4];buf[pos+5]=f8b[5];buf[pos+6]=f8b[6];buf[pos+7]=f8b[7]}function writeDouble_f64_rev(val,buf,pos){f64[0]=val;buf[pos]=f8b[7];buf[pos+1]=f8b[6];buf[pos+2]=f8b[5];buf[pos+3]=f8b[4];buf[pos+4]=f8b[3];buf[pos+5]=f8b[2];buf[pos+6]=f8b[1];buf[pos+7]=f8b[0]}exports.writeDoubleLE=le?writeDouble_f64_cpy:writeDouble_f64_rev;exports.writeDoubleBE=le?writeDouble_f64_rev:writeDouble_f64_cpy;function readDouble_f64_cpy(buf,pos){f8b[0]=buf[pos];f8b[1]=buf[pos+1];f8b[2]=buf[pos+2];f8b[3]=buf[pos+3];f8b[4]=buf[pos+4];f8b[5]=buf[pos+5];f8b[6]=buf[pos+6];f8b[7]=buf[pos+7];return f64[0]}function readDouble_f64_rev(buf,pos){f8b[7]=buf[pos];f8b[6]=buf[pos+1];f8b[5]=buf[pos+2];f8b[4]=buf[pos+3];f8b[3]=buf[pos+4];f8b[2]=buf[pos+5];f8b[1]=buf[pos+6];f8b[0]=buf[pos+7];return f64[0]}exports.readDoubleLE=le?readDouble_f64_cpy:readDouble_f64_rev;exports.readDoubleBE=le?readDouble_f64_rev:readDouble_f64_cpy})();else(function(){function writeDouble_ieee754(writeUint,off0,off1,val,buf,pos){var sign=val<0?1:0;if(sign)val=-val;if(val===0){writeUint(0,buf,pos+off0);writeUint(1/val>0?0:2147483648,buf,pos+off1)}else if(isNaN(val)){writeUint(0,buf,pos+off0);writeUint(2146959360,buf,pos+off1)}else if(val>1.7976931348623157e308){writeUint(0,buf,pos+off0);writeUint((sign<<31|2146435072)>>>0,buf,pos+off1)}else{var mantissa;if(val<2.2250738585072014e-308){mantissa=val/5e-324;writeUint(mantissa>>>0,buf,pos+off0);writeUint((sign<<31|mantissa/4294967296)>>>0,buf,pos+off1)}else{var exponent=Math.floor(Math.log(val)/Math.LN2);if(exponent===1024)exponent=1023;mantissa=val*Math.pow(2,-exponent);writeUint(mantissa*4503599627370496>>>0,buf,pos+off0);writeUint((sign<<31|exponent+1023<<20|mantissa*1048576&1048575)>>>0,buf,pos+off1)}}}exports.writeDoubleLE=writeDouble_ieee754.bind(null,writeUintLE,0,4);exports.writeDoubleBE=writeDouble_ieee754.bind(null,writeUintBE,4,0);function readDouble_ieee754(readUint,off0,off1,buf,pos){var lo=readUint(buf,pos+off0),hi=readUint(buf,pos+off1);var sign=(hi>>31)*2+1,exponent=hi>>>20&2047,mantissa=4294967296*(hi&1048575)+lo;return exponent===2047?mantissa?NaN:sign*Infinity:exponent===0?sign*5e-324*mantissa:sign*Math.pow(2,exponent-1075)*(mantissa+4503599627370496)}exports.readDoubleLE=readDouble_ieee754.bind(null,readUintLE,0,4);exports.readDoubleBE=readDouble_ieee754.bind(null,readUintBE,4,0)})();return exports}function writeUintLE(val,buf,pos){buf[pos]=val&255;buf[pos+1]=val>>>8&255;buf[pos+2]=val>>>16&255;buf[pos+3]=val>>>24}function writeUintBE(val,buf,pos){buf[pos]=val>>>24;buf[pos+1]=val>>>16&255;buf[pos+2]=val>>>8&255;buf[pos+3]=val&255}function readUintLE(buf,pos){return(buf[pos]|buf[pos+1]<<8|buf[pos+2]<<16|buf[pos+3]<<24)>>>0}function readUintBE(buf,pos){return(buf[pos]<<24|buf[pos+1]<<16|buf[pos+2]<<8|buf[pos+3])>>>0}},{}],5:[function(require,module,exports){"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}},{}],6:[function(require,module,exports){"use strict";module.exports=pool;function pool(alloc,slice,size){var SIZE=size||8192;var MAX=SIZE>>>1;var slab=null;var offset=SIZE;return function pool_alloc(size){if(size<1||size>MAX)return alloc(size);if(offset+size>SIZE){slab=alloc(SIZE);offset=0}var buf=slice.call(slab,offset,offset+=size);if(offset&7)offset=(offset|7)+1;return buf}}},{}],7:[function(require,module,exports){"use strict";var utf8=exports;utf8.length=function utf8_length(string){var len=0,c=0;for(var i=0;i<string.length;++i){c=string.charCodeAt(i);if(c<128)len+=1;else if(c<2048)len+=2;else if((c&64512)===55296&&(string.charCodeAt(i+1)&64512)===56320){++i;len+=4}else len+=3}return len};utf8.read=function utf8_read(buffer,start,end){var len=end-start;if(len<1)return"";var parts=null,chunk=[],i=0,t;while(start<end){t=buffer[start++];if(t<128)chunk[i++]=t;else if(t>191&&t<224)chunk[i++]=(t&31)<<6|buffer[start++]&63;else if(t>239&&t<365){t=((t&7)<<18|(buffer[start++]&63)<<12|(buffer[start++]&63)<<6|buffer[start++]&63)-65536;chunk[i++]=55296+(t>>10);chunk[i++]=56320+(t&1023)}else chunk[i++]=(t&15)<<12|(buffer[start++]&63)<<6|buffer[start++]&63;if(i>8191){(parts||(parts=[])).push(String.fromCharCode.apply(String,chunk));i=0}}if(parts){if(i)parts.push(String.fromCharCode.apply(String,chunk.slice(0,i)));return parts.join("")}return String.fromCharCode.apply(String,chunk.slice(0,i))};utf8.write=function utf8_write(string,buffer,offset){var start=offset,c1,c2;for(var i=0;i<string.length;++i){c1=string.charCodeAt(i);if(c1<128){buffer[offset++]=c1}else if(c1<2048){buffer[offset++]=c1>>6|192;buffer[offset++]=c1&63|128}else if((c1&64512)===55296&&((c2=string.charCodeAt(i+1))&64512)===56320){c1=65536+((c1&1023)<<10)+(c2&1023);++i;buffer[offset++]=c1>>18|240;buffer[offset++]=c1>>12&63|128;buffer[offset++]=c1>>6&63|128;buffer[offset++]=c1&63|128}else{buffer[offset++]=c1>>12|224;buffer[offset++]=c1>>6&63|128;buffer[offset++]=c1&63|128}}return offset-start}},{}],8:[function(require,module,exports){"use strict";var $protobuf=require("protobufjs/minimal");var $Reader=$protobuf.Reader,$util=$protobuf.util;var $root=$protobuf.roots["default"]||($protobuf.roots["default"]={});$root.tensorflow=function(){var tensorflow={};tensorflow.Any=function(){function Any(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}Any.prototype.typeUrl="";Any.prototype.value=$util.newBuffer([]);Any.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.Any;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.typeUrl=r.string();break;case 2:m.value=r.bytes();break;default:r.skipType(t&7);break}}return m};return Any}();tensorflow.DataType=function(){var valuesById={},values=Object.create(valuesById);values[valuesById[0]="DT_INVALID"]=0;values[valuesById[1]="DT_FLOAT"]=1;values[valuesById[2]="DT_DOUBLE"]=2;values[valuesById[3]="DT_INT32"]=3;values[valuesById[4]="DT_UINT8"]=4;values[valuesById[5]="DT_INT16"]=5;values[valuesById[6]="DT_INT8"]=6;values[valuesById[7]="DT_STRING"]=7;values[valuesById[8]="DT_COMPLEX64"]=8;values[valuesById[9]="DT_INT64"]=9;values[valuesById[10]="DT_BOOL"]=10;values[valuesById[11]="DT_QINT8"]=11;values[valuesById[12]="DT_QUINT8"]=12;values[valuesById[13]="DT_QINT32"]=13;values[valuesById[14]="DT_BFLOAT16"]=14;values[valuesById[101]="DT_FLOAT_REF"]=101;values[valuesById[102]="DT_DOUBLE_REF"]=102;values[valuesById[103]="DT_INT32_REF"]=103;values[valuesById[104]="DT_UINT8_REF"]=104;values[valuesById[105]="DT_INT16_REF"]=105;values[valuesById[106]="DT_INT8_REF"]=106;values[valuesById[107]="DT_STRING_REF"]=107;values[valuesById[108]="DT_COMPLEX64_REF"]=108;values[valuesById[109]="DT_INT64_REF"]=109;values[valuesById[110]="DT_BOOL_REF"]=110;values[valuesById[111]="DT_QINT8_REF"]=111;values[valuesById[112]="DT_QUINT8_REF"]=112;values[valuesById[113]="DT_QINT32_REF"]=113;values[valuesById[114]="DT_BFLOAT16_REF"]=114;return values}();tensorflow.TensorShape=function(){function TensorShape(p){this.dim=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}TensorShape.prototype.dim=$util.emptyArray;TensorShape.prototype.unknownRank=false;TensorShape.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.TensorShape;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 2:if(!(m.dim&&m.dim.length))m.dim=[];m.dim.push($root.tensorflow.TensorShape.Dim.decode(r,r.uint32()));break;case 3:m.unknownRank=r.bool();break;default:r.skipType(t&7);break}}return m};TensorShape.Dim=function(){function Dim(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}Dim.prototype.size=$util.Long?$util.Long.fromBits(0,0,false):0;Dim.prototype.name="";Dim.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.TensorShape.Dim;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.size=r.int64();break;case 2:m.name=r.string();break;default:r.skipType(t&7);break}}return m};return Dim}();return TensorShape}();tensorflow.Tensor=function(){function Tensor(p){this.floatVal=[];this.doubleVal=[];this.intVal=[];this.stringVal=[];this.scomplexVal=[];this.int64Val=[];this.boolVal=[];this.uint32Val=[];this.uint64Val=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}Tensor.prototype.dtype=0;Tensor.prototype.tensorShape=null;Tensor.prototype.versionNumber=0;Tensor.prototype.tensorContent=$util.newBuffer([]);Tensor.prototype.floatVal=$util.emptyArray;Tensor.prototype.doubleVal=$util.emptyArray;Tensor.prototype.intVal=$util.emptyArray;Tensor.prototype.stringVal=$util.emptyArray;Tensor.prototype.scomplexVal=$util.emptyArray;Tensor.prototype.int64Val=$util.emptyArray;Tensor.prototype.boolVal=$util.emptyArray;Tensor.prototype.uint32Val=$util.emptyArray;Tensor.prototype.uint64Val=$util.emptyArray;Tensor.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.Tensor;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.dtype=r.int32();break;case 2:m.tensorShape=$root.tensorflow.TensorShape.decode(r,r.uint32());break;case 3:m.versionNumber=r.int32();break;case 4:m.tensorContent=r.bytes();break;case 5:if(!(m.floatVal&&m.floatVal.length))m.floatVal=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.floatVal.push(r.float())}else m.floatVal.push(r.float());break;case 6:if(!(m.doubleVal&&m.doubleVal.length))m.doubleVal=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.doubleVal.push(r.double())}else m.doubleVal.push(r.double());break;case 7:if(!(m.intVal&&m.intVal.length))m.intVal=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.intVal.push(r.int32())}else m.intVal.push(r.int32());break;case 8:if(!(m.stringVal&&m.stringVal.length))m.stringVal=[];m.stringVal.push(r.bytes());break;case 9:if(!(m.scomplexVal&&m.scomplexVal.length))m.scomplexVal=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.scomplexVal.push(r.float())}else m.scomplexVal.push(r.float());break;case 10:if(!(m.int64Val&&m.int64Val.length))m.int64Val=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.int64Val.push(r.int64())}else m.int64Val.push(r.int64());break;case 11:if(!(m.boolVal&&m.boolVal.length))m.boolVal=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.boolVal.push(r.bool())}else m.boolVal.push(r.bool());break;case 16:if(!(m.uint32Val&&m.uint32Val.length))m.uint32Val=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.uint32Val.push(r.uint32())}else m.uint32Val.push(r.uint32());break;case 17:if(!(m.uint64Val&&m.uint64Val.length))m.uint64Val=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.uint64Val.push(r.uint64())}else m.uint64Val.push(r.uint64());break;default:r.skipType(t&7);break}}return m};return Tensor}();tensorflow.AttrValue=function(){function AttrValue(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}AttrValue.prototype.list=null;AttrValue.prototype.s=$util.newBuffer([]);AttrValue.prototype.i=$util.Long?$util.Long.fromBits(0,0,false):0;AttrValue.prototype.f=0;AttrValue.prototype.b=false;AttrValue.prototype.type=0;AttrValue.prototype.shape=null;AttrValue.prototype.tensor=null;AttrValue.prototype.placeholder="";AttrValue.prototype.func=null;var $oneOfFields;Object.defineProperty(AttrValue.prototype,"value",{get:$util.oneOfGetter($oneOfFields=["list","s","i","f","b","type","shape","tensor","placeholder","func"]),set:$util.oneOfSetter($oneOfFields)});AttrValue.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.AttrValue;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.list=$root.tensorflow.AttrValue.ListValue.decode(r,r.uint32());break;case 2:m.s=r.bytes();break;case 3:m.i=r.int64();break;case 4:m.f=r.float();break;case 5:m.b=r.bool();break;case 6:m.type=r.int32();break;case 7:m.shape=$root.tensorflow.TensorShape.decode(r,r.uint32());break;case 8:m.tensor=$root.tensorflow.Tensor.decode(r,r.uint32());break;case 9:m.placeholder=r.string();break;case 10:m.func=$root.tensorflow.NameAttrList.decode(r,r.uint32());break;default:r.skipType(t&7);break}}return m};AttrValue.ListValue=function(){function ListValue(p){this.s=[];this.i=[];this.f=[];this.b=[];this.type=[];this.shape=[];this.tensor=[];this.func=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}ListValue.prototype.s=$util.emptyArray;ListValue.prototype.i=$util.emptyArray;ListValue.prototype.f=$util.emptyArray;ListValue.prototype.b=$util.emptyArray;ListValue.prototype.type=$util.emptyArray;ListValue.prototype.shape=$util.emptyArray;ListValue.prototype.tensor=$util.emptyArray;ListValue.prototype.func=$util.emptyArray;ListValue.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.AttrValue.ListValue;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 2:if(!(m.s&&m.s.length))m.s=[];m.s.push(r.bytes());break;case 3:if(!(m.i&&m.i.length))m.i=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.i.push(r.int64())}else m.i.push(r.int64());break;case 4:if(!(m.f&&m.f.length))m.f=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.f.push(r.float())}else m.f.push(r.float());break;case 5:if(!(m.b&&m.b.length))m.b=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.b.push(r.bool())}else m.b.push(r.bool());break;case 6:if(!(m.type&&m.type.length))m.type=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.type.push(r.int32())}else m.type.push(r.int32());break;case 7:if(!(m.shape&&m.shape.length))m.shape=[];m.shape.push($root.tensorflow.TensorShape.decode(r,r.uint32()));break;case 8:if(!(m.tensor&&m.tensor.length))m.tensor=[];m.tensor.push($root.tensorflow.Tensor.decode(r,r.uint32()));break;case 9:if(!(m.func&&m.func.length))m.func=[];m.func.push($root.tensorflow.NameAttrList.decode(r,r.uint32()));break;default:r.skipType(t&7);break}}return m};return ListValue}();return AttrValue}();tensorflow.NameAttrList=function(){function NameAttrList(p){this.attr={};if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}NameAttrList.prototype.name="";NameAttrList.prototype.attr=$util.emptyObject;NameAttrList.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.NameAttrList,k;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:r.skip().pos++;if(m.attr===$util.emptyObject)m.attr={};k=r.string();r.pos++;m.attr[k]=$root.tensorflow.AttrValue.decode(r,r.uint32());break;default:r.skipType(t&7);break}}return m};return NameAttrList}();tensorflow.NodeDef=function(){function NodeDef(p){this.input=[];this.attr={};if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}NodeDef.prototype.name="";NodeDef.prototype.op="";NodeDef.prototype.input=$util.emptyArray;NodeDef.prototype.device="";NodeDef.prototype.attr=$util.emptyObject;NodeDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.NodeDef,k;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:m.op=r.string();break;case 3:if(!(m.input&&m.input.length))m.input=[];m.input.push(r.string());break;case 4:m.device=r.string();break;case 5:r.skip().pos++;if(m.attr===$util.emptyObject)m.attr={};k=r.string();r.pos++;m.attr[k]=$root.tensorflow.AttrValue.decode(r,r.uint32());break;default:r.skipType(t&7);break}}return m};return NodeDef}();tensorflow.VersionDef=function(){function VersionDef(p){this.badConsumers=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}VersionDef.prototype.producer=0;VersionDef.prototype.minConsumer=0;VersionDef.prototype.badConsumers=$util.emptyArray;VersionDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.VersionDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.producer=r.int32();break;case 2:m.minConsumer=r.int32();break;case 3:if(!(m.badConsumers&&m.badConsumers.length))m.badConsumers=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.badConsumers.push(r.int32())}else m.badConsumers.push(r.int32());break;default:r.skipType(t&7);break}}return m};return VersionDef}();tensorflow.GraphDef=function(){function GraphDef(p){this.node=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}GraphDef.prototype.node=$util.emptyArray;GraphDef.prototype.versions=null;GraphDef.prototype.library=null;GraphDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.GraphDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m.node&&m.node.length))m.node=[];m.node.push($root.tensorflow.NodeDef.decode(r,r.uint32()));break;case 4:m.versions=$root.tensorflow.VersionDef.decode(r,r.uint32());break;case 2:m.library=$root.tensorflow.FunctionDefLibrary.decode(r,r.uint32());break;default:r.skipType(t&7);break}}return m};return GraphDef}();tensorflow.CollectionDef=function(){function CollectionDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}CollectionDef.prototype.nodeList=null;CollectionDef.prototype.bytesList=null;CollectionDef.prototype.int64List=null;CollectionDef.prototype.floatList=null;CollectionDef.prototype.anyList=null;var $oneOfFields;Object.defineProperty(CollectionDef.prototype,"kind",{get:$util.oneOfGetter($oneOfFields=["nodeList","bytesList","int64List","floatList","anyList"]),set:$util.oneOfSetter($oneOfFields)});CollectionDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.nodeList=$root.tensorflow.CollectionDef.NodeList.decode(r,r.uint32());break;case 2:m.bytesList=$root.tensorflow.CollectionDef.BytesList.decode(r,r.uint32());break;case 3:m.int64List=$root.tensorflow.CollectionDef.Int64List.decode(r,r.uint32());break;case 4:m.floatList=$root.tensorflow.CollectionDef.FloatList.decode(r,r.uint32());break;case 5:m.anyList=$root.tensorflow.CollectionDef.AnyList.decode(r,r.uint32());break;default:r.skipType(t&7);break}}return m};CollectionDef.NodeList=function(){function NodeList(p){this.value=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}NodeList.prototype.value=$util.emptyArray;NodeList.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.NodeList;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m.value&&m.value.length))m.value=[];m.value.push(r.string());break;default:r.skipType(t&7);break}}return m};return NodeList}();CollectionDef.BytesList=function(){function BytesList(p){this.value=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}BytesList.prototype.value=$util.emptyArray;BytesList.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.BytesList;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m.value&&m.value.length))m.value=[];m.value.push(r.bytes());break;default:r.skipType(t&7);break}}return m};return BytesList}();CollectionDef.Int64List=function(){function Int64List(p){this.value=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}Int64List.prototype.value=$util.emptyArray;Int64List.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.Int64List;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m.value&&m.value.length))m.value=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.value.push(r.int64())}else m.value.push(r.int64());break;default:r.skipType(t&7);break}}return m};return Int64List}();CollectionDef.FloatList=function(){function FloatList(p){this.value=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}FloatList.prototype.value=$util.emptyArray;FloatList.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.FloatList;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m.value&&m.value.length))m.value=[];if((t&7)===2){var c2=r.uint32()+r.pos;while(r.pos<c2)m.value.push(r.float())}else m.value.push(r.float());break;default:r.skipType(t&7);break}}return m};return FloatList}();CollectionDef.AnyList=function(){function AnyList(p){this.value=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}AnyList.prototype.value=$util.emptyArray;AnyList.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.AnyList;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m.value&&m.value.length))m.value=[];m.value.push($root.tensorflow.Any.decode(r,r.uint32()));break;default:r.skipType(t&7);break}}return m};return AnyList}();return CollectionDef}();tensorflow.SaverDef=function(){function SaverDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}SaverDef.prototype.filenameTensorName="";SaverDef.prototype.saveTensorName="";SaverDef.prototype.restoreOpName="";SaverDef.prototype.maxToKeep=0;SaverDef.prototype.sharded=false;SaverDef.prototype.keepCheckpointEveryNHours=0;SaverDef.prototype.version=0;SaverDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.SaverDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.filenameTensorName=r.string();break;case 2:m.saveTensorName=r.string();break;case 3:m.restoreOpName=r.string();break;case 4:m.maxToKeep=r.int32();break;case 5:m.sharded=r.bool();break;case 6:m.keepCheckpointEveryNHours=r.float();break;case 7:m.version=r.int32();break;default:r.skipType(t&7);break}}return m};SaverDef.CheckpointFormatVersion=function(){var valuesById={},values=Object.create(valuesById);values[valuesById[0]="LEGACY"]=0;values[valuesById[1]="V1"]=1;values[valuesById[2]="V2"]=2;return values}();return SaverDef}();tensorflow.TensorInfo=function(){function TensorInfo(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}TensorInfo.prototype.name="";TensorInfo.prototype.cooSparse=null;TensorInfo.prototype.dtype=0;TensorInfo.prototype.tensorShape=null;var $oneOfFields;Object.defineProperty(TensorInfo.prototype,"encoding",{get:$util.oneOfGetter($oneOfFields=["name","cooSparse"]),set:$util.oneOfSetter($oneOfFields)});TensorInfo.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.TensorInfo;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 4:m.cooSparse=$root.tensorflow.TensorInfo.CooSparse.decode(r,r.uint32());break;case 2:m.dtype=r.int32();break;case 3:m.tensorShape=$root.tensorflow.TensorShape.decode(r,r.uint32());break;default:r.skipType(t&7);break}}return m};TensorInfo.CooSparse=function(){function CooSparse(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}CooSparse.prototype.valuesTensorName="";CooSparse.prototype.indicesTensorName="";CooSparse.prototype.denseShapeTensorName="";CooSparse.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.TensorInfo.CooSparse;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.valuesTensorName=r.string();break;case 2:m.indicesTensorName=r.string();break;case 3:m.denseShapeTensorName=r.string();break;default:r.skipType(t&7);break}}return m};return CooSparse}();return TensorInfo}();tensorflow.SignatureDef=function(){function SignatureDef(p){this.inputs={};this.outputs={};if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}SignatureDef.prototype.inputs=$util.emptyObject;SignatureDef.prototype.outputs=$util.emptyObject;SignatureDef.prototype.methodName="";SignatureDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.SignatureDef,k;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:r.skip().pos++;if(m.inputs===$util.emptyObject)m.inputs={};k=r.string();r.pos++;m.inputs[k]=$root.tensorflow.TensorInfo.decode(r,r.uint32());break;case 2:r.skip().pos++;if(m.outputs===$util.emptyObject)m.outputs={};k=r.string();r.pos++;m.outputs[k]=$root.tensorflow.TensorInfo.decode(r,r.uint32());break;case 3:m.methodName=r.string();break;default:r.skipType(t&7);break}}return m};return SignatureDef}();tensorflow.AssetFileDef=function(){function AssetFileDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}AssetFileDef.prototype.tensorInfo=null;AssetFileDef.prototype.filename="";AssetFileDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.AssetFileDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.tensorInfo=$root.tensorflow.TensorInfo.decode(r,r.uint32());break;case 2:m.filename=r.string();break;default:r.skipType(t&7);break}}return m};return AssetFileDef}();tensorflow.OpDef=function(){function OpDef(p){this.inputArg=[];this.outputArg=[];this.attr=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}OpDef.prototype.name="";OpDef.prototype.inputArg=$util.emptyArray;OpDef.prototype.outputArg=$util.emptyArray;OpDef.prototype.attr=$util.emptyArray;OpDef.prototype.deprecation=null;OpDef.prototype.summary="";OpDef.prototype.description="";OpDef.prototype.isCommutative=false;OpDef.prototype.isAggregate=false;OpDef.prototype.isStateful=false;OpDef.prototype.allowsUninitializedInput=false;OpDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.OpDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:if(!(m.inputArg&&m.inputArg.length))m.inputArg=[];m.inputArg.push($root.tensorflow.OpDef.ArgDef.decode(r,r.uint32()));break;case 3:if(!(m.outputArg&&m.outputArg.length))m.outputArg=[];m.outputArg.push($root.tensorflow.OpDef.ArgDef.decode(r,r.uint32()));break;case 4:if(!(m.attr&&m.attr.length))m.attr=[];m.attr.push($root.tensorflow.OpDef.AttrDef.decode(r,r.uint32()));break;case 8:m.deprecation=$root.tensorflow.OpDef.OpDeprecation.decode(r,r.uint32());break;case 5:m.summary=r.string();break;case 6:m.description=r.string();break;case 18:m.isCommutative=r.bool();break;case 16:m.isAggregate=r.bool();break;case 17:m.isStateful=r.bool();break;case 19:m.allowsUninitializedInput=r.bool();break;default:r.skipType(t&7);break}}return m};OpDef.ArgDef=function(){function ArgDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}ArgDef.prototype.name="";ArgDef.prototype.description="";ArgDef.prototype.type=0;ArgDef.prototype.typeAttr="";ArgDef.prototype.numberAttr="";ArgDef.prototype.typeListAttr="";ArgDef.prototype.isRef=false;ArgDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.OpDef.ArgDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:m.description=r.string();break;case 3:m.type=r.int32();break;case 4:m.typeAttr=r.string();break;case 5:m.numberAttr=r.string();break;case 6:m.typeListAttr=r.string();break;case 16:m.isRef=r.bool();break;default:r.skipType(t&7);break}}return m};return ArgDef}();OpDef.AttrDef=function(){function AttrDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}AttrDef.prototype.name="";AttrDef.prototype.type="";AttrDef.prototype.defaultValue=null;AttrDef.prototype.description="";AttrDef.prototype.hasMinimum=false;AttrDef.prototype.minimum=$util.Long?$util.Long.fromBits(0,0,false):0;AttrDef.prototype.allowedValues=null;AttrDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.OpDef.AttrDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:m.type=r.string();break;case 3:m.defaultValue=$root.tensorflow.AttrValue.decode(r,r.uint32());break;case 4:m.description=r.string();break;case 5:m.hasMinimum=r.bool();break;case 6:m.minimum=r.int64();break;case 7:m.allowedValues=$root.tensorflow.AttrValue.decode(r,r.uint32());break;default:r.skipType(t&7);break}}return m};return AttrDef}();OpDef.OpDeprecation=function(){function OpDeprecation(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}OpDeprecation.prototype.version=0;OpDeprecation.prototype.explanation="";OpDeprecation.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.OpDef.OpDeprecation;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.version=r.int32();break;case 2:m.explanation=r.string();break;default:r.skipType(t&7);break}}return m};return OpDeprecation}();return OpDef}();tensorflow.OpList=function(){function OpList(p){this.op=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}OpList.prototype.op=$util.emptyArray;OpList.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.OpList;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m.op&&m.op.length))m.op=[];m.op.push($root.tensorflow.OpDef.decode(r,r.uint32()));break;default:r.skipType(t&7);break}}return m};return OpList}();tensorflow.MetaGraphDef=function(){function MetaGraphDef(p){this.collectionDef={};this.signatureDef={};this.assetFileDef=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}MetaGraphDef.prototype.metaInfoDef=null;MetaGraphDef.prototype.graphDef=null;MetaGraphDef.prototype.saverDef=null;MetaGraphDef.prototype.collectionDef=$util.emptyObject;MetaGraphDef.prototype.signatureDef=$util.emptyObject;MetaGraphDef.prototype.assetFileDef=$util.emptyArray;MetaGraphDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.MetaGraphDef,k;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.metaInfoDef=$root.tensorflow.MetaGraphDef.MetaInfoDef.decode(r,r.uint32());break;case 2:m.graphDef=$root.tensorflow.GraphDef.decode(r,r.uint32());break;case 3:m.saverDef=$root.tensorflow.SaverDef.decode(r,r.uint32());break;case 4:r.skip().pos++;if(m.collectionDef===$util.emptyObject)m.collectionDef={};k=r.string();r.pos++;m.collectionDef[k]=$root.tensorflow.CollectionDef.decode(r,r.uint32());break;case 5:r.skip().pos++;if(m.signatureDef===$util.emptyObject)m.signatureDef={};k=r.string();r.pos++;m.signatureDef[k]=$root.tensorflow.SignatureDef.decode(r,r.uint32());break;case 6:if(!(m.assetFileDef&&m.assetFileDef.length))m.assetFileDef=[];m.assetFileDef.push($root.tensorflow.AssetFileDef.decode(r,r.uint32()));break;default:r.skipType(t&7);break}}return m};MetaGraphDef.MetaInfoDef=function(){function MetaInfoDef(p){this.tags=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}MetaInfoDef.prototype.metaGraphVersion="";MetaInfoDef.prototype.strippedOpList=null;MetaInfoDef.prototype.anyInfo=null;MetaInfoDef.prototype.tags=$util.emptyArray;MetaInfoDef.prototype.tensorflowVersion="";MetaInfoDef.prototype.tensorflowGitVersion="";MetaInfoDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.MetaGraphDef.MetaInfoDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.metaGraphVersion=r.string();break;case 2:m.strippedOpList=$root.tensorflow.OpList.decode(r,r.uint32());break;case 3:m.anyInfo=$root.tensorflow.Any.decode(r,r.uint32());break;case 4:if(!(m.tags&&m.tags.length))m.tags=[];m.tags.push(r.string());break;case 5:m.tensorflowVersion=r.string();break;case 6:m.tensorflowGitVersion=r.string();break;default:r.skipType(t&7);break}}return m};return MetaInfoDef}();return MetaGraphDef}();tensorflow.SavedModel=function(){function SavedModel(p){this.metaGraphs=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}SavedModel.prototype.savedModelSchemaVersion=$util.Long?$util.Long.fromBits(0,0,false):0;SavedModel.prototype.metaGraphs=$util.emptyArray;SavedModel.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.SavedModel;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.savedModelSchemaVersion=r.int64();break;case 2:if(!(m.metaGraphs&&m.metaGraphs.length))m.metaGraphs=[];m.metaGraphs.push($root.tensorflow.MetaGraphDef.decode(r,r.uint32()));break;default:r.skipType(t&7);break}}return m};return SavedModel}();tensorflow.FunctionDefLibrary=function(){function FunctionDefLibrary(p){this["function"]=[];this.gradient=[];if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}FunctionDefLibrary.prototype["function"]=$util.emptyArray;FunctionDefLibrary.prototype.gradient=$util.emptyArray;FunctionDefLibrary.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.FunctionDefLibrary;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:if(!(m["function"]&&m["function"].length))m["function"]=[];m["function"].push($root.tensorflow.FunctionDef.decode(r,r.uint32()));break;case 2:if(!(m.gradient&&m.gradient.length))m.gradient=[];m.gradient.push($root.tensorflow.GradientDef.decode(r,r.uint32()));break;default:r.skipType(t&7);break}}return m};return FunctionDefLibrary}();tensorflow.FunctionDef=function(){function FunctionDef(p){this.attr={};this.nodeDef=[];this.ret={};if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}FunctionDef.prototype.signature=null;FunctionDef.prototype.attr=$util.emptyObject;FunctionDef.prototype.nodeDef=$util.emptyArray;FunctionDef.prototype.ret=$util.emptyObject;FunctionDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.FunctionDef,k;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.signature=$root.tensorflow.OpDef.decode(r,r.uint32());break;case 5:r.skip().pos++;if(m.attr===$util.emptyObject)m.attr={};k=r.string();r.pos++;m.attr[k]=$root.tensorflow.AttrValue.decode(r,r.uint32());break;case 3:if(!(m.nodeDef&&m.nodeDef.length))m.nodeDef=[];m.nodeDef.push($root.tensorflow.NodeDef.decode(r,r.uint32()));break;case 4:r.skip().pos++;if(m.ret===$util.emptyObject)m.ret={};k=r.string();r.pos++;m.ret[k]=r.string();break;default:r.skipType(t&7);break}}return m};return FunctionDef}();tensorflow.GradientDef=function(){function GradientDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)this[ks[i]]=p[ks[i]]}GradientDef.prototype.functionName="";GradientDef.prototype.gradientFunc="";GradientDef.decode=function decode(r,l){if(!(r instanceof $Reader))r=$Reader.create(r);var c=l===undefined?r.len:r.pos+l,m=new $root.tensorflow.GradientDef;while(r.pos<c){var t=r.uint32();switch(t>>>3){case 1:m.functionName=r.string();break;case 2:m.gradientFunc=r.string();break;default:r.skipType(t&7);break}}return m};return GradientDef}();return tensorflow}();module.exports=$root},{"protobufjs/minimal":245}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ExecutionContext=function(){function ExecutionContext(weightMap,tensorArrayMap){this.weightMap=weightMap;this.tensorArrayMap=tensorArrayMap;this.rootContext={id:0,frameName:"",iterationId:0};this.contexts=[this.rootContext];this.lastId=0;this.generateCurrentContextIds()}ExecutionContext.prototype.newFrame=function(id,frameName){return{id:id,frameName:frameName,iterationId:0}};Object.defineProperty(ExecutionContext.prototype,"currentContext",{get:function(){return this.contexts},set:function(contexts){if(this.contexts!==contexts){this.contexts=contexts;this.generateCurrentContextIds()}},enumerable:true,configurable:true});Object.defineProperty(ExecutionContext.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:true,configurable:true});Object.defineProperty(ExecutionContext.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:true,configurable:true});ExecutionContext.prototype.generateCurrentContextIds=function(){var names=[];for(var i=0;i<this.contexts.length-1;i++){var contexts=this.contexts.slice(0,this.contexts.length-i);names.push(this.contextIdforContexts(contexts))}names.push("");this._currentContextIds=names};ExecutionContext.prototype.contextIdforContexts=function(contexts){return contexts?contexts.map(function(context){return context.id===0&&context.iterationId===0?"":context.frameName+"-"+context.iterationId}).join("/"):""};ExecutionContext.prototype.enterFrame=function(frameId){if(this.contexts){this.lastId++;this.contexts=this.contexts.slice();this.contexts.push(this.newFrame(this.lastId,frameId));this._currentContextIds.unshift(this.contextIdforContexts(this.contexts))}};ExecutionContext.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1){this.contexts=this.contexts.slice();this.contexts.splice(-1);this.currentContextIds.shift()}else{throw new Error("Cannot exit frame, the context is empty")}};ExecutionContext.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice();this.lastId++;var context=Object.assign({},this.contexts[this.contexts.length-1]);context.iterationId+=1;context.id=this.lastId;this.contexts.splice(-1,1,context);this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else{throw new Error("Cannot increase frame iteration, the context is empty")}};ExecutionContext.prototype.getWeight=function(name){return this.weightMap[name]};ExecutionContext.prototype.addTensorArray=function(tensorArray){this.tensorArrayMap[tensorArray.id]=tensorArray};ExecutionContext.prototype.getTensorArray=function(id){return this.tensorArrayMap[id]};return ExecutionContext}();exports.ExecutionContext=ExecutionContext},{}],10:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var compiled_api_1=require("../data/compiled_api");var operation_mapper_1=require("../operations/operation_mapper");var graph_executor_1=require("./graph_executor");var FrozenModel=function(){function FrozenModel(modelUrl,weightManifestUrl,requestOption){this.modelUrl=modelUrl;this.weightManifestUrl=weightManifestUrl;this.requestOption=requestOption;this.version="n/a"}Object.defineProperty(FrozenModel.prototype,"modelVersion",{get:function(){return this.version},enumerable:true,configurable:true});Object.defineProperty(FrozenModel.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:true,configurable:true});Object.defineProperty(FrozenModel.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:true,configurable:true});Object.defineProperty(FrozenModel.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:true,configurable:true});Object.defineProperty(FrozenModel.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:true,configurable:true});Object.defineProperty(FrozenModel.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:true,configurable:true});FrozenModel.prototype.findIOHandler=function(){var path=[this.modelUrl,this.weightManifestUrl];if(this.requestOption){this.handler=tfc.io.browserHTTPRequest(path,this.requestOption)}else{var handlers=tfc.io.getLoadHandlers(path);if(handlers.length===0){handlers.push(tfc.io.browserHTTPRequest(path,this.requestOption))}else if(handlers.length>1){throw new Error("Found more than one ("+handlers.length+") load handlers for "+("URL '"+[path]+"'"))}this.handler=handlers[0]}};FrozenModel.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var artifacts,graph,weightMap;return __generator(this,function(_a){switch(_a.label){case 0:this.findIOHandler();if(this.handler.load==null){throw new Error("Cannot proceed with model loading because the IOHandler provided "+"does not have the `load` method implemented.")}return[4,this.handler.load()];case 1:artifacts=_a.sent();graph=compiled_api_1.tensorflow.GraphDef.decode(new Uint8Array(artifacts.modelTopology));this.version=graph.versions.producer+"."+graph.versions.minConsumer;weightMap=tfc.io.decodeWeights(artifacts.weightData,artifacts.weightSpecs);this.executor=new graph_executor_1.GraphExecutor(operation_mapper_1.OperationMapper.Instance.transformGraph(graph));this.executor.weightMap=this.convertTensorMapToTensorsMap(weightMap);return[2,true]}})})};FrozenModel.prototype.predict=function(inputs,config){return this.execute_(inputs,true,this.outputNodes)};FrozenModel.prototype.constructTensorMap=function(inputs){var inputArray=inputs instanceof tfc.Tensor?[inputs]:inputs;if(inputArray.length!==this.inputNodes.length){throw new Error("Input tensor count mismatch,"+("the frozen model has "+this.inputNodes.length+" placeholders, ")+("while there are "+inputArray.length+" input tensors."))}return this.inputNodes.reduce(function(map,inputName,i){map[inputName]=inputArray[i];return map},{})};FrozenModel.prototype.execute=function(inputs,outputs){return this.execute_(inputs,false,outputs)};FrozenModel.prototype.execute_=function(inputs,strictInputCheck,outputs){if(strictInputCheck===void 0){strictInputCheck=true}outputs=outputs||this.outputNodes;if(inputs instanceof tfc.Tensor||Array.isArray(inputs)){inputs=this.constructTensorMap(inputs)}if(this.executor.isControlFlowModel||this.executor.isDynamicShapeModel){throw new Error("The model contains control flow or dynamic shape ops, "+"please use executeAsync method")}var result=this.executor.execute(this.convertTensorMapToTensorsMap(inputs),strictInputCheck,outputs);var keys=Object.keys(result);return Array.isArray(outputs)&&outputs.length>1?outputs.map(function(node){return result[node]}):result[keys[0]]};FrozenModel.prototype.executeAsync=function(inputs,outputs){return __awaiter(this,void 0,void 0,function(){var result,keys;return __generator(this,function(_a){switch(_a.label){case 0:if(!(this.executor.isControlFlowModel||this.executor.isDynamicShapeModel)){throw new Error("The model does not contain control flow or dynamic shape ops, "+"please use execute method for better performance.")}outputs=outputs||this.outputNodes;if(inputs instanceof tfc.Tensor||Array.isArray(inputs)){inputs=this.constructTensorMap(inputs)}return[4,this.executor.executeAsync(this.convertTensorMapToTensorsMap(inputs),outputs)];case 1:result=_a.sent();keys=Object.keys(result);return[2,Array.isArray(outputs)&&outputs.length>1?outputs.map(function(node){return result[node]}):result[keys[0]]]}})})};FrozenModel.prototype.convertTensorMapToTensorsMap=function(map){return Object.keys(map).reduce(function(newMap,key){newMap[key]=[map[key]];return newMap},{})};FrozenModel.prototype.dispose=function(){this.executor.dispose()};return FrozenModel}();exports.FrozenModel=FrozenModel;function loadFrozenModel(modelUrl,weightsManifestUrl,requestOption){return __awaiter(this,void 0,void 0,function(){var model;return __generator(this,function(_a){switch(_a.label){case 0:model=new FrozenModel(modelUrl,weightsManifestUrl,requestOption);return[4,model.load()];case 1:_a.sent();return[2,model]}})})}exports.loadFrozenModel=loadFrozenModel},{"../data/compiled_api":8,"../operations/operation_mapper":46,"./graph_executor":11,"@tensorflow/tfjs-core":55}],11:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var tfjs_core_1=require("@tensorflow/tfjs-core");var utils_1=require("../operations/executors/utils");var operation_executor_1=require("../operations/operation_executor");var execution_context_1=require("./execution_context");var GraphExecutor=function(){function GraphExecutor(graph){this.graph=graph;this.compiledMap=new Map;this._weightMap={};this.SEPERATOR=",";this.placeholders=graph.placeholders;this._outputs=graph.outputs;this.compile()}Object.defineProperty(GraphExecutor.prototype,"weightMap",{get:function(){return this._weightMap},set:function(weightMap){var weightIds=Object.keys(weightMap).map(function(key){return weightMap[key].map(function(tensor){return tensor.id})});this.weightIds=[].concat.apply([],weightIds);this._weightMap=weightMap},enumerable:true,configurable:true});Object.defineProperty(GraphExecutor.prototype,"inputs",{get:function(){return this.placeholders.map(function(node){return{name:node.name,shape:node.params["shape"]?node.params["shape"].value:undefined,dtype:node.params["dtype"]?node.params["dtype"].value:undefined}})},enumerable:true,configurable:true});Object.defineProperty(GraphExecutor.prototype,"outputs",{get:function(){return this._outputs.map(function(node){return{name:node.name,shape:node.params["shape"]?node.params["shape"].value:undefined,dtype:node.params["dtype"]?node.params["dtype"].value:undefined}})},enumerable:true,configurable:true});Object.defineProperty(GraphExecutor.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(node){return node.name})},enumerable:true,configurable:true});Object.defineProperty(GraphExecutor.prototype,"outputNodes",{get:function(){return this.outputs.map(function(node){return node.name})},enumerable:true,configurable:true});Object.defineProperty(GraphExecutor.prototype,"isControlFlowModel",{get:function(){return this.graph.withControlFlow},enumerable:true,configurable:true});Object.defineProperty(GraphExecutor.prototype,"isDynamicShapeModel",{get:function(){return this.graph.withDynamicShape},enumerable:true,configurable:true});GraphExecutor.prototype.compile=function(startNodes){if(this.graph.withControlFlow||this.graph.withDynamicShape){return}var compiledOrder=[];var inputs=startNodes||this.graph.placeholders;var sortedNodeNames=inputs.map(function(node){return node.name}).sort();var nameKey=sortedNodeNames.join(this.SEPERATOR);if(this.compiledMap.get(nameKey)){return}var stack=inputs.concat(this.graph.weights);var visited={};while(stack.length>0){var node=stack.pop();visited[node.name]=true;compiledOrder.push(node);node.children.forEach(function(childNode){if(!visited[childNode.name]&&childNode.inputNames.every(function(name){var nodeName=utils_1.getNodeNameAndIndex(name)[0];return visited[nodeName]})){stack.push(childNode)}})}this.compiledMap.set(nameKey,compiledOrder)};GraphExecutor.prototype.execute=function(inputs,strictInputCheck,outputs){var _this=this;if(strictInputCheck===void 0){strictInputCheck=true}var names=Object.keys(inputs).sort();this.checkInput(inputs,strictInputCheck);this.checkInputShapeAndType(inputs,strictInputCheck);this.compile(names.map(function(name){return _this.graph.nodes[name]}));var outputNames=this.calculateOutputs(outputs);this.checkOutput(this.compiledMap.get(names.join(this.SEPERATOR)),outputNames);var tensorArrayMap={};var result=tfjs_core_1.tidy(function(){var context=new execution_context_1.ExecutionContext(_this._weightMap,tensorArrayMap);var tensorMap=__assign({},_this.weightMap,inputs);var compiledNodes=_this.compiledMap.get(names.join(_this.SEPERATOR));for(var i=0;i<compiledNodes.length;i++){var node=compiledNodes[i];if(!tensorMap[node.name]){tensorMap[node.name]=operation_executor_1.executeOp(node,tensorMap,context)}if(outputNames.every(function(name){return!!tensorMap[name]})){break}}return _this.findOutputs(tensorMap,context,outputNames)});return result};GraphExecutor.prototype.executeAsync=function(inputs,outputs){return __awaiter(this,void 0,void 0,function(){var _this=this;var tensorArrayMap,context,tensors,results,outputIds,inputIdArray,inputIds;return __generator(this,function(_a){switch(_a.label){case 0:this.checkInput(inputs,false);this.checkInputShapeAndType(inputs,false);tensorArrayMap={};context=new execution_context_1.ExecutionContext(this._weightMap,tensorArrayMap);return[4,this.executeWithControlFlow(inputs,context)];case 1:tensors=_a.sent();results=this.findOutputs(tensors,context,outputs);outputIds=Object.keys(results).map(function(key){return results[key].id});inputIdArray=Object.keys(inputs).map(function(key){return inputs[key].map(function(input){return input.id})});inputIds=[].concat.apply([],inputIdArray);Object.keys(tensors).forEach(function(key){var tensorArray=tensors[key];tensorArray.forEach(function(tensor){if(tensor&&outputIds.indexOf(tensor.id)===-1&&inputIds.indexOf(tensor.id)===-1&&_this.weightIds.indexOf(tensor.id)===-1){tensor.dispose()}})});return[2,results]}})})};GraphExecutor.prototype.executeWithControlFlow=function(inputs,context){return __awaiter(this,void 0,void 0,function(){var _this=this;var names,inputNodes,stack,tensorMap,added,promises;return __generator(this,function(_a){switch(_a.label){case 0:names=Object.keys(inputs);inputNodes=names.map(function(name){return _this.graph.nodes[name]});stack=inputNodes.concat(this.graph.weights).map(function(node){return{node:node,contexts:context.currentContext}});tensorMap=__assign({},this.weightMap,inputs);added={};_a.label=1;case 1:if(!(stack.length>0))return[3,3];promises=this.processStack(inputNodes,stack,context,tensorMap,added);return[4,Promise.all(promises)];case 2:_a.sent();return[3,1];case 3:return[2,tensorMap]}})})};GraphExecutor.prototype.processStack=function(inputNodes,stack,context,tensorMap,added){var _this=this;var promises=[];var _loop_1=function(){var item=stack.pop();context.currentContext=item.contexts;var nodeName="";if(item.node.op==="enter"&&utils_1.getParamValue("isConstant",item.node,tensorMap,context)){nodeName=utils_1.getNodeNameAndIndex(item.node.name,context)[0]}if(inputNodes.indexOf(item.node)===-1){var tensors=operation_executor_1.executeOp(item.node,tensorMap,context);if(!nodeName){nodeName=utils_1.getNodeNameAndIndex(item.node.name,context)[0]}var currentContext_1=context.currentContext;if(tensors instanceof Promise){promises.push(tensors.then(function(t){tensorMap[nodeName]=t;context.currentContext=currentContext_1;_this.processChildNodes(item.node,stack,context,tensorMap,added);return t}))}else{tensorMap[nodeName]=tensors;this_1.processChildNodes(item.node,stack,context,tensorMap,added)}}else{this_1.processChildNodes(item.node,stack,context,tensorMap,added)}};var this_1=this;while(stack.length>0){_loop_1()}return promises};GraphExecutor.prototype.processChildNodes=function(node,stack,context,tensorMap,added){node.children.forEach(function(childNode){var nodeName=utils_1.getNodeNameAndIndex(childNode.name,context)[0];if(!added[nodeName]){if(childNode.op==="merge"){if(childNode.inputNames.some(function(name){return!!utils_1.getTensor(name,tensorMap,context)})){added[nodeName]=true;stack.push({contexts:context.currentContext,node:childNode})}}else if(childNode.inputNames.every(function(name){return!!utils_1.getTensor(name,tensorMap,context)})){added[nodeName]=true;stack.push({contexts:context.currentContext,node:childNode})}}})};GraphExecutor.prototype.calculateOutputs=function(outputs){if(outputs&&!(outputs instanceof Array)){outputs=[outputs]}return outputs||this.graph.outputs.map(function(node){return node.name})};GraphExecutor.prototype.findOutputs=function(tensorMap,context,outputs){var requestedOutputs=this.calculateOutputs(outputs);return requestedOutputs.reduce(function(map,name){map[name]=utils_1.getTensor(name,tensorMap,context);return map},{})};GraphExecutor.prototype.dispose=function(){var _this=this;Object.keys(this.weightMap).forEach(function(key){return _this.weightMap[key].forEach(function(tensor){return tensor.dispose()})})};GraphExecutor.prototype.checkInputShapeAndType=function(inputs,strictInputCheck){if(strictInputCheck===void 0){strictInputCheck=true}this.placeholders.forEach(function(node){var inputTensors=inputs[node.name];if(!strictInputCheck&&!inputTensors){return}var input=inputTensors[0];if(node.params["shape"]&&node.params["shape"].value){var shape_1=node.params["shape"].value;var match=shape_1.length===input.shape.length&&input.shape.every(function(dim,index){return shape_1[index]===-1||shape_1[index]===dim});tfjs_core_1.util.assert(match,"The shape of dict['"+node.name+"'] provided in model.execute(dict) must be ["+shape_1+"], but was ["+input.shape+"]")}if(node.params["dtype"]&&node.params["dtype"].value){tfjs_core_1.util.assert(input.dtype===node.params["dtype"].value,"The dtype of dict['"+node.name+"'] provided in model.execute(dict) must be "+node.params["dtype"].value+", but was "+input.dtype)}})};GraphExecutor.prototype.checkInput=function(inputs,strictInputCheck){var _this=this;if(strictInputCheck===void 0){strictInputCheck=true}var inputKeys=Object.keys(inputs);var missing=[];var extra=[];this.inputNodes.forEach(function(name){if(inputKeys.indexOf(name)===-1)missing.push(name)});inputKeys.forEach(function(name){if(_this.inputNodes.indexOf(name)===-1)extra.push(name)});var notInGraph=extra.filter(function(name){return!_this.graph.nodes[name]});if(missing.length>0&&strictInputCheck){throw new Error("The dict provided in model.execute(dict) has the keys "+("["+inputKeys+"], but is missing the required keys: ["+missing+"]."))}if(extra.length>0&&strictInputCheck){throw new Error("The dict provided in model.execute(dict) has "+("unused keys: ["+extra+"]. Please provide only the following keys: ")+("["+this.inputNodes+"]."))}if(notInGraph.length>0){throw new Error("The dict provided in model.execute(dict) has "+("keys: ["+notInGraph+"] not part of model graph."))}};GraphExecutor.prototype.checkOutput=function(compiledNodes,outputs){var compiledNodeNames=compiledNodes.map(function(node){return node.name});var extra=[];outputs.forEach(function(name){if(compiledNodeNames.indexOf(name)===-1)extra.push(name)});if(extra.length>0){throw new Error("The following outputs are not be generated by the execution: "+("["+extra+"]."))}};return GraphExecutor}();exports.GraphExecutor=GraphExecutor},{"../operations/executors/utils":29,"../operations/operation_executor":45,"./execution_context":9,"@tensorflow/tfjs-core":55}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfjs_core_1=require("@tensorflow/tfjs-core");var TensorArray=function(){function TensorArray(name,dtype,maxSize,elementShape,identicalElementShapes,dynamicSize,clearAfterRead){this.name=name;this.dtype=dtype;this.maxSize=maxSize;this.elementShape=elementShape;this.identicalElementShapes=identicalElementShapes;this.dynamicSize=dynamicSize;this.clearAfterRead=clearAfterRead;this.tensors=[];this.closed_=false;this.id=TensorArray.nextId++}Object.defineProperty(TensorArray.prototype,"closed",{get:function(){return this.closed_},enumerable:true,configurable:true});TensorArray.prototype.clearAndClose=function(){this.tensors.forEach(function(tensor){return tensor.tensor.dispose()});this.tensors=[];this.closed_=true};TensorArray.prototype.size=function(){return this.tensors.length};TensorArray.prototype.read=function(index){if(this.closed_){throw new Error("TensorArray "+this.name+" has already been closed.")}if(index<0||index>=this.tensors.length){throw new Error("Tried to read from index "+index+", but array size is: "+this.tensors.length)}var tensorWithState=this.tensors[index];if(tensorWithState.cleared){throw new Error("TensorArray "+this.name+": Could not read index "+index+" twice because it was cleared after a previous read "+"(perhaps try setting clear_after_read = false?).")}if(this.clearAfterRead){tensorWithState.cleared=true}tensorWithState.read=true;return tensorWithState.tensor};TensorArray.prototype.readMany=function(indices){var _this=this;return indices.map(function(index){return _this.read(index)})};TensorArray.prototype.write=function(index,tensor){if(this.closed_){throw new Error("TensorArray "+this.name+" has already been closed.")}if(index<0||!this.dynamicSize&&index>=this.maxSize){throw new Error("Tried to write to index "+index+", but array is not resizeable and size is: "+this.maxSize)}var t=this.tensors[index]||{};if(tensor.dtype!==this.dtype){throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+index+",\n          because the value dtype is "+tensor.dtype+", but TensorArray dtype is "+this.dtype+".")}if(this.size()===0&&this.elementShape.length===0){this.elementShape=tensor.shape}this.assertShapesMatch(this.elementShape,tensor.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+index+".");if(t&&t.read){throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+index+", because it has already been read.")}if(t&&t.written){throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+index+", because it has already been written.")}t.tensor=tensor;t.written=true;this.tensors[index]=t};TensorArray.prototype.writeMany=function(indices,tensors){var _this=this;if(indices.length!==tensors.length){throw new Error("TensorArray "+this.name+": could not write multiple tensors,"+("because the index size: "+indices.length+" is not the same as tensors size: "+tensors.length+"."))}indices.forEach(function(i,index){return _this.write(i,tensors[index])})};TensorArray.prototype.gather=function(indices,dtype){if(!!dtype&&dtype!==this.dtype){throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+dtype)}if(!indices){indices=[];for(var i=0;i<this.size();i++){indices.push(i)}}if(indices.length===0){return tfjs_core_1.tensor([],[0].concat(this.elementShape))}var tensors=this.readMany(indices);this.assertShapesMatch(this.elementShape,tensors[0].shape,"TensorArray shape mismatch: ");return tfjs_core_1.stack(tensors,0)};TensorArray.prototype.concat=function(dtype){if(!!dtype&&dtype!==this.dtype){throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+dtype)}if(this.size()===0){return tfjs_core_1.tensor([],[0].concat(this.elementShape))}var indices=[];for(var i=0;i<this.size();i++){indices.push(i)}var tensors=this.readMany(indices);this.assertShapesMatch(this.elementShape,tensors[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+tensors[0].shape+")");return tfjs_core_1.concat(tensors,0)};TensorArray.prototype.scatter=function(indices,tensor){if(tensor.dtype!==this.dtype){throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+tensor.dtype)}if(indices.length!==tensor.shape[0]){throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+indices.length+" vs. "+tensor.shape[0])}var maxIndex=Math.max.apply(Math,indices);if(!this.dynamicSize&&maxIndex>=this.maxSize){throw new Error("Max index must be < array size ("+maxIndex+"  vs. "+this.maxSize+")")}this.writeMany(indices,tfjs_core_1.unstack(tensor,0))};TensorArray.prototype.split=function(length,tensor){var _this=this;if(tensor.dtype!==this.dtype){throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+tensor.dtype)}var totalLength=0;var cumulativeLengths=length.map(function(len){totalLength+=len;return totalLength});if(totalLength!==tensor.shape[0]){throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+totalLength+", and tensor's shape is: "+tensor.shape)}if(!this.dynamicSize&&length.length!==this.maxSize){throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+length.length+"), "+"and the TensorArray is not marked as dynamically resizeable")}var elementPerRow=totalLength===0?0:tensor.size/totalLength;var tensors=[];tfjs_core_1.tidy(function(){tensor=tensor.reshape([1,totalLength,elementPerRow]);for(var i=0;i<length.length;++i){var previousLength=i===0?0:cumulativeLengths[i-1];var indices_1=[0,previousLength,0];var sizes=[1,length[i],elementPerRow];tensors[i]=tfjs_core_1.slice(tensor,indices_1,sizes).reshape(_this.elementShape)}return tensors});var indices=[];for(var i=0;i<length.length;i++){indices[i]=i}this.writeMany(indices,tensors)};TensorArray.prototype.assertShapesMatch=function(shapeA,shapeB,errorMessagePrefix){if(errorMessagePrefix===void 0){errorMessagePrefix=""}tfjs_core_1.util.assert(this.arraysEqual(shapeA,shapeB),errorMessagePrefix+(" Shapes "+shapeA+" and "+shapeB+" must match"))};TensorArray.prototype.arraysEqual=function(n1,n2){if(n1.length!==n2.length){return false}for(var i=0;i<n1.length;i++){if(n1[i]!==-1&&n2[i]!==-1&&n1[i]!==n2[i]){return false}}return true};TensorArray.nextId=0;return TensorArray}();exports.TensorArray=TensorArray},{"@tensorflow/tfjs-core":55}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var frozen_model_1=require("./executor/frozen_model");exports.FrozenModel=frozen_model_1.FrozenModel;exports.loadFrozenModel=frozen_model_1.loadFrozenModel;var version_1=require("./version");exports.version_converter=version_1.version},{"./executor/frozen_model":10,"./version":47}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"add":{return[tfc.add(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"addN":{return[tfc.addN(utils_1.getParamValue("tensors",node,tensorMap,context))]}case"mod":return[tfc.mod(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"mul":return[tfc.mul(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"div":{return[tfc.div(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"floorDiv":{return[tfc.floorDiv(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"sub":{return[tfc.sub(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"minimum":{return[tfc.minimum(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"maximum":{return[tfc.maximum(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"pow":{return[tfc.pow(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"squaredDifference":{return[tfc.squaredDifference(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="arithmetic"},{"./utils":29,"@tensorflow/tfjs-core":55}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"abs":return[tfc.abs(utils_1.getParamValue("x",node,tensorMap,context))];case"acos":return[tfc.acos(utils_1.getParamValue("x",node,tensorMap,context))];case"acosh":return[tfc.acosh(utils_1.getParamValue("x",node,tensorMap,context))];case"asin":return[tfc.asin(utils_1.getParamValue("x",node,tensorMap,context))];case"asinh":return[tfc.asinh(utils_1.getParamValue("x",node,tensorMap,context))];case"atan":return[tfc.atan(utils_1.getParamValue("x",node,tensorMap,context))];case"atanh":return[tfc.atanh(utils_1.getParamValue("x",node,tensorMap,context))];case"ceil":return[tfc.ceil(utils_1.getParamValue("x",node,tensorMap,context))];case"cos":return[tfc.cos(utils_1.getParamValue("x",node,tensorMap,context))];case"cosh":return[tfc.cosh(utils_1.getParamValue("x",node,tensorMap,context))];case"elu":return[tfc.elu(utils_1.getParamValue("x",node,tensorMap,context))];case"erf":return[tfc.erf(utils_1.getParamValue("x",node,tensorMap,context))];case"exp":return[tfc.exp(utils_1.getParamValue("x",node,tensorMap,context))];case"expm1":{return[tfc.expm1(utils_1.getParamValue("x",node,tensorMap,context))]}case"floor":return[tfc.floor(utils_1.getParamValue("x",node,tensorMap,context))];case"log":return[tfc.log(utils_1.getParamValue("x",node,tensorMap,context))];case"log1p":{return[tfc.log1p(utils_1.getParamValue("x",node,tensorMap,context))]}case"neg":return[tfc.neg(utils_1.getParamValue("x",node,tensorMap,context))];case"reciprocal":{return[tfc.reciprocal(utils_1.getParamValue("x",node,tensorMap,context))]}case"relu":return[tfc.relu(utils_1.getParamValue("x",node,tensorMap,context))];case"round":{return[tfc.round(utils_1.getParamValue("x",node,tensorMap,context))]}case"selu":return[tfc.selu(utils_1.getParamValue("x",node,tensorMap,context))];case"sigmoid":return[tfc.sigmoid(utils_1.getParamValue("x",node,tensorMap,context))];case"sin":return[tfc.sin(utils_1.getParamValue("x",node,tensorMap,context))];case"sign":{return[tfc.sign(utils_1.getParamValue("x",node,tensorMap,context))]}case"sinh":{return[tfc.sinh(utils_1.getParamValue("x",node,tensorMap,context))]}case"softplus":{return[tfc.softplus(utils_1.getParamValue("x",node,tensorMap,context))]}case"sqrt":{return[tfc.sqrt(utils_1.getParamValue("x",node,tensorMap,context))]}case"square":{return[tfc.square(utils_1.getParamValue("x",node,tensorMap,context))]}case"tanh":{return[tfc.tanh(utils_1.getParamValue("x",node,tensorMap,context))]}case"tan":return[tfc.tan(utils_1.getParamValue("x",node,tensorMap,context))];case"clipByValue":return[tfc.clipByValue(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("clipValueMin",node,tensorMap,context),utils_1.getParamValue("clipValueMax",node,tensorMap,context))];case"rsqrt":return[tfc.div(tfc.scalar(1,"float32"),tfc.sqrt(utils_1.getTensor(node.inputNames[0],tensorMap,context)))];default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="basic_math"},{"./utils":29,"@tensorflow/tfjs-core":55}],16:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var tfjs_core_1=require("@tensorflow/tfjs-core");var tensor_array_1=require("../../executor/tensor_array");var utils_1=require("./utils");function executeOp(node,tensorMap,context){return __awaiter(this,void 0,void 0,function(){var _a,pred,data_1,inputName,frameId,data,tensor,input,size,dtype,elementShape,dynamicSize,clearAfterRead,identicalElementShapes,name_1,tensorArray,id,index,writeTensor,writeTensorArray,readId,readIndex,readTensorArray,gatherId,gatherIndices,gatherDtype,gatherTensorArray,scatterId,scatterIndices,scatterTensor,scatterTensorArray,concatId,concatTensorArray,concatDtype,splitId,splitTensor,lengths,splitTensorArray,sizeId,sizeTensorArray,closeId,closeTensorArray;return __generator(this,function(_b){switch(_b.label){case 0:_a=node.op;switch(_a){case"loopCond":return[3,1];case"switch":return[3,2];case"merge":return[3,4];case"enter":return[3,5];case"exit":return[3,6];case"nextIteration":return[3,7];case"tensorArray":return[3,8];case"tensorArrayWrite":return[3,9];case"tensorArrayRead":return[3,10];case"tensorArrayGather":return[3,11];case"tensorArrayScatter":return[3,12];case"tensorArrayConcat":return[3,13];case"tensorArraySplit":return[3,14];case"tensorArraySize":return[3,15];case"tensorArrayClose":return[3,16]}return[3,17];case 1:return[2,[utils_1.getParamValue("pred",node,tensorMap,context)]];case 2:pred=utils_1.getParamValue("pred",node,tensorMap,context);data_1=utils_1.getParamValue("data",node,tensorMap,context);return[4,pred.data()];case 3:return[2,_b.sent()[0]?[undefined,data_1]:[data_1,undefined]];case 4:inputName=node.inputNames.find(function(name){return utils_1.getTensor(name,tensorMap,context)!==undefined});return[2,inputName?[utils_1.getTensor(inputName,tensorMap,context)]:undefined];case 5:frameId=utils_1.getParamValue("frameName",node,tensorMap,context);data=utils_1.getParamValue("tensor",node,tensorMap,context);context.enterFrame(frameId);return[2,[data]];case 6:tensor=utils_1.getParamValue("tensor",node,tensorMap,context);context.exitFrame();return[2,[tensor]];case 7:input=utils_1.getParamValue("tensor",node,tensorMap,context);context.nextIteration();return[2,[input]];case 8:size=utils_1.getParamValue("size",node,tensorMap,context);dtype=utils_1.getParamValue("dtype",node,tensorMap,context);elementShape=utils_1.getParamValue("elementShape",node,tensorMap,context);dynamicSize=utils_1.getParamValue("dynamicSize",node,tensorMap,context);clearAfterRead=utils_1.getParamValue("clearAfterRead",node,tensorMap,context);identicalElementShapes=utils_1.getParamValue("identicalElementShapes",node,tensorMap,context);name_1=utils_1.getParamValue("name",node,tensorMap,context);tensorArray=new tensor_array_1.TensorArray(name_1,dtype,size,elementShape,identicalElementShapes,dynamicSize,clearAfterRead);context.addTensorArray(tensorArray);return[2,[tfjs_core_1.scalar(tensorArray.id),tfjs_core_1.scalar(1)]];case 9:id=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);index=utils_1.getParamValue("index",node,tensorMap,context);writeTensor=utils_1.getParamValue("tensor",node,tensorMap,context);writeTensorArray=context.getTensorArray(id);writeTensorArray.write(index,writeTensor);return[2,[tfjs_core_1.scalar(1)]];case 10:readId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);readIndex=utils_1.getParamValue("index",node,tensorMap,context);readTensorArray=context.getTensorArray(readId);return[2,[readTensorArray.read(readIndex)]];case 11:gatherId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);gatherIndices=utils_1.getParamValue("indices",node,tensorMap,context);gatherDtype=utils_1.getParamValue("dtype",node,tensorMap,context);gatherTensorArray=context.getTensorArray(gatherId);return[2,[gatherTensorArray.gather(gatherIndices,gatherDtype)]];case 12:scatterId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);scatterIndices=utils_1.getParamValue("indices",node,tensorMap,context);scatterTensor=utils_1.getParamValue("tensor",node,tensorMap,context);scatterTensorArray=context.getTensorArray(scatterId);scatterTensorArray.scatter(scatterIndices,scatterTensor);return[2,[tfjs_core_1.scalar(1)]];case 13:concatId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);concatTensorArray=context.getTensorArray(concatId);concatDtype=utils_1.getParamValue("dtype",node,tensorMap,context);return[2,[concatTensorArray.concat(concatDtype)]];case 14:splitId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);splitTensor=utils_1.getParamValue("tensor",node,tensorMap,context);lengths=utils_1.getParamValue("lengths",node,tensorMap,context);splitTensorArray=context.getTensorArray(splitId);splitTensorArray.split(lengths,splitTensor);return[2,[tfjs_core_1.scalar(1)]];case 15:sizeId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);sizeTensorArray=context.getTensorArray(sizeId);return[2,[tfjs_core_1.scalar(sizeTensorArray.size(),"int32")]];case 16:closeId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context);closeTensorArray=context.getTensorArray(closeId);closeTensorArray.clearAndClose();return[2,[]];case 17:throw TypeError("Node type "+node.op+" is not implemented")}})})}exports.executeOp=executeOp;exports.CATEGORY="control"},{"../../executor/tensor_array":12,"./utils":29,"@tensorflow/tfjs-core":55}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"conv1d":{var stride=utils_1.getParamValue("stride",node,tensorMap,context);var pad=utils_1.getParamValue("pad",node,tensorMap,context);var dataFormat=utils_1.getParamValue("dataFormat",node,tensorMap,context).toUpperCase();var dilation=utils_1.getParamValue("dilation",node,tensorMap,context);return[tfc.conv1d(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),stride,pad,dataFormat,dilation)]}case"conv2d":{var stride=utils_1.getParamValue("strides",node,tensorMap,context);var pad=utils_1.getParamValue("pad",node,tensorMap,context);var dataFormat=utils_1.getParamValue("dataFormat",node,tensorMap,context).toUpperCase();var dilations=utils_1.getParamValue("dilations",node,tensorMap,context);return[tfc.conv2d(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),[stride[1],stride[2]],pad,dataFormat,[dilations[0],dilations[1]])]}case"conv2dTranspose":{var shape=utils_1.getParamValue("outputShape",node,tensorMap,context);var stride=utils_1.getParamValue("strides",node,tensorMap,context);var pad=utils_1.getParamValue("pad",node,tensorMap,context);return[tfc.conv2dTranspose(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),shape,[stride[1],stride[2]],pad)]}case"depthwiseConv2d":{var stride=utils_1.getParamValue("strides",node,tensorMap,context);var pad=utils_1.getParamValue("pad",node,tensorMap,context);var dilations=utils_1.getParamValue("dilations",node,tensorMap,context);var dataFormat=utils_1.getParamValue("dataFormat",node,tensorMap,context).toUpperCase();return[tfc.depthwiseConv2d(utils_1.getParamValue("input",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),[stride[1],stride[2]],pad,dataFormat,[dilations[0],dilations[1]])]}case"avgPool":{var stride=utils_1.getParamValue("strides",node,tensorMap,context);var pad=utils_1.getParamValue("pad",node,tensorMap,context);var kernelSize=utils_1.getParamValue("kernelSize",node,tensorMap,context);return[tfc.avgPool(utils_1.getParamValue("x",node,tensorMap,context),[kernelSize[1],kernelSize[2]],[stride[1],stride[2]],pad)]}case"maxPool":{var stride=utils_1.getParamValue("strides",node,tensorMap,context);var pad=utils_1.getParamValue("pad",node,tensorMap,context);var kernelSize=utils_1.getParamValue("kernelSize",node,tensorMap,context);return[tfc.maxPool(utils_1.getParamValue("x",node,tensorMap,context),[kernelSize[1],kernelSize[2]],[stride[1],stride[2]],pad)]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="convolution"},{"./utils":29,"@tensorflow/tfjs-core":55}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"fill":{var shape=utils_1.getParamValue("shape",node,tensorMap,context);var dtype=utils_1.getParamValue("dtype",node,tensorMap,context);var value=utils_1.getParamValue("value",node,tensorMap,context);return[tfc.fill(shape,value,dtype)]}case"linspace":{var start=utils_1.getParamValue("start",node,tensorMap,context);var stop_1=utils_1.getParamValue("stop",node,tensorMap,context);var num=utils_1.getParamValue("num",node,tensorMap,context);return[tfc.linspace(start,stop_1,num)]}case"oneHot":{var indices=utils_1.getParamValue("indices",node,tensorMap,context);var depth=utils_1.getParamValue("depth",node,tensorMap,context);var onValue=utils_1.getParamValue("onValue",node,tensorMap,context);var offValue=utils_1.getParamValue("offValue",node,tensorMap,context);return[tfc.oneHot(indices,depth,onValue,offValue)]}case"ones":{return[tfc.ones(utils_1.getParamValue("shape",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))]}case"onesLike":{return[tfc.onesLike(utils_1.getParamValue("x",node,tensorMap,context))]}case"randomUniform":{return[tfc.randomUniform(utils_1.getParamValue("shape",node,tensorMap,context),utils_1.getParamValue("minval",node,tensorMap,context),utils_1.getParamValue("maxval",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))]}case"range":{var start=utils_1.getParamValue("start",node,tensorMap,context);var stop_2=utils_1.getParamValue("stop",node,tensorMap,context);var step=utils_1.getParamValue("step",node,tensorMap,context);return[tfc.range(start,stop_2,step,utils_1.getParamValue("dtype",node,tensorMap,context))]}case"truncatedNormal":{var shape=utils_1.getParamValue("shape",node,tensorMap,context);var mean=utils_1.getParamValue("mean",node,tensorMap,context);var stdDev=utils_1.getParamValue("stdDev",node,tensorMap,context);var seed=utils_1.getParamValue("seed",node,tensorMap,context);return[tfc.truncatedNormal(shape,mean,stdDev,utils_1.getParamValue("dtype",node,tensorMap,context),seed)]}case"zeros":{return[tfc.zeros(utils_1.getParamValue("shape",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))]}case"zerosLike":{return[tfc.zerosLike(utils_1.getParamValue("x",node,tensorMap,context))]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="creation"},{"./utils":29,"@tensorflow/tfjs-core":55}],19:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");function executeOp(node,tensorMap,context){return __awaiter(this,void 0,void 0,function(){var _a,boxes,scores,maxOutputSize,iouThreshold,scoreThreshold;return __generator(this,function(_b){switch(_b.label){case 0:_a=node.op;switch(_a){case"nonMaxSuppression":return[3,1];case"whereAsync":return[3,3]}return[3,5];case 1:boxes=utils_1.getParamValue("boxes",node,tensorMap,context);scores=utils_1.getParamValue("scores",node,tensorMap,context);maxOutputSize=utils_1.getParamValue("maxOutputSize",node,tensorMap,context);iouThreshold=utils_1.getParamValue("iouThreshold",node,tensorMap,context);scoreThreshold=utils_1.getParamValue("scoreThreshold",node,tensorMap,context);return[4,tfc.image.nonMaxSuppressionAsync(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold)];case 2:return[2,[_b.sent()]];case 3:return[4,tfc.whereAsync(utils_1.getParamValue("condition",node,tensorMap,context))];case 4:return[2,[_b.sent()]];case 5:throw TypeError("Node type "+node.op+" is not implemented")}})})}exports.executeOp=executeOp;exports.CATEGORY="dynamic"},{"./utils":29,"@tensorflow/tfjs-core":55}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"topK":{var x=utils_1.getParamValue("x",node,tensorMap,context);var k=utils_1.getParamValue("k",node,tensorMap,context);var sorted=utils_1.getParamValue("sorted",node,tensorMap,context);var result=tfc.topk(x,k,sorted);return[result.values,result.indices]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="evaluation"},{"./utils":29,"@tensorflow/tfjs-core":55}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"const":{return tensorMap[node.name]}case"placeholder":var def=utils_1.getParamValue("default",node,tensorMap,context);return[utils_1.getTensor(node.name,tensorMap,context)||def];case"identity":case"stopGradient":case"fakeQuantWithMinMaxVars":return[utils_1.getParamValue("x",node,tensorMap,context)];case"snapshot":var snapshot=utils_1.getParamValue("x",node,tensorMap,context);return[snapshot.clone()];case"shape":return[tfc.tensor1d(utils_1.getParamValue("x",node,tensorMap,context).shape,"int32")];case"shapeN":return utils_1.getParamValue("x",node,tensorMap,context).map(function(t){return tfc.tensor1d(t.shape)});case"size":return[tfc.scalar(utils_1.getParamValue("x",node,tensorMap,context).size,"int32")];case"rank":return[tfc.scalar(utils_1.getParamValue("x",node,tensorMap,context).rank,"int32")];case"noop":return[];case"print":var input=utils_1.getParamValue("x",node,tensorMap,context);var data=utils_1.getParamValue("data",node,tensorMap,context);var message=utils_1.getParamValue("message",node,tensorMap,context);var summarize=utils_1.getParamValue("summarize",node,tensorMap,context);console.warn("The graph has a tf.print() operation,"+"usually used for debugging, which slows down performance.");console.log(message);for(var i=0;i<data.length;i++){console.log(Array.prototype.slice.call(data[0].dataSync()).slice(0,summarize))}return[input];default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="graph"},{"./utils":29,"@tensorflow/tfjs-core":55}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"resizeBilinear":{var images=utils_1.getParamValue("images",node,tensorMap,context);var size=utils_1.getParamValue("size",node,tensorMap,context);var alignCorners=utils_1.getParamValue("alignCorners",node,tensorMap,context);return[tfc.image.resizeBilinear(images,[size[0],size[1]],alignCorners)]}case"resizeNearestNeighbor":{var images=utils_1.getParamValue("images",node,tensorMap,context);var size=utils_1.getParamValue("size",node,tensorMap,context);var alignCorners=utils_1.getParamValue("alignCorners",node,tensorMap,context);return[tfc.image.resizeNearestNeighbor(images,[size[0],size[1]],alignCorners)]}case"cropAndResize":{var image=utils_1.getParamValue("image",node,tensorMap,context);var boxes=utils_1.getParamValue("boxes",node,tensorMap,context);var boxInd=utils_1.getParamValue("boxInd",node,tensorMap,context);var cropSize=utils_1.getParamValue("cropSize",node,tensorMap,context);var method=utils_1.getParamValue("method",node,tensorMap,context);var extrapolationValue=utils_1.getParamValue("extrapolationValue",node,tensorMap,context);return[tfc.image.cropAndResize(image,boxes,boxInd,cropSize,method,extrapolationValue)]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="image"},{"./utils":29,"@tensorflow/tfjs-core":55}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"equal":{return[tfc.equal(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"notEqual":{return[tfc.notEqual(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"greater":{return[tfc.greater(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"greaterEqual":{return[tfc.greaterEqual(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"less":{return[tfc.less(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"lessEqual":{return[tfc.lessEqual(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"logicalAnd":{return[tfc.logicalAnd(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"logicalNot":{return[tfc.logicalNot(utils_1.getParamValue("a",node,tensorMap,context))]}case"logicalOr":{return[tfc.logicalOr(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}case"where":{return[tfc.where(utils_1.getParamValue("condition",node,tensorMap,context),utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="logical"},{"./utils":29,"@tensorflow/tfjs-core":55}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"matMul":return[tfc.matMul(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context),utils_1.getParamValue("transposeA",node,tensorMap,context),utils_1.getParamValue("transposeB",node,tensorMap,context))];case"transpose":return[tfc.transpose(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("perm",node,tensorMap,context))];default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="matrices"},{"./utils":29,"@tensorflow/tfjs-core":55}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"batchNormalization":{return[tfc.batchNormalization(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("mean",node,tensorMap,context),utils_1.getParamValue("variance",node,tensorMap,context),utils_1.getParamValue("epsilon",node,tensorMap,context),utils_1.getParamValue("scale",node,tensorMap,context),utils_1.getParamValue("offset",node,tensorMap,context))]}case"localResponseNormalization":{return[tfc.localResponseNormalization(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("radius",node,tensorMap,context),utils_1.getParamValue("bias",node,tensorMap,context),utils_1.getParamValue("alpha",node,tensorMap,context),utils_1.getParamValue("beta",node,tensorMap,context))]}case"softmax":{return[tfc.softmax(utils_1.getParamValue("x",node,tensorMap,context))]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="normalization"},{"./utils":29,"@tensorflow/tfjs-core":55}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"max":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.max(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)]}case"mean":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.mean(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)]}case"min":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.min(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)]}case"sum":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.sum(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)]}case"all":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.all(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)]}case"any":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.any(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)]}case"argMax":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.argMax(utils_1.getParamValue("x",node,tensorMap,context),axis)]}case"argMin":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.argMin(utils_1.getParamValue("x",node,tensorMap,context),axis)]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="reduction"},{"./utils":29,"@tensorflow/tfjs-core":55}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"concat":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var inputs=utils_1.getParamValue("tensors",node,tensorMap,context);return[tfc.concat(inputs,axis)]}case"gather":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var input=utils_1.getParamValue("x",node,tensorMap,context);var indices=utils_1.getParamValue("indices",node,tensorMap,context);return[tfc.gather(input,indices,axis)]}case"reverse":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var input=utils_1.getParamValue("x",node,tensorMap,context);return[tfc.reverse(input,axis)]}case"slice":{var begin=utils_1.getParamValue("begin",node,tensorMap,context);var size=utils_1.getParamValue("size",node,tensorMap,context);return[tfc.slice(utils_1.getParamValue("x",node,tensorMap,context),begin,size)]}case"stridedSlice":{var begin=utils_1.getParamValue("begin",node,tensorMap,context);var end=utils_1.getParamValue("end",node,tensorMap,context);var strides=utils_1.getParamValue("strides",node,tensorMap,context);var beginMask=utils_1.getParamValue("beginMask",node,tensorMap,context);var endMask=utils_1.getParamValue("endMask",node,tensorMap,context);var ellipsisMask=utils_1.getParamValue("ellipsisMask",node,tensorMap,context);var newAxisMask=utils_1.getParamValue("newAxisMask",node,tensorMap,context);var shrinkAxisMask=utils_1.getParamValue("shrinkAxisMask",node,tensorMap,context);var tensor=utils_1.getParamValue("x",node,tensorMap,context);if(begin.length===1&&tensor.shape.length>1){for(var i=1;i<tensor.shape.length;i++){begin.push(0);end.push(tensor.shape[i]);strides.push(strides[0])}}return[tfc.stridedSlice(tensor,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask)]}case"stack":{return tfc.tidy(function(){var axis=utils_1.getParamValue("axis",node,tensorMap,context);var tensors=utils_1.getParamValue("tensors",node,tensorMap,context);var shape=tensors[0].shape;var squeezedShape=tensors[0].squeeze().shape;var mapped=tensors.map(function(tensor){var sameShape=tfc.util.arraysEqual(tensor.shape,shape);if(!sameShape&&!tfc.util.arraysEqual(tensor.squeeze().shape,squeezedShape)){throw new Error("the input tensors shape does not match")}return sameShape?tensor:tensor.reshape(shape)});return[tfc.stack(mapped,axis)]})}case"unstack":{return tfc.tidy(function(){var axis=utils_1.getParamValue("axis",node,tensorMap,context);var tensor=utils_1.getParamValue("tensor",node,tensorMap,context);return tfc.unstack(tensor,axis)})}case"tile":{var reps=utils_1.getParamValue("reps",node,tensorMap,context);return[tfc.tile(utils_1.getParamValue("x",node,tensorMap,context),reps)]}case"split":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);var numOrSizeSplits=utils_1.getParamValue("numOrSizeSplits",node,tensorMap,context);return tfc.split(utils_1.getParamValue("x",node,tensorMap,context),numOrSizeSplits,axis)}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="slice_join"},{"./utils":29,"@tensorflow/tfjs-core":55}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tfc=require("@tensorflow/tfjs-core");var utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"cast":{return[tfc.cast(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))]}case"expandDims":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.expandDims(utils_1.getParamValue("x",node,tensorMap,context),axis)]}case"squeeze":{var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.squeeze(utils_1.getParamValue("x",node,tensorMap,context),axis)]}case"reshape":{return[tfc.reshape(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("shape",node,tensorMap,context))]}case"pad":{return[tfc.pad(utils_1.getParamValue("x",node,tensorMap,context),utils_1.split(utils_1.getParamValue("padding",node,tensorMap,context),2),utils_1.getParamValue("constantValue",node,tensorMap,context))]}case"spaceToBatchND":{var blockShape=utils_1.getParamValue("blockShape",node,tensorMap,context);var paddings=utils_1.split(utils_1.getParamValue("paddings",node,tensorMap,context),2);return[tfc.spaceToBatchND(utils_1.getParamValue("x",node,tensorMap,context),blockShape,paddings)]}case"batchToSpaceND":{var blockShape=utils_1.getParamValue("blockShape",node,tensorMap,context);var crops=utils_1.split(utils_1.getParamValue("crops",node,tensorMap,context),2);return[tfc.batchToSpaceND(utils_1.getParamValue("x",node,tensorMap,context),blockShape,crops)]}default:throw TypeError("Node type "+node.op+" is not implemented")}};exports.CATEGORY="transformation"},{"./utils":29,"@tensorflow/tfjs-core":55}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function getParamValue(paramName,node,tensorMap,context){var param=node.params[paramName];if(param&&param.inputIndex!==undefined){if(param.type==="tensor"){return getTensor(node.inputNames[param.inputIndex],tensorMap,context)}if(param.type==="tensors"){var inputs=param.inputIndex===0?param.inputParamLength===0?node.inputNames:node.inputNames.slice(param.inputIndex,-param.inputParamLength):node.inputNames.splice(param.inputIndex);return inputs.map(function(name){return getTensor(name,tensorMap,context)})}var data=Array.prototype.slice.call(getTensor(node.inputNames.slice(param.inputIndex)[0],tensorMap,context).dataSync());return param.type==="number"?data[0]:data}return param&&param.value}exports.getParamValue=getParamValue;function getTensor(name,tensorsMap,context){var _a=parseNodeName(name),nodeName=_a[0],index=_a[1];var contextId=context.currentContextIds.find(function(contextId){return!!tensorsMap[getNodeNameWithContextId(nodeName,contextId)]});return contextId!==undefined?tensorsMap[getNodeNameWithContextId(nodeName,contextId)][index]:undefined}exports.getTensor=getTensor;function getNodeNameAndIndex(inputName,context){var _a=parseNodeName(inputName),nodeName=_a[0],index=_a[1];return[getNodeNameWithContextId(nodeName,context&&context.currentContextId),index]}exports.getNodeNameAndIndex=getNodeNameAndIndex;function getNodeNameWithContextId(name,contextId){return!!contextId?name+"-"+contextId:name}function parseNodeName(name){var index=name.lastIndexOf(":");if(index===-1)return[name,0];var nodeName=name.substring(0,index);return[nodeName,Number(name.substring(index+1))]}exports.parseNodeName=parseNodeName;function split(arr,size){var res=[];for(var i=0;i<arr.length;i+=size){res.push(arr.slice(i,i+size))}return res}exports.split=split},{}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"Add",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"AddN",dlOpName:"addN",category:"arithmetic",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Sub",dlOpName:"sub",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"RealDiv",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Div",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"FloorDiv",dlOpName:"floorDiv",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Mul",dlOpName:"mul",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Maximum",dlOpName:"maximum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Minimum",dlOpName:"minimum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Pow",dlOpName:"pow",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"SquaredDifference",dlOpName:"squaredDifference",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Mod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"FloorMod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]}]},{}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"Abs",dlOpName:"abs",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Acos",dlOpName:"acos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Asin",dlOpName:"asin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"atan",dlOpName:"atan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Ceil",dlOpName:"ceil",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"ClipByValue",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"clip_value_min",dlParamName:"clipValueMin",type:"number"},{tfParamName:"clip_value_max",dlParamName:"clipValueMax",type:"number"}]},{tfOpName:"Cos",dlOpName:"cos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Cosh",dlOpName:"cosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Elu",dlOpName:"elu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Exp",dlOpName:"exp",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Floor",dlOpName:"floor",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Log",dlOpName:"log",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Neg",dlOpName:"neg",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Relu",dlOpName:"relu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Relu6",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true},{dlParamName:"clipValueMin",type:"number",defaultValue:0},{dlParamName:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",dlOpName:"selu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Sigmoid",dlOpName:"sigmoid",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Sin",dlOpName:"sin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Sinh",dlOpName:"sinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Sqrt",dlOpName:"sqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Rsqrt",dlOpName:"rsqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Square",dlOpName:"square",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Tan",dlOpName:"tan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Tanh",dlOpName:"tanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Sign",dlOpName:"sign",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Round",dlOpName:"round",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Expm1",dlOpName:"expm1",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Log1p",dlOpName:"log1p",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Softplus",dlOpName:"softplus",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Asinh",dlOpName:"asinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Acosh",dlOpName:"acosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Atanh",dlOpName:"atanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Erf",dlOpName:"erf",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]}]},{}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"LoopCond",dlOpName:"loopCond",category:"control",params:[{tfInputIndex:0,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Switch",dlOpName:"switch",category:"control",params:[{tfInputIndex:0,dlParamName:"data",type:"tensor"},{tfInputIndex:1,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Merge",dlOpName:"merge",category:"control",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"Enter",dlOpName:"enter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true},{tfParamName:"frame_name",dlParamName:"frameName",type:"string"},{tfParamName:"is_constant",dlParamName:"isConstant",type:"bool"}]},{tfOpName:"Exit",dlOpName:"exit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"NextIteration",dlOpName:"nextIteration",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"TensorArrayV3",dlOpName:"tensorArray",category:"control",params:[{tfInputIndex:0,dlParamName:"size",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"},{tfParamName:"dynamic_size",dlParamName:"dynamicSize",type:"bool"},{tfParamName:"clear_after_read",dlParamName:"clearAfterRead",type:"bool"},{tfParamName:"identical_element_shapes",dlParamName:"identicalElementShapes",type:"bool"},{tfParamName:"tensor_array_name",dlParamName:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",dlOpName:"tensorArrayWrite",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"TensorArrayReadV3",dlOpName:"tensorArrayRead",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"TensorArrayGatherV3",dlOpName:"tensorArrayGather",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",dlOpName:"tensorArrayScatter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",dlOpName:"tensorArrayConcat",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape_except0",dlParamName:"elementShapeExcept0",type:"shape",notSupported:true}]},{tfOpName:"TensorArraySplitV3",dlOpName:"tensorArraySplit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"tensor",type:"tensor"},{tfInputIndex:2,dlParamName:"lengths",type:"number[]"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",dlOpName:"tensorArraySize",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",dlOpName:"tensorArrayClose",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"}]}]},{}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"AvgPool",dlOpName:"avgPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:true},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"MaxPool",dlOpName:"maxPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:true},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Conv1D",dlOpName:"conv1d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"stride",dlParamName:"stride",type:"number"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NWC"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true},{tfParamName:"dilation",dlParamName:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",dlOpName:"conv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"useCudnnOnGpu",dlParamName:"useCudnnOnGpu",type:"bool"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"Conv2DBackpropInput",dlOpName:"conv2dTranspose",category:"convolution",params:[{tfInputIndex:2,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfInputIndex:0,dlParamName:"outputShape",type:"number[]"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:true}]},{tfOpName:"DepthwiseConv2d",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]}]},{}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"Fill",dlOpName:"fill",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfInputIndex:1,dlParamName:"value",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",dlOpName:"linspace",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"num",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"OneHot",dlOpName:"oneHot",category:"creation",params:[{tfInputIndex:0,dlParamName:"indices",type:"tensor"},{tfInputIndex:1,dlParamName:"depth",type:"number"},{tfInputIndex:2,dlParamName:"onValue",type:"number",defaultValue:1},{tfInputIndex:3,dlParamName:"offValue",type:"number",defaultValue:0},{tfParamName:"axis",dlParamName:"axis",type:"number",notSupported:true},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Ones",dlOpName:"ones",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",dlOpName:"onesLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",dlOpName:"randomUniform",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"minval",dlParamName:"minval",type:"number",defaultValue:0},{tfParamName:"maxval",dlParamName:"maxval",type:"number",defaultValue:1},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"seed",dlParamName:"seed",type:"number",defaultValue:0},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:true},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:true}]},{tfOpName:"Range",dlOpName:"range",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"step",type:"number",defaultValue:0},{tfParamName:"Tidx",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"truncatedNormal",dlOpName:"truncatedNormal",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"means",dlParamName:"mean",type:"number",defaultValue:0},{tfParamName:"stddev",dlParamName:"stdDev",type:"number",defaultValue:1},{tfParamName:"seed",dlParamName:"seed",type:"number"},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:true},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:true}]},{tfOpName:"Zeros",dlOpName:"zeros",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",dlOpName:"zerosLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]}]},{}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"NonMaxSuppressionV2",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"},{tfInputIndex:4,dlParamName:"scoreThreshold",type:"number"}]},{tfOpName:"Where",dlOpName:"whereAsync",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]}]},{}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"TopKV2",dlOpName:"topK",category:"evaluation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"k",type:"number"},{tfParamName:"sorted",dlParamName:"sorted",type:"bool"}]}]},{}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"PlaceholderWithDefault",dlOpName:"placeholder",category:"graph",params:[{tfInputIndex:0,dlParamName:"default",type:"tensor"},{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",dlOpName:"placeholder",category:"graph",params:[{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Const",dlOpName:"const",category:"graph"},{tfOpName:"Identity",dlOpName:"identity",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Snapshot",dlOpName:"snapshot",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Rank",dlOpName:"rank",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Size",dlOpName:"size",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Shape",dlOpName:"shape",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"ShapeN",dlOpName:"shapeN",category:"graph",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"x",type:"tensors"}]},{tfOpName:"Print",dlOpName:"print",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfInputParamLength:1,dlParamName:"data",type:"tensors"},{tfParamName:"message",dlParamName:"message",type:"string"},{tfParamName:"first_n",dlParamName:"firstN",type:"number",notSupprted:true},{tfParamName:"summarize",dlParamName:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",dlOpName:"noop",category:"graph",params:[]},{tfOpName:"StopGradient",dlOpName:"stopGradient",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",dlOpName:"fakeQuantWithMinMaxVars",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"min",dlParamName:"min",type:"number"},{tfParamName:"max",dlParamName:"max",type:"number"}]}]},{}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"ResizeBilinear",dlOpName:"resizeBilinear",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"ResizeNearestNeighbor",dlOpName:"resizeNearestNeighbor",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"CropAndResize",dlOpName:"cropAndResize",category:"image",params:[{tfInputIndex:0,dlParamName:"image",type:"tensor"},{tfInputIndex:1,dlParamName:"boxes",type:"tensor"},{tfInputIndex:2,dlParamName:"boxInd",type:"tensor"},{tfInputIndex:3,dlParamName:"cropSize",type:"number[]"},{tfParamName:"method",dlParamName:"method",type:"string"},{tfParamName:"extrapolation_value",dlParamName:"extrapolationValue",type:"number"}]}]},{}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"Equal",dlOpName:"equal",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"NotEqual",dlOpName:"notEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Greater",dlOpName:"greater",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"GreaterEqual",dlOpName:"greaterEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Less",dlOpName:"less",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"LessEqual",dlOpName:"lessEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"LogicalAnd",dlOpName:"logicalAnd",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"LogicalNot",dlOpName:"logicalNot",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"LogicalOr",dlOpName:"logicalOr",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Select",dlOpName:"where",category:"logical",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfInputIndex:1,dlParamName:"a",type:"tensor"},{tfInputIndex:2,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]}]},{}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"MatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"transpose_a",dlParamName:"transposeA",type:"bool",defaultValue:false},{tfParamName:"transpose_b",dlParamName:"transposeB",type:"bool",defaultValue:false},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"BatchMatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"adj_x",dlParamName:"transposeA",type:"bool",defaultValue:false},{tfParamName:"adj_y",dlParamName:"transposeB",type:"bool",defaultValue:false},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]},{tfOpName:"Transpose",dlOpName:"transpose",category:"matrices",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"perm",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:true}]}]},{}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"FusedBatchNorm",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:true}]},{tfOpName:"FusedBatchNormV2",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:true}]},{tfOpName:"LRN",dlOpName:"localResponseNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"depth_radius",dlParamName:"radius",type:"number",defaultValue:5},{tfParamName:"bias",dlParamName:"bias",type:"number",defaultValue:1},{tfParamName:"alpha",dlParamName:"alpha",type:"number",defaultValue:1},{tfParamName:"beta",dlParamName:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",dlOpName:"softmax",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]}]},{}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"Max",dlOpName:"max",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Mean",dlOpName:"mean",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Min",dlOpName:"min",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Sum",dlOpName:"sum",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"All",dlOpName:"all",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Any",dlOpName:"any",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",dlOpName:"argMax",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ArgMin",dlOpName:"argMin",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]}]},{}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"ConcatV2",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:-1,dlParamName:"axis",type:"number"}]},{tfOpName:"Concat",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:1,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:0,dlParamName:"axis",type:"number"}]},{tfOpName:"GatherV2",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",notSupported:true}]},{tfOpName:"Reverse",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ReverseV2",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"Slice",dlOpName:"slice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"size",type:"number[]"}]},{tfOpName:"StridedSlice",dlOpName:"stridedSlice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"end",type:"number[]"},{tfInputIndex:3,dlParamName:"strides",type:"number[]"},{tfParamName:"begin_mask",dlParamName:"beginMask",type:"number",defaultValue:0},{tfParamName:"end_mask",dlParamName:"endMask",type:"number",defaultValue:0},{tfParamName:"new_axis_mask",dlParamName:"newAxisMask",type:"number",defaultValue:0},{tfParamName:"ellipsis_mask",dlParamName:"ellipsisMask",type:"number",defaultValue:0},{tfParamName:"shrink_axis_mask",dlParamName:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",dlOpName:"stack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",dlOpName:"unstack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"num",dlParamName:"num",type:"number",defaultValue:0,notSupported:true}]},{tfOpName:"Tile",dlOpName:"tile",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"reps",type:"number[]"}]},{tfOpName:"Split",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"axis",type:"number",defaultValue:0},{tfInputIndex:1,dlParamName:"x",type:"tensor"},{tfParamName:"num_split",dlParamName:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"numOrSizeSplits",type:"number[]"},{tfInputIndex:2,dlParamName:"axis",type:"number",defaultValue:0}]}]},{}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.json=[{tfOpName:"Cast",dlOpName:"cast",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"SrcT",dlParamName:"sdtype",type:"dtype",notSupported:true},{tfParamName:"DstT",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",dlOpName:"expandDims",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfParamNameDeprecated:"dim",dlParamName:"axis",type:"number"}]},{tfOpName:"Pad",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfParamName:"constant_value",dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfInputIndex:2,dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",dlOpName:"reshape",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"shape",type:"number[]"}]},{tfOpName:"Squeeze",dlOpName:"squeeze",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"axis",tfParamNameDeprecated:"squeeze_dims",dlParamName:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",dlOpName:"spaceToBatchND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",dlOpName:"batchToSpaceND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"crops",type:"number[]"}]}]},{}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var arithmetic=require("./executors/arithmetic_executor");var basicMath=require("./executors/basic_math_executor");var control=require("./executors/control_executor");var convolution=require("./executors/convolution_executor");var creation=require("./executors/creation_executor");var dynamic=require("./executors/dynamic_executor");var evaluation=require("./executors/evaluation_executor");var graph=require("./executors/graph_executor");var image=require("./executors/image_executor");var logical=require("./executors/logical_executor");var matrices=require("./executors/matrices_executor");var normalization=require("./executors/normalization_executor");var reduction=require("./executors/reduction_executor");var sliceJoin=require("./executors/slice_join_executor");var transformation=require("./executors/transformation_executor");function executeOp(node,tensorMap,context){switch(node.category){case"arithmetic":return arithmetic.executeOp(node,tensorMap,context);case"basic_math":return basicMath.executeOp(node,tensorMap,context);case"control":return control.executeOp(node,tensorMap,context);case"convolution":return convolution.executeOp(node,tensorMap,context);case"creation":return creation.executeOp(node,tensorMap,context);case"dynamic":return dynamic.executeOp(node,tensorMap,context);case"evaluation":return evaluation.executeOp(node,tensorMap,context);case"image":return image.executeOp(node,tensorMap,context);case"graph":return graph.executeOp(node,tensorMap,context);case"logical":return logical.executeOp(node,tensorMap,context);case"matrices":return matrices.executeOp(node,tensorMap,context);case"normalization":return normalization.executeOp(node,tensorMap,context);case"reduction":return reduction.executeOp(node,tensorMap,context);case"slice_join":return sliceJoin.executeOp(node,tensorMap,context);case"transformation":return transformation.executeOp(node,tensorMap,context);default:throw TypeError("Node type "+node.op+" is not implemented")}}exports.executeOp=executeOp},{"./executors/arithmetic_executor":14,"./executors/basic_math_executor":15,"./executors/control_executor":16,"./executors/convolution_executor":17,"./executors/creation_executor":18,"./executors/dynamic_executor":19,"./executors/evaluation_executor":20,"./executors/graph_executor":21,"./executors/image_executor":22,"./executors/logical_executor":23,"./executors/matrices_executor":24,"./executors/normalization_executor":25,"./executors/reduction_executor":26,"./executors/slice_join_executor":27,"./executors/transformation_executor":28}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var compiled_api_1=require("../data/compiled_api");var utils_1=require("./executors/utils");var arithmetic=require("./op_list/arithmetic");var basicMath=require("./op_list/basic_math");var control=require("./op_list/control");var convolution=require("./op_list/convolution");var creation=require("./op_list/creation");var dynamic=require("./op_list/dynamic");var evaluation=require("./op_list/evaluation");var graph=require("./op_list/graph");var image=require("./op_list/image");var logical=require("./op_list/logical");var matrices=require("./op_list/matrices");var normalization=require("./op_list/normalization");var reduction=require("./op_list/reduction");var sliceJoin=require("./op_list/slice_join");var transformation=require("./op_list/transformation");var CONTROL_FLOW_OPS=["Switch","Merge","Enter","Exit","NextIteration"];var DYNAMIC_SHAPE_OPS=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"];var OperationMapper=function(){function OperationMapper(){var ops=[arithmetic,basicMath,control,convolution,creation,dynamic,evaluation,logical,image,graph,matrices,normalization,reduction,sliceJoin,transformation];var mappersJson=[].concat.apply([],ops.map(function(op){return op.json}));this.opMappers=mappersJson.reduce(function(map,mapper){map[mapper.tfOpName]=mapper;return map},{})}Object.defineProperty(OperationMapper,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:true,configurable:true});OperationMapper.prototype.isControlFlow=function(node){return CONTROL_FLOW_OPS.some(function(op){return op===node.op})};OperationMapper.prototype.isDynamicShape=function(node){return DYNAMIC_SHAPE_OPS.some(function(op){return op===node.op})};OperationMapper.prototype.transformGraph=function(graph){var _this=this;var tfNodes=graph.node;var withControlFlow=false;var withDynamicShape=false;var placeholders=[];var weights=[];var nodes=tfNodes.reduce(function(map,node){map[node.name]=_this.mapNode(node);if(_this.isControlFlow(node))withControlFlow=true;if(_this.isDynamicShape(node))withDynamicShape=true;if(node.op==="Placeholder")placeholders.push(map[node.name]);if(node.op==="Const")weights.push(map[node.name]);return map},{});var inputs=[];var outputs=[];Object.keys(nodes).forEach(function(key){var node=nodes[key];node.inputNames.forEach(function(name){var nodeName=utils_1.getNodeNameAndIndex(name)[0];node.inputs.push(nodes[nodeName]);nodes[nodeName].children.push(node)});if(node.inputs.length===0)inputs.push(node)});Object.keys(nodes).forEach(function(key){var node=nodes[key];if(node.children.length===0)outputs.push(node)});return{nodes:nodes,inputs:inputs,outputs:outputs,weights:weights,placeholders:placeholders,withControlFlow:withControlFlow,withDynamicShape:withDynamicShape}};OperationMapper.prototype.mapNode=function(node){var _this=this;var mapper=this.opMappers[node.op];if(mapper===undefined){throw new Error("Tensorflow Op is not supported: "+node.op)}var newNode={name:node.name,op:mapper.dlOpName,category:mapper.category,inputNames:(node.input||[]).map(function(input){return input.startsWith("^")?input.substr(1):input}),inputs:[],children:[],params:{}};if(!!mapper.params){newNode.params=mapper.params.reduce(function(map,param){var inputIndex=param.tfInputIndex;var inputParamLength=param.tfInputParamLength;var type=param.type;var value=undefined;if(inputIndex===undefined){switch(param.type){case"string":value=_this.getStringParam(node.attr,param.tfParamName,param.defaultValue);if(value===undefined&&!!param.tfParamNameDeprecated){value=_this.getStringParam(node.attr,param.tfParamNameDeprecated,param.defaultValue)}break;case"number":value=_this.getNumberParam(node.attr,param.tfParamName,param.defaultValue);if(value===undefined&&!!param.tfParamNameDeprecated){value=_this.getNumberParam(node.attr,param.tfParamNameDeprecated,param.defaultValue)}break;case"number[]":value=_this.getNumericArrayParam(node.attr,param.tfParamName,param.defaultValue);if(value===undefined&&!!param.tfParamNameDeprecated){value=_this.getNumericArrayParam(node.attr,param.tfParamNameDeprecated,param.defaultValue)}break;case"bool":value=_this.getBoolParam(node.attr,param.tfParamName,param.defaultValue);if(value===undefined&&!!param.tfParamNameDeprecated){value=_this.getBoolParam(node.attr,param.tfParamNameDeprecated,param.defaultValue)}break;case"shape":value=_this.getTensorShapeParam(node.attr,param.tfParamName,param.defaultValue);if(value===undefined&&!!param.tfParamNameDeprecated){value=_this.getTensorShapeParam(node.attr,param.tfParamNameDeprecated,param.defaultValue)}break;case"dtype":value=_this.getDtypeParam(node.attr,param.tfParamName,param.defaultValue);if(value===undefined&&!!param.tfParamNameDeprecated){value=_this.getDtypeParam(node.attr,param.tfParamNameDeprecated,param.defaultValue)}break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+param.type+" for op: "+node.op)}}map[param.dlParamName]={value:value,inputIndex:inputIndex,type:type,inputParamLength:inputParamLength};return map},{})}return newNode};OperationMapper.prototype.getStringParam=function(attrs,name,def,keepCase){if(keepCase===void 0){keepCase=false}var param=attrs[name];if(param!==undefined){var value=String.fromCharCode.apply(null,param.s);return keepCase?value:value.toLowerCase()}return def};OperationMapper.prototype.getBoolParam=function(attrs,name,def){var param=attrs[name];return param?param.b:def};OperationMapper.prototype.getNumberParam=function(attrs,name,def){var param=attrs[name];var value=param?param[param.value]:def;return typeof value==="number"?value:value["toInt"]()};OperationMapper.prototype.getDtypeParam=function(attrs,name,def){var param=attrs[name];if(param&&param.type){switch(param.type){case compiled_api_1.tensorflow.DataType.DT_FLOAT:return"float32";case compiled_api_1.tensorflow.DataType.DT_INT32:return"int32";case compiled_api_1.tensorflow.DataType.DT_BOOL:return"bool";default:return def}}return def};OperationMapper.prototype.getTensorShapeParam=function(attrs,name,def){var param=attrs[name];if(param&&param.shape){return param.shape.dim.map(function(dim){return typeof dim.size==="number"?dim.size:dim.size["toInt"]()})}return def};OperationMapper.prototype.getNumericArrayParam=function(attrs,name,def){var param=attrs[name];if(param){return(param.list.f&&param.list.f.length?param.list.f:param.list.i).map(function(v){return typeof v==="number"?v:v["toInt"]()})}return def};return OperationMapper}();exports.OperationMapper=OperationMapper},{"../data/compiled_api":8,"./executors/utils":29,"./op_list/arithmetic":30,"./op_list/basic_math":31,"./op_list/control":32,"./op_list/convolution":33,"./op_list/creation":34,"./op_list/dynamic":35,"./op_list/evaluation":36,"./op_list/graph":37,"./op_list/image":38,"./op_list/logical":39,"./op_list/matrices":40,"./op_list/normalization":41,"./op_list/reduction":42,"./op_list/slice_join":43,"./op_list/transformation":44}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var version="0.6.1";exports.version=version},{}],48:[function(require,module,exports){(function(setImmediate){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var delayCallback=typeof requestAnimationFrame!=="undefined"?requestAnimationFrame:setImmediate;function nextFrame(){return new Promise(function(resolve){return delayCallback(function(){return resolve()})})}exports.nextFrame=nextFrame}).call(this,require("timers").setImmediate)},{timers:264}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function isMobile(){var a=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))}exports.isMobile=isMobile},{}],50:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var profiler_1=require("./profiler");var tape_1=require("./tape");var tensor_1=require("./tensor");var tensor_util_1=require("./tensor_util");var util=require("./util");var util_1=require("./util");var Engine=function(){function Engine(backend,safeMode,debugMode){this.backend=backend;this.safeMode=safeMode;this.debugMode=debugMode;this.registeredVariables={};this.nextTapeNodeId=0;this.numBytes=0;this.numTensors=0;this.numDataBuffers=0;this.profiling=false;this.gradientScopeCount=0;this.customGradientDepth=0;this.keepTensors=new Set;this.tensorInfo=new WeakMap;this.activeScope={track:[],name:"default scope"};this.scopeStack=[this.activeScope];this.profiler=new profiler_1.Profiler(backend);this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}Engine.prototype.moveData=function(dataId){this.write(dataId,this.readSync(dataId))};Engine.prototype.tidy=function(nameOrFn,fn,gradMode){var _this=this;if(gradMode===void 0){gradMode=false}var name=null;if(fn==null){if(typeof nameOrFn!=="function"){throw new Error("Please provide a function to tidy()")}fn=nameOrFn}else{if(typeof nameOrFn!=="string"&&!(nameOrFn instanceof String)){throw new Error("When calling with two arguments, the first argument "+"to tidy() must be a string")}if(typeof fn!=="function"){throw new Error("When calling with two arguments, the 2nd argument "+"to tidy() must be a function")}name=nameOrFn}var result;return this.scopedRun(function(){return _this.startScope(name,gradMode)},function(){return _this.endScope(result,gradMode)},function(){result=fn();if(result instanceof Promise){console.error("Cannot return a Promise inside of tidy.")}return result})};Engine.prototype.scopedRun=function(start,end,f){start();try{var res=f();end();return res}catch(ex){end();throw ex}};Engine.prototype.runKernel=function(forwardFunc,inputs,backwardsFunc){var _this=this;var result;var saved=[];var saveFunc=function(x){saved.push(x);return x};var scopeName=this.activeScope.name;var startingBytecount=this.numBytes;var startingNumTensors=this.numTensors;this.scopedRun(function(){return _this.customGradientDepth++},function(){return _this.customGradientDepth--},function(){if(!_this.debugMode()){result=forwardFunc(_this.backend,saveFunc)}else{result=_this.profiler.profileKernel(scopeName,function(){return forwardFunc(_this.backend,saveFunc)})}});if(this.shouldRecord()){var tapeNode={id:this.nextTapeNodeId++,name:scopeName,inputs:inputs,outputs:Array.isArray(result)?result:[result]};if(backwardsFunc!=null){tapeNode.gradient=function(dy){return backwardsFunc(dy,saved)}}this.activeTape.push(tapeNode)}if(this.profiling){this.activeProfile.kernels.push({name:scopeName,bytesAdded:this.numBytes-startingBytecount,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-startingNumTensors,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(inputs).map(function(key){return inputs[key].shape}),outputShape:Array.isArray(result)?result.map(function(item){return item.shape}):result.shape})}return result};Engine.prototype.registerTensor=function(a){var refCount=this.tensorInfo.has(a.dataId)?this.tensorInfo.get(a.dataId).refCount:0;this.numTensors++;if(refCount===0){this.numDataBuffers++;if(a.dtype!=="complex64"){this.numBytes+=util.sizeFromShape(a.shape)*util.bytesPerElement(a.dtype)}this.tensorInfo.set(a.dataId,{backend:this.backend,dtype:a.dtype,shape:a.shape,refCount:0});this.backend.register(a.dataId,a.shape,a.dtype)}this.tensorInfo.get(a.dataId).refCount++;if(!(a instanceof tensor_1.Variable)){this.track(a)}};Engine.prototype.registerVariable=function(v){if(this.registeredVariables[v.name]!=null){throw new Error("Variable with name "+v.name+" was already registered")}this.registeredVariables[v.name]=v};Engine.prototype.disposeTensor=function(a){if(!this.tensorInfo.has(a.dataId)){return}if(this.keepTensors.has(a.id)){this.keepTensors.delete(a.id)}this.numTensors--;var refCount=this.tensorInfo.get(a.dataId).refCount;if(refCount<=1){var info=this.tensorInfo.get(a.dataId);info.backend.disposeData(a.dataId);this.numDataBuffers--;if(a.dtype!=="complex64"){this.numBytes-=util.sizeFromShape(a.shape)*util.bytesPerElement(a.dtype)}this.tensorInfo.delete(a.dataId)}else{this.tensorInfo.get(a.dataId).refCount--}};Engine.prototype.disposeVariables=function(){for(var varName in this.registeredVariables){var v=this.registeredVariables[varName];this.disposeTensor(v);delete this.registeredVariables[varName]}};Engine.prototype.memory=function(){var info=this.backend.memory();info.numTensors=this.numTensors;info.numDataBuffers=this.numDataBuffers;info.numBytes=this.numBytes;return info};Engine.prototype.profile=function(query){return __awaiter(this,void 0,void 0,function(){var startBytes,startNumTensors;return __generator(this,function(_a){this.profiling=true;startBytes=this.numBytes;startNumTensors=this.numTensors;this.activeProfile.kernels=[];this.activeProfile.result=query();this.profiling=false;this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot}));this.activeProfile.newBytes=this.numBytes-startBytes;this.activeProfile.newTensors=this.numTensors-startNumTensors;return[2,this.activeProfile]})})};Engine.prototype.shouldRecord=function(){return this.activeTape!=null&&this.customGradientDepth===0};Engine.prototype.addTapeNode=function(inputs,result,gradientsFunc){var inputsMap={};inputs.forEach(function(input,idx){inputsMap[idx]=input});var gradient=function(dy){var res=gradientsFunc(dy);var resMap={};res.forEach(function(r,idx){resMap[idx]=function(){return r}});return resMap};var tapeNode={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:inputsMap,outputs:[result],gradient:gradient};this.activeTape.push(tapeNode)};Engine.prototype.keep=function(result){if(this.scopeStack.length===1&&this.safeMode){throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): "+"tf.tidy(() => {...}) to avoid memory leaks.")}this.keepTensors.add(result.id);return result};Engine.prototype.startScope=function(name,gradientsMode){if(gradientsMode===void 0){gradientsMode=false}if(gradientsMode&&this.gradientScopeCount===0){this.activeTape=[]}if(gradientsMode){this.gradientScopeCount++}var scopeInfo={track:[],name:"unnamed scope"};if(name){scopeInfo.name=name}this.scopeStack.push(scopeInfo);this.activeScope=scopeInfo};Engine.prototype.endScope=function(result,gradientsMode){var _this=this;if(gradientsMode===void 0){gradientsMode=false}if(gradientsMode){this.gradientScopeCount--;if(this.gradientScopeCount===0){this.activeTape=null}}var tensorsToKeep=new Set(this.keepTensors);var tensorsToTrackInParent=tensor_util_1.getTensorsInContainer(result);tensorsToTrackInParent.forEach(function(tensor){return tensorsToKeep.add(tensor.id)});for(var i=0;i<this.activeScope.track.length;i++){var tensor=this.activeScope.track[i];if(tensorsToKeep.has(tensor.id)){continue}if(this.activeTape!=null){tensorsToTrackInParent.push(tensor)}else{tensor.dispose()}}var oldScope=this.scopeStack.pop();this.activeScope=this.scopeStack.length===0?{track:[],name:"default scope"}:this.scopeStack[this.scopeStack.length-1];tensorsToTrackInParent.forEach(function(tensor){if(!_this.keepTensors.has(tensor.id)&&tensor_util_1.isTensorInList(tensor,oldScope.track)){_this.track(tensor)}})};Engine.prototype.gradients=function(f,xs,dy,allowNoGradients){var _this=this;if(allowNoGradients===void 0){allowNoGradients=false}util.assert(xs.length>0,"gradients() received an empty list of xs.");return this.tidy("gradients",function(){var y=f();util.assert(y instanceof tensor_1.Tensor,"The result y returned by f() must be a tensor.");var filteredTape=tape_1.getFilteredNodesXToY(_this.activeTape,xs,y);if(!allowNoGradients&&filteredTape.length===0&&xs.length>0){throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure "+"that the f you passed encloses all operations that lead from x "+"to y.")}var accumulatedGradientMap={};accumulatedGradientMap[y.id]=dy==null?ones(y.shape):dy;tape_1.backpropagateGradients(accumulatedGradientMap,filteredTape);var grads=xs.map(function(x){return accumulatedGradientMap[x.id]});return{value:y,grads:grads}},true)};Engine.prototype.customGrad=function(f){var _this=this;util.assert(util.isFunction(f),"The f passed in customGrad(f) must be a function.");return function(){var inputs=[];for(var _i=0;_i<arguments.length;_i++){inputs[_i]=arguments[_i]}util.assert(inputs.every(function(t){return t instanceof tensor_1.Tensor}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors");var gradientsFunc;var result;_this.scopedRun(function(){return _this.customGradientDepth++},function(){return _this.customGradientDepth--},function(){var gradientsMode=true;result=_this.tidy(f.name,function(){var _a=f.apply(void 0,inputs),value=_a.value,gradFunc=_a.gradFunc;util.assert(value instanceof tensor_1.Tensor,"The function f passed in customGrad(f) must return an "+"object where `obj.value` is a tensor");util.assert(util.isFunction(gradFunc),"The function f passed in customGrad(f) must return an "+"object where `obj.gradFunc` is a function.");gradientsFunc=gradFunc;return value},gradientsMode)});if(_this.shouldRecord()){var gradFunc=function(dy){var res=gradientsFunc(dy);var grads=Array.isArray(res)?res:[res];util.assert(grads.length===inputs.length,"The function f passed in customGrad(f) must return an object "+"where `obj.gradFunc` is a function that returns the same "+"number of tensors as inputs passed to f(...).");util.assert(grads.every(function(t){return t instanceof tensor_1.Tensor}),"The function f passed in customGrad(f) must return an object "+"where `obj.gradFunc` is a function that returns a list of "+"only tensors.");return grads};_this.addTapeNode(inputs,result,gradFunc)}return result}};Engine.prototype.write=function(dataId,values){var info=this.tensorInfo.get(dataId);if(this.backend!==info.backend){info.backend.disposeData(dataId);info.backend=this.backend;this.backend.register(dataId,info.shape,info.dtype)}this.backend.write(dataId,values)};Engine.prototype.readSync=function(dataId){var info=this.tensorInfo.get(dataId);return info.backend.readSync(dataId)};Engine.prototype.read=function(dataId){var info=this.tensorInfo.get(dataId);return info.backend.read(dataId)};Engine.prototype.fromPixels=function(pixels,numChannels){return this.backend.fromPixels(pixels,numChannels)};Engine.prototype.time=function(query){return __awaiter(this,void 0,void 0,function(){var start,timingInfo;return __generator(this,function(_a){switch(_a.label){case 0:start=util_1.now();return[4,this.backend.time(query)];case 1:timingInfo=_a.sent();timingInfo.wallMs=util_1.now()-start;return[2,timingInfo]}})})};Engine.prototype.track=function(result){if(this.scopeStack.length===1&&this.safeMode){throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): "+"tf.tidy(() => {op();...}); to avoid memory leaks.")}this.activeScope.track.push(result);return result};return Engine}();exports.Engine=Engine;function ones(shape){var values=util_1.makeOnesTypedArray(util_1.sizeFromShape(shape),"float32");return tensor_1.Tensor.make(shape,{values:values})}},{"./profiler":175,"./tape":177,"./tensor":178,"./tensor_util":180,"./util":185}],51:[function(require,module,exports){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var device_util=require("./device_util");var engine_1=require("./engine");var environment_util_1=require("./environment_util");var tensor_1=require("./tensor");var tensor_util_1=require("./tensor_util");var EPSILON_FLOAT16=.001;var TEST_EPSILON_FLOAT16=.1;var EPSILON_FLOAT32=1e-7;var TEST_EPSILON_FLOAT32=.001;var Environment=function(){function Environment(features){this.features={};this.registry={};if(features!=null){this.features=features}if(this.get("DEBUG")){console.warn("Debugging mode is ON. The output of every math call will "+"be downloaded to CPU and checked for NaNs. "+"This significantly impacts performance.")}}Environment.setBackend=function(backendName,safeMode){if(safeMode===void 0){safeMode=false}if(!(backendName in exports.ENV.registry)){throw new Error("Backend name '"+backendName+"' not found in registry")}exports.ENV.engine.backend=exports.ENV.findBackend(backendName);exports.ENV.backendName=backendName};Environment.getBackend=function(){exports.ENV.initEngine();return exports.ENV.backendName};Environment.disposeVariables=function(){exports.ENV.engine.disposeVariables()};Environment.memory=function(){return exports.ENV.engine.memory()};Environment.profile=function(f){return exports.ENV.engine.profile(f)};Environment.tidy=function(nameOrFn,fn,gradMode){if(gradMode===void 0){gradMode=false}return exports.ENV.engine.tidy(nameOrFn,fn,gradMode)};Environment.dispose=function(container){var tensors=tensor_util_1.getTensorsInContainer(container);tensors.forEach(function(tensor){return tensor.dispose()})};Environment.keep=function(result){return exports.ENV.engine.keep(result)};Environment.time=function(f){return exports.ENV.engine.time(f)};Environment.prototype.get=function(feature){if(feature in this.features){return this.features[feature]}this.features[feature]=this.evaluateFeature(feature);return this.features[feature]};Environment.prototype.getFeatures=function(){return this.features};Environment.prototype.set=function(feature,value){this.features[feature]=value};Environment.prototype.getBestBackendName=function(){var _this=this;if(Object.keys(this.registry).length===0){throw new Error("No backend found in registry.")}var sortedBackends=Object.keys(this.registry).map(function(name){return{name:name,entry:_this.registry[name]}}).sort(function(a,b){return b.entry.priority-a.entry.priority});return sortedBackends[0].name};Environment.prototype.evaluateFeature=function(feature){if(feature==="DEBUG"){return false}else if(feature==="IS_BROWSER"){return typeof window!=="undefined"}else if(feature==="IS_NODE"){return typeof process!=="undefined"&&typeof process.versions.node!=="undefined"}else if(feature==="IS_CHROME"){return environment_util_1.isChrome()}else if(feature==="WEBGL_PAGING_ENABLED"){return this.get("IS_BROWSER")}else if(feature==="IS_TEST"){return false}else if(feature==="BACKEND"){return this.getBestBackendName()}else if(feature==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"){var webGLVersion=this.get("WEBGL_VERSION");if(webGLVersion===0){return 0}return environment_util_1.getWebGLDisjointQueryTimerVersion(webGLVersion,this.get("IS_BROWSER"))}else if(feature==="WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"){return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!device_util.isMobile()}else if(feature==="HAS_WEBGL"){return this.get("WEBGL_VERSION")>0}else if(feature==="WEBGL_VERSION"){if(environment_util_1.isWebGLVersionEnabled(2,this.get("IS_BROWSER"))){return 2}else if(environment_util_1.isWebGLVersionEnabled(1,this.get("IS_BROWSER"))){return 1}return 0}else if(feature==="WEBGL_RENDER_FLOAT32_ENABLED"){return environment_util_1.isRenderToFloatTextureEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"))}else if(feature==="WEBGL_DOWNLOAD_FLOAT_ENABLED"){return environment_util_1.isDownloadFloatTextureEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"))}else if(feature==="WEBGL_FENCE_API_ENABLED"){return environment_util_1.isWebGLFenceEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"))}else if(feature==="TEST_EPSILON"){return this.backend.floatPrecision()===32?TEST_EPSILON_FLOAT32:TEST_EPSILON_FLOAT16}else if(feature==="EPSILON"){return this.backend.floatPrecision()===32?EPSILON_FLOAT32:EPSILON_FLOAT16}throw new Error("Unknown feature "+feature+".")};Environment.prototype.setFeatures=function(features){this.features=Object.assign({},features)};Environment.prototype.reset=function(){this.features=environment_util_1.getFeaturesFromURL();if(this.globalEngine!=null){this.globalEngine=null}};Object.defineProperty(Environment.prototype,"backend",{get:function(){return this.engine.backend},enumerable:true,configurable:true});Environment.prototype.findBackend=function(name){if(!(name in this.registry)){return null}return this.registry[name].backend};Environment.prototype.registerBackend=function(name,factory,priority,setTensorTrackerFn){var _this=this;if(priority===void 0){priority=1}if(name in this.registry){console.warn(name+" backend was already registered. Reusing existing backend");if(setTensorTrackerFn!=null){setTensorTrackerFn(function(){return _this.engine})}return false}try{var backend=factory();backend.setDataMover({moveData:function(dataId){return _this.engine.moveData(dataId)}});this.registry[name]={backend:backend,priority:priority};return true}catch(err){console.warn("Registration of backend "+name+" failed");console.warn(err.stack||err.message);return false}};Environment.prototype.removeBackend=function(name){if(!(name in this.registry)){throw new Error(name+" backend not found in registry")}this.registry[name].backend.dispose();delete this.registry[name]};Object.defineProperty(Environment.prototype,"engine",{get:function(){this.initEngine();return this.globalEngine},enumerable:true,configurable:true});Environment.prototype.initEngine=function(){var _this=this;if(this.globalEngine==null){this.backendName=this.get("BACKEND");var backend=this.findBackend(this.backendName);this.globalEngine=new engine_1.Engine(backend,false,function(){return _this.get("DEBUG")})}};return Environment}();exports.Environment=Environment;function getGlobalNamespace(){var ns;if(typeof window!=="undefined"){ns=window}else if(typeof process!=="undefined"){ns=process}else{throw new Error("Could not find a global object")}return ns}function getOrMakeEnvironment(){var ns=getGlobalNamespace();if(ns.ENV==null){ns.ENV=new Environment(environment_util_1.getFeaturesFromURL());tensor_1.setTensorTracker(function(){return ns.ENV.engine})}return ns.ENV}exports.ENV=getOrMakeEnvironment()}).call(this,require("_process"))},{"./device_util":49,"./engine":50,"./environment_util":52,"./tensor":178,"./tensor_util":180,_process:244}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Type;(function(Type){Type[Type["NUMBER"]=0]="NUMBER";Type[Type["BOOLEAN"]=1]="BOOLEAN";Type[Type["STRING"]=2]="STRING"})(Type=exports.Type||(exports.Type={}));exports.URL_PROPERTIES=[{name:"DEBUG",type:Type.BOOLEAN},{name:"IS_BROWSER",type:Type.BOOLEAN},{name:"WEBGL_PAGING_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Type.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Type.BOOLEAN},{name:"WEBGL_VERSION",type:Type.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:Type.BOOLEAN},{name:"BACKEND",type:Type.STRING},{name:"EPSILON",type:Type.NUMBER}];function isWebGLVersionEnabled(webGLVersion,isBrowser){var gl;try{gl=getWebGLRenderingContext(webGLVersion,isBrowser)}catch(e){return false}if(gl!=null){loseContext(gl);return true}return false}exports.isWebGLVersionEnabled=isWebGLVersionEnabled;function getWebGLDisjointQueryTimerVersion(webGLVersion,isBrowser){if(webGLVersion===0){return 0}var queryTimerVersion;var gl=getWebGLRenderingContext(webGLVersion,isBrowser);if(hasExtension(gl,"EXT_disjoint_timer_query_webgl2")&&webGLVersion===2){queryTimerVersion=2}else if(hasExtension(gl,"EXT_disjoint_timer_query")){queryTimerVersion=1}else{queryTimerVersion=0}if(gl!=null){loseContext(gl)}return queryTimerVersion}exports.getWebGLDisjointQueryTimerVersion=getWebGLDisjointQueryTimerVersion;function isRenderToFloatTextureEnabled(webGLVersion,isBrowser){if(webGLVersion===0){return false}var gl=getWebGLRenderingContext(webGLVersion,isBrowser);if(webGLVersion===1){if(!hasExtension(gl,"OES_texture_float")){return false}}else{if(!hasExtension(gl,"EXT_color_buffer_float")){return false}}var isFrameBufferComplete=createFloatTextureAndBindToFramebuffer(gl,webGLVersion);loseContext(gl);return isFrameBufferComplete}exports.isRenderToFloatTextureEnabled=isRenderToFloatTextureEnabled;function isDownloadFloatTextureEnabled(webGLVersion,isBrowser){if(webGLVersion===0){return false}var gl=getWebGLRenderingContext(webGLVersion,isBrowser);if(webGLVersion===1){if(!hasExtension(gl,"OES_texture_float")){return false}if(!hasExtension(gl,"WEBGL_color_buffer_float")){return false}}else{if(!hasExtension(gl,"EXT_color_buffer_float")){return false}}var isFrameBufferComplete=createFloatTextureAndBindToFramebuffer(gl,webGLVersion);loseContext(gl);return isFrameBufferComplete}exports.isDownloadFloatTextureEnabled=isDownloadFloatTextureEnabled;function isWebGLFenceEnabled(webGLVersion,isBrowser){if(webGLVersion!==2){return false}var gl=getWebGLRenderingContext(webGLVersion,isBrowser);var isEnabled=gl.fenceSync!=null;loseContext(gl);return isEnabled}exports.isWebGLFenceEnabled=isWebGLFenceEnabled;function isChrome(){return typeof navigator!=="undefined"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}exports.isChrome=isChrome;var TENSORFLOWJS_FLAGS_PREFIX="tfjsflags";function getFeaturesFromURL(){var features={};if(typeof window==="undefined"||typeof window.location==="undefined"){return features}var urlParams=getQueryParams(window.location.search);if(TENSORFLOWJS_FLAGS_PREFIX in urlParams){var urlFlags_1={};var keyValues=urlParams[TENSORFLOWJS_FLAGS_PREFIX].split(",");keyValues.forEach(function(keyValue){var _a=keyValue.split(":"),key=_a[0],value=_a[1];urlFlags_1[key]=value});exports.URL_PROPERTIES.forEach(function(urlProperty){if(urlProperty.name in urlFlags_1){console.log("Setting feature override from URL "+urlProperty.name+": "+(""+urlFlags_1[urlProperty.name]));if(urlProperty.type===Type.NUMBER){features[urlProperty.name]=+urlFlags_1[urlProperty.name]}else if(urlProperty.type===Type.BOOLEAN){features[urlProperty.name]=urlFlags_1[urlProperty.name]==="true"}else if(urlProperty.type===Type.STRING){features[urlProperty.name]=urlFlags_1[urlProperty.name]}else{console.warn("Unknown URL param: "+urlProperty.name+".")}}})}return features}exports.getFeaturesFromURL=getFeaturesFromURL;function hasExtension(gl,extensionName){var ext=gl.getExtension(extensionName);return ext!=null}function getWebGLRenderingContext(webGLVersion,isBrowser){if(webGLVersion===0||!isBrowser){throw new Error("Cannot get WebGL rendering context, WebGL is disabled.")}var tempCanvas=document.createElement("canvas");if(webGLVersion===1){return tempCanvas.getContext("webgl")||tempCanvas.getContext("experimental-webgl")}return tempCanvas.getContext("webgl2")}function loseContext(gl){if(gl!=null){var loseContextExtension=gl.getExtension("WEBGL_lose_context");if(loseContextExtension==null){throw new Error("Extension WEBGL_lose_context not supported on this browser.")}loseContextExtension.loseContext()}}function createFloatTextureAndBindToFramebuffer(gl,webGLVersion){var frameBuffer=gl.createFramebuffer();var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);var internalFormat=webGLVersion===2?gl.RGBA32F:gl.RGBA;gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,1,1,0,gl.RGBA,gl.FLOAT,null);gl.bindFramebuffer(gl.FRAMEBUFFER,frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);var isFrameBufferComplete=gl.checkFramebufferStatus(gl.FRAMEBUFFER)===gl.FRAMEBUFFER_COMPLETE;gl.bindTexture(gl.TEXTURE_2D,null);gl.bindFramebuffer(gl.FRAMEBUFFER,null);gl.deleteTexture(texture);gl.deleteFramebuffer(frameBuffer);return isFrameBufferComplete}function getQueryParams(queryString){var params={};queryString.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(s){var t=[];for(var _i=1;_i<arguments.length;_i++){t[_i-1]=arguments[_i]}decodeParam(params,t[0],t[1]);return t.join("=")});return params}exports.getQueryParams=getQueryParams;function decodeParam(params,name,value){params[decodeURIComponent(name)]=decodeURIComponent(value||"")}},{}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var environment_1=require("./environment");var gradients_1=require("./gradients");exports.customGrad=gradients_1.customGrad;exports.grad=gradients_1.grad;exports.grads=gradients_1.grads;exports.valueAndGrad=gradients_1.valueAndGrad;exports.valueAndGrads=gradients_1.valueAndGrads;exports.variableGrads=gradients_1.variableGrads;exports.tidy=environment_1.Environment.tidy;exports.keep=environment_1.Environment.keep;exports.dispose=environment_1.Environment.dispose;exports.time=environment_1.Environment.time;exports.profile=environment_1.Environment.profile},{"./environment":51,"./gradients":54}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var environment_1=require("./environment");var tensor_1=require("./tensor");var util=require("./util");function gradScope(nameOrScopeFn,scopeFn){return environment_1.ENV.engine.tidy(nameOrScopeFn,scopeFn,true)}exports.gradScope=gradScope;function grad(f){util.assert(util.isFunction(f),"The f passed in grad(f) must be a function");return function(x,dy){util.assert(x instanceof tensor_1.Tensor,"The x passed in grad(f)(x) must be a tensor");util.assert(dy==null||dy instanceof tensor_1.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor");return environment_1.ENV.engine.tidy(function(){var _a=environment_1.ENV.engine.gradients(function(){return f(x)},[x],dy),value=_a.value,grads=_a.grads;if(dy!=null){util.assertShapesMatch(value.shape,dy.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape "+"returned by f(x)")}checkGrads(grads);return grads[0]})}}exports.grad=grad;function grads(f){util.assert(util.isFunction(f),"The f passed in grads(f) must be a function");return function(args,dy){util.assert(Array.isArray(args)&&args.every(function(arg){return arg instanceof tensor_1.Tensor}),"The args passed in grads(f)(args) must be an array of tensors");util.assert(dy==null||dy instanceof tensor_1.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor");return environment_1.ENV.engine.tidy(function(){var _a=environment_1.ENV.engine.gradients(function(){return f.apply(void 0,args)},args,dy),value=_a.value,grads=_a.grads;if(dy!=null){util.assertShapesMatch(value.shape,dy.shape,"The shape of dy passed in grads(f)([x1,...], dy) must "+"match the shape returned by f([x1,...])")}checkGrads(grads);return grads})}}exports.grads=grads;function valueAndGrad(f){util.assert(util.isFunction(f),"The f passed in valueAndGrad(f) must be a function");return function(x,dy){util.assert(x instanceof tensor_1.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor");util.assert(dy==null||dy instanceof tensor_1.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var _a=environment_1.ENV.engine.gradients(function(){return f(x)},[x],dy),grads=_a.grads,value=_a.value;checkGrads(grads);return{grad:grads[0],value:value}}}exports.valueAndGrad=valueAndGrad;function valueAndGrads(f){util.assert(util.isFunction(f),"The f passed in valueAndGrads(f) must be a function");return function(args,dy){util.assert(Array.isArray(args)&&args.every(function(arg){return arg instanceof tensor_1.Tensor}),"The args passed in valueAndGrads(f)(args) must be array of tensors");util.assert(dy==null||dy instanceof tensor_1.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var res=environment_1.ENV.engine.gradients(function(){return f.apply(void 0,args)},args,dy);if(dy!=null){util.assertShapesMatch(res.value.shape,dy.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must "+"match the shape returned by f([x1,...])")}checkGrads(res.grads);return res}}exports.valueAndGrads=valueAndGrads;function variableGrads(f,varList){util.assert(util.isFunction(f),"The f passed in variableGrads(f) must be a function");util.assert(varList==null||Array.isArray(varList)&&varList.every(function(v){return v instanceof tensor_1.Variable}),"The varList passed in variableGrads(f, varList) must be an array "+"of variables");if(varList==null){varList=[];for(var varName in environment_1.ENV.engine.registeredVariables){varList.push(environment_1.ENV.engine.registeredVariables[varName])}}var originalVarCount=varList.length;varList=varList.filter(function(variable){return variable.trainable});util.assert(varList.length>0,"variableGrads() expects at least one of the input variables to be "+("trainable, but none of the "+originalVarCount+" variables is ")+"trainable.");var allowNoGradients=true;var _a=environment_1.ENV.engine.gradients(f,varList,null,allowNoGradients),value=_a.value,grads=_a.grads;util.assert(grads.some(function(g){return g!=null}),"Cannot find a connection between any variable and the result of the "+"loss function y=f(x). Please make sure the operations that use "+"variables are inside the function f passed to minimize().");util.assert(value.rank===0,"The f passed in variableGrads(f) must return a scalar, but it "+("returned a rank-"+value.rank+" tensor"));var namedGrads={};varList.forEach(function(v,i){if(grads[i]!=null){namedGrads[v.name]=grads[i]}});return{value:value,grads:namedGrads}}exports.variableGrads=variableGrads;function customGrad(f){return environment_1.ENV.engine.customGrad(f)}exports.customGrad=customGrad;function checkGrads(grads){var numNullGradients=grads.filter(function(g){return g==null}).length;if(numNullGradients>0){throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}}},{"./environment":51,"./tensor":178,"./util":185}],55:[function(require,module,exports){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}Object.defineProperty(exports,"__esModule",{value:true});require("./kernels/backend_webgl");require("./kernels/backend_cpu");var browser_util_1=require("./browser_util");exports.nextFrame=browser_util_1.nextFrame;var environment=require("./environment");exports.environment=environment;var environment_1=require("./environment");var io=require("./io/io");exports.io=io;var serialization=require("./serialization");exports.serialization=serialization;var tensor_1=require("./tensor");var test_util=require("./test_util");exports.test_util=test_util;var util=require("./util");exports.util=util;var version_1=require("./version");exports.version_core=version_1.version;var webgl=require("./webgl");exports.webgl=webgl;var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer");exports.AdadeltaOptimizer=adadelta_optimizer_1.AdadeltaOptimizer;var adagrad_optimizer_1=require("./optimizers/adagrad_optimizer");exports.AdagradOptimizer=adagrad_optimizer_1.AdagradOptimizer;var adam_optimizer_1=require("./optimizers/adam_optimizer");exports.AdamOptimizer=adam_optimizer_1.AdamOptimizer;var adamax_optimizer_1=require("./optimizers/adamax_optimizer");exports.AdamaxOptimizer=adamax_optimizer_1.AdamaxOptimizer;var momentum_optimizer_1=require("./optimizers/momentum_optimizer");exports.MomentumOptimizer=momentum_optimizer_1.MomentumOptimizer;var optimizer_1=require("./optimizers/optimizer");exports.Optimizer=optimizer_1.Optimizer;var rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer");exports.RMSPropOptimizer=rmsprop_optimizer_1.RMSPropOptimizer;var sgd_optimizer_1=require("./optimizers/sgd_optimizer");exports.SGDOptimizer=sgd_optimizer_1.SGDOptimizer;var tensor_2=require("./tensor");exports.Tensor=tensor_2.Tensor;exports.TensorBuffer=tensor_2.TensorBuffer;exports.variable=tensor_2.variable;exports.Variable=tensor_2.Variable;var types_1=require("./types");exports.Rank=types_1.Rank;__export(require("./ops/ops"));var loss_ops_1=require("./ops/loss_ops");exports.Reduction=loss_ops_1.Reduction;__export(require("./train"));__export(require("./globals"));var environment_2=require("./environment");exports.ENV=environment_2.ENV;exports.Environment=environment_2.Environment;exports.setBackend=environment_1.Environment.setBackend;exports.getBackend=environment_1.Environment.getBackend;exports.disposeVariables=environment_1.Environment.disposeVariables;exports.memory=environment_1.Environment.memory;var backend_1=require("./kernels/backend");exports.DataStorage=backend_1.DataStorage;var ops=require("./ops/ops");tensor_1.setOpHandler(ops)},{"./browser_util":48,"./environment":51,"./globals":53,"./io/io":59,"./kernels/backend":67,"./kernels/backend_cpu":68,"./kernels/backend_webgl":70,"./ops/loss_ops":141,"./ops/ops":148,"./optimizers/adadelta_optimizer":166,"./optimizers/adagrad_optimizer":167,"./optimizers/adam_optimizer":168,"./optimizers/adamax_optimizer":169,"./optimizers/momentum_optimizer":170,"./optimizers/optimizer":171,"./optimizers/rmsprop_optimizer":173,"./optimizers/sgd_optimizer":174,"./serialization":176,"./tensor":178,"./test_util":182,"./train":183,"./types":184,"./util":185,"./version":186,"./webgl":187}],56:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var environment_1=require("../environment");var io_utils_1=require("./io_utils");var router_registry_1=require("./router_registry");var DEFAULT_FILE_NAME_PREFIX="model";var DEFAULT_JSON_EXTENSION_NAME=".json";var DEFAULT_WEIGHT_DATA_EXTENSION_NAME=".weights.bin";var BrowserDownloads=function(){function BrowserDownloads(fileNamePrefix){if(!environment_1.ENV.get("IS_BROWSER")){throw new Error("triggerDownloads() cannot proceed because the current environment "+"is not a browser.")}if(fileNamePrefix.startsWith(BrowserDownloads.URL_SCHEME)){fileNamePrefix=fileNamePrefix.slice(BrowserDownloads.URL_SCHEME.length)}if(fileNamePrefix==null||fileNamePrefix.length===0){fileNamePrefix=DEFAULT_FILE_NAME_PREFIX}this.modelTopologyFileName=fileNamePrefix+DEFAULT_JSON_EXTENSION_NAME;this.weightDataFileName=fileNamePrefix+DEFAULT_WEIGHT_DATA_EXTENSION_NAME}BrowserDownloads.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){var weightsURL,weightsManifest,modelTopologyAndWeightManifest,modelTopologyAndWeightManifestURL,jsonAnchor,weightDataAnchor;return __generator(this,function(_a){weightsURL=window.URL.createObjectURL(new Blob([modelArtifacts.weightData],{type:"application/octet-stream"}));if(modelArtifacts.modelTopology instanceof ArrayBuffer){throw new Error("DownloadTrigger.save() does not support saving model topology "+"in binary formats yet.")}else{weightsManifest=[{paths:["./"+this.weightDataFileName],weights:modelArtifacts.weightSpecs}];modelTopologyAndWeightManifest={modelTopology:modelArtifacts.modelTopology,weightsManifest:weightsManifest};modelTopologyAndWeightManifestURL=window.URL.createObjectURL(new Blob([JSON.stringify(modelTopologyAndWeightManifest)],{type:"application/json"}));jsonAnchor=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;jsonAnchor.download=this.modelTopologyFileName;jsonAnchor.href=modelTopologyAndWeightManifestURL;jsonAnchor.click();if(modelArtifacts.weightData!=null){weightDataAnchor=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;weightDataAnchor.download=this.weightDataFileName;weightDataAnchor.href=weightsURL;weightDataAnchor.click()}return[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts)}]}return[2]})})};BrowserDownloads.URL_SCHEME="downloads://";return BrowserDownloads}();exports.BrowserDownloads=BrowserDownloads;var BrowserFiles=function(){function BrowserFiles(files){if(files==null||files.length<1){throw new Error("When calling browserFiles, at least 1 file is required, "+("but received "+files))}this.files=files}BrowserFiles.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var jsonFile,weightFiles;var _this=this;return __generator(this,function(_a){jsonFile=this.files[0];weightFiles=this.files.slice(1);return[2,new Promise(function(resolve,reject){var jsonReader=new FileReader;jsonReader.onload=function(event){var modelJSON=JSON.parse(event.target.result);var modelTopology=modelJSON.modelTopology;if(modelTopology==null){reject(new Error("modelTopology field is missing from file "+jsonFile.name));return}if(weightFiles.length===0){resolve({modelTopology:modelTopology})}var weightsManifest=modelJSON.weightsManifest;if(weightsManifest==null){reject(new Error("weightManifest field is missing from file "+jsonFile.name));return}var pathToFile;try{pathToFile=_this.checkManifestAndWeightFiles(weightsManifest,weightFiles)}catch(err){reject(err);return}var weightSpecs=[];var paths=[];var perFileBuffers=[];weightsManifest.forEach(function(weightsGroup){weightsGroup.paths.forEach(function(path){paths.push(path);perFileBuffers.push(null)});weightSpecs.push.apply(weightSpecs,weightsGroup.weights)});weightsManifest.forEach(function(weightsGroup){weightsGroup.paths.forEach(function(path){var weightFileReader=new FileReader;weightFileReader.onload=function(event){var weightData=event.target.result;var index=paths.indexOf(path);perFileBuffers[index]=weightData;if(perFileBuffers.indexOf(null)===-1){resolve({modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:io_utils_1.concatenateArrayBuffers(perFileBuffers)})}};weightFileReader.onerror=function(error){reject("Failed to weights data from file of path '"+path+"'.");return};weightFileReader.readAsArrayBuffer(pathToFile[path])})})};jsonReader.onerror=function(error){reject("Failed to read model topology and weights manifest JSON "+("from file '"+jsonFile.name+"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.");return};jsonReader.readAsText(jsonFile)})]})})};BrowserFiles.prototype.checkManifestAndWeightFiles=function(manifest,files){var basenames=[];var fileNames=files.map(function(file){return io_utils_1.basename(file.name)});var pathToFile={};for(var _i=0,manifest_1=manifest;_i<manifest_1.length;_i++){var group=manifest_1[_i];group.paths.forEach(function(path){var pathBasename=io_utils_1.basename(path);if(basenames.indexOf(pathBasename)!==-1){throw new Error("Duplicate file basename found in weights manifest: "+("'"+pathBasename+"'"))}basenames.push(pathBasename);if(fileNames.indexOf(pathBasename)===-1){throw new Error("Weight file with basename '"+pathBasename+"' is not provided.")}else{pathToFile[path]=files[fileNames.indexOf(pathBasename)]}})}if(basenames.length!==files.length){throw new Error("Mismatch in the number of files in weights manifest "+("("+basenames.length+") and the number of weight files provided ")+("("+files.length+")."))}return pathToFile};return BrowserFiles}();exports.browserDownloadsRouter=function(url){if(!environment_1.ENV.get("IS_BROWSER")){return null}else{if(!Array.isArray(url)&&url.startsWith(BrowserDownloads.URL_SCHEME)){return browserDownloads(url.slice(BrowserDownloads.URL_SCHEME.length))}else{return null}}};router_registry_1.IORouterRegistry.registerSaveRouter(exports.browserDownloadsRouter);function browserDownloads(fileNamePrefix){if(fileNamePrefix===void 0){fileNamePrefix="model"}return new BrowserDownloads(fileNamePrefix)}exports.browserDownloads=browserDownloads;function browserFiles(files){return new BrowserFiles(files)}exports.browserFiles=browserFiles},{"../environment":51,"./io_utils":60,"./router_registry":64}],57:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../util");var io_utils_1=require("./io_utils");var router_registry_1=require("./router_registry");var weights_loader_1=require("./weights_loader");var BrowserHTTPRequest=function(){function BrowserHTTPRequest(path,requestInit){this.DEFAULT_METHOD="POST";if(typeof fetch==="undefined"){throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.")}util_1.assert(path!=null&&path.length>0,"URL path for browserHTTPRequest must not be null, undefined or "+"empty.");if(Array.isArray(path)){util_1.assert(path.length===2,"URL paths for browserHTTPRequest must have a length of 2, "+("(actual length is "+path.length+")."))}this.path=path;if(requestInit!=null&&requestInit.body!=null){throw new Error("requestInit is expected to have no pre-existing body, but has one.")}this.requestInit=requestInit||{}}BrowserHTTPRequest.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){var init,weightsManifest,modelTopologyAndWeightManifest,response;return __generator(this,function(_a){switch(_a.label){case 0:if(modelArtifacts.modelTopology instanceof ArrayBuffer){throw new Error("BrowserHTTPRequest.save() does not support saving model topology "+"in binary formats yet.")}init=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);init.body=new FormData;weightsManifest=[{paths:["./model.weights.bin"],weights:modelArtifacts.weightSpecs}];modelTopologyAndWeightManifest={modelTopology:modelArtifacts.modelTopology,weightsManifest:weightsManifest};init.body.append("model.json",new Blob([JSON.stringify(modelTopologyAndWeightManifest)],{type:"application/json"}),"model.json");if(modelArtifacts.weightData!=null){init.body.append("model.weights.bin",new Blob([modelArtifacts.weightData],{type:"application/octet-stream"}),"model.weights.bin")}return[4,fetch(this.path,init)];case 1:response=_a.sent();if(response.status===200){return[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts),responses:[response]}]}else{throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+(response.status+"."))}return[2]}})})};BrowserHTTPRequest.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})};BrowserHTTPRequest.prototype.loadBinaryTopology=function(){return __awaiter(this,void 0,void 0,function(){var response,error_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,3,,4]);return[4,fetch(this.path[0],this.requestInit)];case 1:response=_a.sent();return[4,response.arrayBuffer()];case 2:return[2,_a.sent()];case 3:error_1=_a.sent();throw new Error(this.path[0]+" not found. "+error_1);case 4:return[2]}})})};BrowserHTTPRequest.prototype.loadBinaryModel=function(){return __awaiter(this,void 0,void 0,function(){var graphPromise,manifestPromise,results,modelTopology,weightsManifestResponse,weightsManifest,weightSpecs,weightData,results_1;return __generator(this,function(_a){switch(_a.label){case 0:graphPromise=this.loadBinaryTopology();return[4,fetch(this.path[1],this.requestInit)];case 1:manifestPromise=_a.sent();return[4,Promise.all([graphPromise,manifestPromise])];case 2:results=_a.sent();modelTopology=results[0],weightsManifestResponse=results[1];return[4,weightsManifestResponse.json()];case 3:weightsManifest=_a.sent();if(!(weightsManifest!=null))return[3,5];return[4,this.loadWeights(weightsManifest)];case 4:results_1=_a.sent();weightSpecs=results_1[0],weightData=results_1[1];_a.label=5;case 5:return[2,{modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:weightData}]}})})};BrowserHTTPRequest.prototype.loadJSONModel=function(){return __awaiter(this,void 0,void 0,function(){var modelConfigRequest,modelConfig,modelTopology,weightsManifest,weightSpecs,weightData,weightsManifest_1,results;return __generator(this,function(_a){switch(_a.label){case 0:return[4,fetch(this.path,this.requestInit)];case 1:modelConfigRequest=_a.sent();return[4,modelConfigRequest.json()];case 2:modelConfig=_a.sent();modelTopology=modelConfig["modelTopology"];weightsManifest=modelConfig["weightsManifest"];if(modelTopology==null&&weightsManifest==null){throw new Error("The JSON from HTTP path "+this.path+" contains neither model "+"topology or manifest for weights.")}if(!(weightsManifest!=null))return[3,4];weightsManifest_1=modelConfig["weightsManifest"];return[4,this.loadWeights(weightsManifest_1)];case 3:results=_a.sent();weightSpecs=results[0],weightData=results[1];_a.label=4;case 4:return[2,{modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:weightData}]}})})};BrowserHTTPRequest.prototype.loadWeights=function(weightsManifest){return __awaiter(this,void 0,void 0,function(){var weightPath,weightSpecs,_i,weightsManifest_2,entry,pathPrefix,fetchURLs,_a,_b;return __generator(this,function(_c){switch(_c.label){case 0:weightPath=Array.isArray(this.path)?this.path[1]:this.path;weightSpecs=[];for(_i=0,weightsManifest_2=weightsManifest;_i<weightsManifest_2.length;_i++){entry=weightsManifest_2[_i];weightSpecs.push.apply(weightSpecs,entry.weights)}pathPrefix=weightPath.substring(0,weightPath.lastIndexOf("/"));if(!pathPrefix.endsWith("/")){pathPrefix=pathPrefix+"/"}fetchURLs=[];weightsManifest.forEach(function(weightsGroup){weightsGroup.paths.forEach(function(path){fetchURLs.push(pathPrefix+path)})});_a=[weightSpecs];_b=io_utils_1.concatenateArrayBuffers;return[4,weights_loader_1.loadWeightsAsArrayBuffer(fetchURLs,this.requestInit)];case 1:return[2,_a.concat([_b.apply(void 0,[_c.sent()])])]}})})};BrowserHTTPRequest.URL_SCHEME_REGEX=/^https?:\/\//;return BrowserHTTPRequest}();exports.BrowserHTTPRequest=BrowserHTTPRequest;function isHTTPScheme(url){return url.match(BrowserHTTPRequest.URL_SCHEME_REGEX)!=null}exports.httpRequestRouter=function(url){if(typeof fetch==="undefined"){return null}else{var isHTTP=true;if(Array.isArray(url)){isHTTP=url.every(function(urlItem){return isHTTPScheme(urlItem)})}else{isHTTP=isHTTPScheme(url)}if(isHTTP){return browserHTTPRequest(url)}}return null};router_registry_1.IORouterRegistry.registerSaveRouter(exports.httpRequestRouter);router_registry_1.IORouterRegistry.registerLoadRouter(exports.httpRequestRouter);function browserHTTPRequest(path,requestInit){return new BrowserHTTPRequest(path,requestInit)}exports.browserHTTPRequest=browserHTTPRequest},{"../util":185,"./io_utils":60,"./router_registry":64,"./weights_loader":66}],58:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var environment_1=require("../environment");var io_utils_1=require("./io_utils");var model_management_1=require("./model_management");var router_registry_1=require("./router_registry");var DATABASE_NAME="tensorflowjs";var DATABASE_VERSION=1;var MODEL_STORE_NAME="models_store";var INFO_STORE_NAME="model_info_store";function deleteDatabase(){return __awaiter(this,void 0,void 0,function(){var idbFactory;return __generator(this,function(_a){idbFactory=getIndexedDBFactory();return[2,new Promise(function(resolve,reject){var deleteRequest=idbFactory.deleteDatabase(DATABASE_NAME);deleteRequest.onsuccess=function(){return resolve()};deleteRequest.onerror=function(error){return reject(error)}})]})})}exports.deleteDatabase=deleteDatabase;function getIndexedDBFactory(){if(!environment_1.ENV.get("IS_BROWSER")){throw new Error("Failed to obtain IndexedDB factory because the current environment"+"is not a web browser.")}var theWindow=window;var factory=theWindow.indexedDB||theWindow.mozIndexedDB||theWindow.webkitIndexedDB||theWindow.msIndexedDB||theWindow.shimIndexedDB;if(factory==null){throw new Error("The current browser does not appear to support IndexedDB.")}return factory}function setUpDatabase(openRequest){var db=openRequest.result;db.createObjectStore(MODEL_STORE_NAME,{keyPath:"modelPath"});db.createObjectStore(INFO_STORE_NAME,{keyPath:"modelPath"})}var BrowserIndexedDB=function(){function BrowserIndexedDB(modelPath){this.indexedDB=getIndexedDBFactory();if(modelPath==null||!modelPath){throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.")}this.modelPath=modelPath}BrowserIndexedDB.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(modelArtifacts.modelTopology instanceof ArrayBuffer){throw new Error("BrowserLocalStorage.save() does not support saving model topology "+"in binary formats yet.")}return[2,this.databaseAction(this.modelPath,modelArtifacts)]})})};BrowserIndexedDB.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.databaseAction(this.modelPath)]})})};BrowserIndexedDB.prototype.databaseAction=function(modelPath,modelArtifacts){var _this=this;return new Promise(function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)};openRequest.onsuccess=function(){var db=openRequest.result;if(modelArtifacts==null){var modelTx=db.transaction(MODEL_STORE_NAME,"readonly");var modelStore=modelTx.objectStore(MODEL_STORE_NAME);var getRequest_1=modelStore.get(_this.modelPath);getRequest_1.onsuccess=function(){if(getRequest_1.result==null){db.close();return reject(new Error("Cannot find model with path '"+_this.modelPath+"' "+"in IndexedDB."))}else{resolve(getRequest_1.result.modelArtifacts)}};getRequest_1.onerror=function(error){db.close();return reject(getRequest_1.error)};modelTx.oncomplete=function(){return db.close()}}else{var modelArtifactsInfo_1=io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts);var infoTx_1=db.transaction(INFO_STORE_NAME,"readwrite");var infoStore_1=infoTx_1.objectStore(INFO_STORE_NAME);var putInfoRequest_1=infoStore_1.put({modelPath:_this.modelPath,modelArtifactsInfo:modelArtifactsInfo_1});var modelTx_1;putInfoRequest_1.onsuccess=function(){modelTx_1=db.transaction(MODEL_STORE_NAME,"readwrite");var modelStore=modelTx_1.objectStore(MODEL_STORE_NAME);var putModelRequest=modelStore.put({modelPath:_this.modelPath,modelArtifacts:modelArtifacts,modelArtifactsInfo:modelArtifactsInfo_1});putModelRequest.onsuccess=function(){return resolve({modelArtifactsInfo:modelArtifactsInfo_1})};putModelRequest.onerror=function(error){infoStore_1=infoTx_1.objectStore(INFO_STORE_NAME);var deleteInfoRequest=infoStore_1.delete(_this.modelPath);deleteInfoRequest.onsuccess=function(){db.close();return reject(putModelRequest.error)};deleteInfoRequest.onerror=function(error){db.close();return reject(putModelRequest.error)}}};putInfoRequest_1.onerror=function(error){db.close();return reject(putInfoRequest_1.error)};infoTx_1.oncomplete=function(){if(modelTx_1==null){db.close()}else{modelTx_1.oncomplete=function(){return db.close()}}}}};openRequest.onerror=function(error){return reject(openRequest.error)}})};BrowserIndexedDB.URL_SCHEME="indexeddb://";return BrowserIndexedDB}();exports.BrowserIndexedDB=BrowserIndexedDB;exports.indexedDBRouter=function(url){if(!environment_1.ENV.get("IS_BROWSER")){return null}else{if(!Array.isArray(url)&&url.startsWith(BrowserIndexedDB.URL_SCHEME)){return browserIndexedDB(url.slice(BrowserIndexedDB.URL_SCHEME.length))}else{return null}}};router_registry_1.IORouterRegistry.registerSaveRouter(exports.indexedDBRouter);router_registry_1.IORouterRegistry.registerLoadRouter(exports.indexedDBRouter);function browserIndexedDB(modelPath){return new BrowserIndexedDB(modelPath)}exports.browserIndexedDB=browserIndexedDB;function maybeStripScheme(key){return key.startsWith(BrowserIndexedDB.URL_SCHEME)?key.slice(BrowserIndexedDB.URL_SCHEME.length):key}var BrowserIndexedDBManager=function(){function BrowserIndexedDBManager(){this.indexedDB=getIndexedDBFactory()}BrowserIndexedDBManager.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)};openRequest.onsuccess=function(){var db=openRequest.result;var tx=db.transaction(INFO_STORE_NAME,"readonly");var store=tx.objectStore(INFO_STORE_NAME);var getAllInfoRequest=store.getAll();getAllInfoRequest.onsuccess=function(){var out={};for(var _i=0,_a=getAllInfoRequest.result;_i<_a.length;_i++){var item=_a[_i];out[item.modelPath]=item.modelArtifactsInfo}resolve(out)};getAllInfoRequest.onerror=function(error){db.close();return reject(getAllInfoRequest.error)};tx.oncomplete=function(){return db.close()}};openRequest.onerror=function(error){return reject(openRequest.error)}})]})})};BrowserIndexedDBManager.prototype.removeModel=function(path){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){path=maybeStripScheme(path);return[2,new Promise(function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,DATABASE_VERSION);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)};openRequest.onsuccess=function(){var db=openRequest.result;var infoTx=db.transaction(INFO_STORE_NAME,"readwrite");var infoStore=infoTx.objectStore(INFO_STORE_NAME);var getInfoRequest=infoStore.get(path);var modelTx;getInfoRequest.onsuccess=function(){if(getInfoRequest.result==null){db.close();return reject(new Error("Cannot find model with path '"+path+"' "+"in IndexedDB."))}else{var deleteInfoRequest=infoStore.delete(path);var deleteModelData_1=function(){modelTx=db.transaction(MODEL_STORE_NAME,"readwrite");var modelStore=modelTx.objectStore(MODEL_STORE_NAME);var deleteModelRequest=modelStore.delete(path);deleteModelRequest.onsuccess=function(){return resolve(getInfoRequest.result.modelArtifactsInfo)};deleteModelRequest.onerror=function(error){return reject(getInfoRequest.error)}};deleteInfoRequest.onsuccess=deleteModelData_1;deleteInfoRequest.onerror=function(error){deleteModelData_1();db.close();return reject(getInfoRequest.error)}}};getInfoRequest.onerror=function(error){db.close();return reject(getInfoRequest.error)};infoTx.oncomplete=function(){if(modelTx==null){db.close()}else{modelTx.oncomplete=function(){return db.close()}}}};openRequest.onerror=function(error){return reject(openRequest.error)}})]})})};return BrowserIndexedDBManager}();exports.BrowserIndexedDBManager=BrowserIndexedDBManager;if(environment_1.ENV.get("IS_BROWSER")){try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserIndexedDB.URL_SCHEME,new BrowserIndexedDBManager)}catch(err){}}},{"../environment":51,"./io_utils":60,"./model_management":62,"./router_registry":64}],59:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("./indexed_db");require("./local_storage");var browser_files_1=require("./browser_files");exports.browserFiles=browser_files_1.browserFiles;var browser_http_1=require("./browser_http");exports.browserHTTPRequest=browser_http_1.browserHTTPRequest;var io_utils_1=require("./io_utils");exports.concatenateArrayBuffers=io_utils_1.concatenateArrayBuffers;exports.decodeWeights=io_utils_1.decodeWeights;exports.encodeWeights=io_utils_1.encodeWeights;exports.getModelArtifactsInfoForJSON=io_utils_1.getModelArtifactsInfoForJSON;var passthrough_1=require("./passthrough");exports.fromMemory=passthrough_1.fromMemory;exports.withSaveHandler=passthrough_1.withSaveHandler;var router_registry_1=require("./router_registry");var weights_loader_1=require("./weights_loader");exports.loadWeights=weights_loader_1.loadWeights;var registerSaveRouter=router_registry_1.IORouterRegistry.registerSaveRouter;exports.registerSaveRouter=registerSaveRouter;var registerLoadRouter=router_registry_1.IORouterRegistry.registerLoadRouter;exports.registerLoadRouter=registerLoadRouter;var getSaveHandlers=router_registry_1.IORouterRegistry.getSaveHandlers;exports.getSaveHandlers=getSaveHandlers;var getLoadHandlers=router_registry_1.IORouterRegistry.getLoadHandlers;exports.getLoadHandlers=getLoadHandlers;var model_management_1=require("./model_management");exports.copyModel=model_management_1.copyModel;exports.listModels=model_management_1.listModels;exports.moveModel=model_management_1.moveModel;exports.removeModel=model_management_1.removeModel},{"./browser_files":56,"./browser_http":57,"./indexed_db":58,"./io_utils":60,"./local_storage":61,"./model_management":62,"./passthrough":63,"./router_registry":64,"./weights_loader":66}],60:[function(require,module,exports){(function(Buffer){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var tensor_ops_1=require("../ops/tensor_ops");var util_1=require("../util");var types_1=require("./types");function encodeWeights(tensors){return __awaiter(this,void 0,void 0,function(){var specs,dataPromises,name_1,t,tensorValues;return __generator(this,function(_a){switch(_a.label){case 0:specs=[];dataPromises=[];for(name_1 in tensors){t=tensors[name_1];if(t.dtype!=="float32"&&t.dtype!=="int32"&&t.dtype!=="bool"){throw new Error("Unsupported dtype in weight '"+name_1+"': "+t.dtype)}specs.push({name:name_1,shape:t.shape,dtype:t.dtype});dataPromises.push(t.data())}return[4,Promise.all(dataPromises)];case 1:tensorValues=_a.sent();return[2,{data:concatenateTypedArrays(tensorValues),specs:specs}]}})})}exports.encodeWeights=encodeWeights;function decodeWeights(buffer,specs){var out={};var offset=0;var _loop_1=function(spec){var name_2=spec.name;var dtype=spec.dtype;var shape=spec.shape;var size=util_1.sizeFromShape(shape);var typedArray=void 0;if("quantization"in spec){var quantization_1=spec.quantization;if(quantization_1.dtype!=="uint8"&&quantization_1.dtype!=="uint16"){throw new Error("Weight "+spec.name+" has unknown "+("quantization dtype "+quantization_1.dtype+". ")+"Supported quantization dtypes are: 'uint8' and 'uint16'.")}var quantizationSizeFactor=types_1.DTYPE_VALUE_SIZE_MAP[quantization_1.dtype];var byteBuffer=buffer.slice(offset,offset+size*quantizationSizeFactor);var quantizedArray=quantization_1.dtype==="uint8"?new Uint8Array(byteBuffer):new Uint16Array(byteBuffer);if(dtype==="float32"){typedArray=Float32Array.from(quantizedArray,function(v){return v*quantization_1.scale+quantization_1.min})}else if(dtype==="int32"){typedArray=Int32Array.from(quantizedArray,function(v){return Math.round(v*quantization_1.scale+quantization_1.min)})}else{throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype)}offset+=size*quantizationSizeFactor}else{var dtypeFactor=types_1.DTYPE_VALUE_SIZE_MAP[dtype];var byteBuffer=buffer.slice(offset,offset+size*dtypeFactor);if(dtype==="float32"){typedArray=new Float32Array(byteBuffer)}else if(dtype==="int32"){typedArray=new Int32Array(byteBuffer)}else if(dtype==="bool"){typedArray=new Uint8Array(byteBuffer)}else{throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype)}offset+=size*dtypeFactor}var value=void 0;if(dtype==="float32"){value=tensor_ops_1.tensor(typedArray,shape,"float32")}else if(dtype==="int32"){value=tensor_ops_1.tensor(typedArray,shape,"int32")}else if(dtype==="bool"){value=tensor_ops_1.tensor(typedArray,shape,"bool")}else{throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype)}out[name_2]=value};for(var _i=0,specs_1=specs;_i<specs_1.length;_i++){var spec=specs_1[_i];_loop_1(spec)}return out}exports.decodeWeights=decodeWeights;function concatenateTypedArrays(xs){if(xs===null){throw new Error("Invalid input value: "+JSON.stringify(xs))}var totalByteLength=0;var normalizedXs=[];xs.forEach(function(x){totalByteLength+=x.byteLength;normalizedXs.push(x.byteLength===x.buffer.byteLength?x:new x.constructor(x));if(!(x instanceof Float32Array||x instanceof Int32Array||x instanceof Uint8Array)){throw new Error("Unsupported TypedArray subtype: "+x.constructor.name)}});var y=new Uint8Array(totalByteLength);var offset=0;normalizedXs.forEach(function(x){y.set(new Uint8Array(x.buffer),offset);offset+=x.byteLength});return y.buffer}exports.concatenateTypedArrays=concatenateTypedArrays;var useNodeBuffer=typeof Buffer!=="undefined"&&(typeof Blob==="undefined"||typeof atob==="undefined"||typeof btoa==="undefined");function stringByteLength(str){if(useNodeBuffer){return Buffer.byteLength(str)}return new Blob([str]).size}exports.stringByteLength=stringByteLength;function arrayBufferToBase64String(buffer){if(useNodeBuffer){return Buffer.from(buffer).toString("base64")}return btoa(String.fromCharCode.apply(null,new Uint8Array(buffer)))}exports.arrayBufferToBase64String=arrayBufferToBase64String;function base64StringToArrayBuffer(str){if(useNodeBuffer){var buf=Buffer.from(str,"base64");return buf.buffer.slice(buf.byteOffset,buf.byteOffset+buf.byteLength)}var s=atob(str);var buffer=new Uint8Array(s.length);for(var i=0;i<s.length;++i){buffer.set([s.charCodeAt(i)],i)}return buffer.buffer}exports.base64StringToArrayBuffer=base64StringToArrayBuffer;function concatenateArrayBuffers(buffers){var totalByteLength=0;buffers.forEach(function(buffer){totalByteLength+=buffer.byteLength});var temp=new Uint8Array(totalByteLength);var offset=0;buffers.forEach(function(buffer){temp.set(new Uint8Array(buffer),offset);offset+=buffer.byteLength});return temp.buffer}exports.concatenateArrayBuffers=concatenateArrayBuffers;function basename(path){var SEPARATOR="/";path=path.trim();while(path.endsWith(SEPARATOR)){path=path.slice(0,path.length-1)}var items=path.split(SEPARATOR);return items[items.length-1]}exports.basename=basename;function getModelArtifactsInfoForJSON(modelArtifacts){if(modelArtifacts.modelTopology instanceof ArrayBuffer){throw new Error("Expected JSON model topology, received ArrayBuffer.")}return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:modelArtifacts.modelTopology==null?0:stringByteLength(JSON.stringify(modelArtifacts.modelTopology)),weightSpecsBytes:modelArtifacts.weightSpecs==null?0:stringByteLength(JSON.stringify(modelArtifacts.weightSpecs)),weightDataBytes:modelArtifacts.weightData==null?0:modelArtifacts.weightData.byteLength}}exports.getModelArtifactsInfoForJSON=getModelArtifactsInfoForJSON}).call(this,require("buffer").Buffer)},{"../ops/tensor_ops":162,"../util":185,"./types":65,buffer:241}],61:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var environment_1=require("../environment");var util_1=require("../util");var io_utils_1=require("./io_utils");var model_management_1=require("./model_management");var router_registry_1=require("./router_registry");var PATH_SEPARATOR="/";var PATH_PREFIX="tensorflowjs_models";var INFO_SUFFIX="info";var MODEL_TOPOLOGY_SUFFIX="model_topology";var WEIGHT_SPECS_SUFFIX="weight_specs";var WEIGHT_DATA_SUFFIX="weight_data";function purgeLocalStorageArtifacts(){if(!environment_1.ENV.get("IS_BROWSER")||typeof window.localStorage==="undefined"){throw new Error("purgeLocalStorageModels() cannot proceed because local storage is "+"unavailable in the current environment.")}var LS=window.localStorage;var purgedModelPaths=[];for(var i=0;i<LS.length;++i){var key=LS.key(i);var prefix=PATH_PREFIX+PATH_SEPARATOR;if(key.startsWith(prefix)&&key.length>prefix.length){LS.removeItem(key);var modelName=getModelPathFromKey(key);if(purgedModelPaths.indexOf(modelName)===-1){purgedModelPaths.push(modelName)}}}return purgedModelPaths}exports.purgeLocalStorageArtifacts=purgeLocalStorageArtifacts;function getModelKeys(path){return{info:[PATH_PREFIX,path,INFO_SUFFIX].join(PATH_SEPARATOR),topology:[PATH_PREFIX,path,MODEL_TOPOLOGY_SUFFIX].join(PATH_SEPARATOR),weightSpecs:[PATH_PREFIX,path,WEIGHT_SPECS_SUFFIX].join(PATH_SEPARATOR),weightData:[PATH_PREFIX,path,WEIGHT_DATA_SUFFIX].join(PATH_SEPARATOR)}}function getModelPathFromKey(key){var items=key.split(PATH_SEPARATOR);if(items.length<3){throw new Error("Invalid key format: "+key)}return items.slice(1,items.length-1).join(PATH_SEPARATOR)}function maybeStripScheme(key){return key.startsWith(BrowserLocalStorage.URL_SCHEME)?key.slice(BrowserLocalStorage.URL_SCHEME.length):key}var BrowserLocalStorage=function(){function BrowserLocalStorage(modelPath){if(!environment_1.ENV.get("IS_BROWSER")||typeof window.localStorage==="undefined"){throw new Error("The current environment does not support local storage.")}this.LS=window.localStorage;if(modelPath==null||!modelPath){throw new Error("For local storage, modelPath must not be null, undefined or empty.")}this.modelPath=modelPath;this.keys=getModelKeys(this.modelPath)}BrowserLocalStorage.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){var topology,weightSpecs,modelArtifactsInfo,key;return __generator(this,function(_a){if(modelArtifacts.modelTopology instanceof ArrayBuffer){throw new Error("BrowserLocalStorage.save() does not support saving model topology "+"in binary formats yet.")}else{topology=JSON.stringify(modelArtifacts.modelTopology);weightSpecs=JSON.stringify(modelArtifacts.weightSpecs);modelArtifactsInfo=io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts);try{this.LS.setItem(this.keys.info,JSON.stringify(modelArtifactsInfo));this.LS.setItem(this.keys.topology,topology);this.LS.setItem(this.keys.weightSpecs,weightSpecs);this.LS.setItem(this.keys.weightData,io_utils_1.arrayBufferToBase64String(modelArtifacts.weightData));return[2,{modelArtifactsInfo:modelArtifactsInfo}]}catch(err){for(key in this.keys){this.LS.removeItem(this.keys[key])}throw new Error("Failed to save model '"+this.modelPath+"' to local storage: "+"size quota being exceeded is a possible cause of this failure: "+("modelTopologyBytes="+modelArtifactsInfo.modelTopologyBytes+", ")+("weightSpecsBytes="+modelArtifactsInfo.weightSpecsBytes+", ")+("weightDataBytes="+modelArtifactsInfo.weightDataBytes+"."))}}return[2]})})};BrowserLocalStorage.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var info,out,topology,weightSpecs,weightDataBase64;return __generator(this,function(_a){info=JSON.parse(this.LS.getItem(this.keys.info));if(info==null){throw new Error("In local storage, there is no model with name '"+this.modelPath+"'")}if(info.modelTopologyType!=="JSON"){throw new Error("BrowserLocalStorage does not support loading non-JSON model "+"topology yet.")}out={};topology=JSON.parse(this.LS.getItem(this.keys.topology));if(topology==null){throw new Error("In local storage, the topology of model '"+this.modelPath+"' "+"is missing.")}out.modelTopology=topology;weightSpecs=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(weightSpecs==null){throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' "+"are missing.")}out.weightSpecs=weightSpecs;weightDataBase64=this.LS.getItem(this.keys.weightData);if(weightDataBase64==null){throw new Error("In local storage, the binary weight values of model "+("'"+this.modelPath+"' are missing."))}out.weightData=io_utils_1.base64StringToArrayBuffer(weightDataBase64);return[2,out]})})};BrowserLocalStorage.URL_SCHEME="localstorage://";return BrowserLocalStorage}();exports.BrowserLocalStorage=BrowserLocalStorage;exports.localStorageRouter=function(url){if(!environment_1.ENV.get("IS_BROWSER")){return null}else{if(!Array.isArray(url)&&url.startsWith(BrowserLocalStorage.URL_SCHEME)){return browserLocalStorage(url.slice(BrowserLocalStorage.URL_SCHEME.length))}else{return null}}};router_registry_1.IORouterRegistry.registerSaveRouter(exports.localStorageRouter);router_registry_1.IORouterRegistry.registerLoadRouter(exports.localStorageRouter);function browserLocalStorage(modelPath){return new BrowserLocalStorage(modelPath)}exports.browserLocalStorage=browserLocalStorage;var BrowserLocalStorageManager=function(){function BrowserLocalStorageManager(){util_1.assert(environment_1.ENV.get("IS_BROWSER"),"Current environment is not a web browser");util_1.assert(typeof window.localStorage!=="undefined","Current browser does not appear to support localStorage");this.LS=window.localStorage}BrowserLocalStorageManager.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var out,prefix,suffix,i,key,modelPath;return __generator(this,function(_a){out={};prefix=PATH_PREFIX+PATH_SEPARATOR;suffix=PATH_SEPARATOR+INFO_SUFFIX;for(i=0;i<this.LS.length;++i){key=this.LS.key(i);if(key.startsWith(prefix)&&key.endsWith(suffix)){modelPath=getModelPathFromKey(key);out[modelPath]=JSON.parse(this.LS.getItem(key))}}return[2,out]})})};BrowserLocalStorageManager.prototype.removeModel=function(path){return __awaiter(this,void 0,void 0,function(){var keys,info;return __generator(this,function(_a){path=maybeStripScheme(path);keys=getModelKeys(path);if(this.LS.getItem(keys.info)==null){throw new Error("Cannot find model at path '"+path+"'")}info=JSON.parse(this.LS.getItem(keys.info));this.LS.removeItem(keys.info);this.LS.removeItem(keys.topology);this.LS.removeItem(keys.weightSpecs);this.LS.removeItem(keys.weightData);return[2,info]})})};return BrowserLocalStorageManager}();exports.BrowserLocalStorageManager=BrowserLocalStorageManager;if(environment_1.ENV.get("IS_BROWSER")){try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserLocalStorage.URL_SCHEME,new BrowserLocalStorageManager)}catch(err){}}},{"../environment":51,"../util":185,"./io_utils":60,"./model_management":62,"./router_registry":64}],62:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../util");var router_registry_1=require("./router_registry");var URL_SCHEME_SUFFIX="://";var ModelStoreManagerRegistry=function(){function ModelStoreManagerRegistry(){this.managers={}}ModelStoreManagerRegistry.getInstance=function(){if(ModelStoreManagerRegistry.instance==null){ModelStoreManagerRegistry.instance=new ModelStoreManagerRegistry}return ModelStoreManagerRegistry.instance};ModelStoreManagerRegistry.registerManager=function(scheme,manager){util_1.assert(scheme!=null,"scheme must not be undefined or null.");if(scheme.endsWith(URL_SCHEME_SUFFIX)){scheme=scheme.slice(0,scheme.indexOf(URL_SCHEME_SUFFIX))}util_1.assert(scheme.length>0,"scheme must not be an empty string.");var registry=ModelStoreManagerRegistry.getInstance();util_1.assert(registry.managers[scheme]==null,"A model store manager is already registered for scheme '"+scheme+"'.");registry.managers[scheme]=manager};ModelStoreManagerRegistry.getManager=function(scheme){var manager=this.getInstance().managers[scheme];if(manager==null){throw new Error("Cannot find model manager for scheme '"+scheme+"'")}return manager};ModelStoreManagerRegistry.getSchemes=function(){return Object.keys(this.getInstance().managers)};return ModelStoreManagerRegistry}();exports.ModelStoreManagerRegistry=ModelStoreManagerRegistry;function parseURL(url){if(url.indexOf(URL_SCHEME_SUFFIX)===-1){throw new Error("The url string provided does not contain a scheme. "+"Supported schemes are: "+(""+ModelStoreManagerRegistry.getSchemes().join(",")))}return{scheme:url.split(URL_SCHEME_SUFFIX)[0],path:url.split(URL_SCHEME_SUFFIX)[1]}}function cloneModelInternal(sourceURL,destURL,deleteSource){if(deleteSource===void 0){deleteSource=false}return __awaiter(this,void 0,void 0,function(){var loadHandlers,loadHandler,saveHandlers,saveHandler,sourceScheme,sourcePath,sameMedium,modelArtifacts,saveResult;return __generator(this,function(_a){switch(_a.label){case 0:util_1.assert(sourceURL!==destURL,"Old path and new path are the same: '"+sourceURL+"'");loadHandlers=router_registry_1.IORouterRegistry.getLoadHandlers(sourceURL);util_1.assert(loadHandlers.length>0,"Copying failed because no load handler is found for source URL "+sourceURL+".");util_1.assert(loadHandlers.length<2,"Copying failed because more than one ("+loadHandlers.length+") "+("load handlers for source URL "+sourceURL+"."));loadHandler=loadHandlers[0];saveHandlers=router_registry_1.IORouterRegistry.getSaveHandlers(destURL);util_1.assert(saveHandlers.length>0,"Copying failed because no save handler is found for destination URL "+(destURL+"."));util_1.assert(saveHandlers.length<2,"Copying failed because more than one ("+loadHandlers.length+") "+("save handlers for destination URL "+destURL+"."));saveHandler=saveHandlers[0];sourceScheme=parseURL(sourceURL).scheme;sourcePath=parseURL(sourceURL).path;sameMedium=sourceScheme===parseURL(sourceURL).scheme;return[4,loadHandler.load()];case 1:modelArtifacts=_a.sent();if(!(deleteSource&&sameMedium))return[3,3];return[4,ModelStoreManagerRegistry.getManager(sourceScheme).removeModel(sourcePath)];case 2:_a.sent();_a.label=3;case 3:return[4,saveHandler.save(modelArtifacts)];case 4:saveResult=_a.sent();if(!(deleteSource&&!sameMedium))return[3,6];return[4,ModelStoreManagerRegistry.getManager(sourceScheme).removeModel(sourcePath)];case 5:_a.sent();_a.label=6;case 6:return[2,saveResult.modelArtifactsInfo]}})})}function listModels(){return __awaiter(this,void 0,void 0,function(){var schemes,out,_i,schemes_1,scheme,schemeOut,path,url;return __generator(this,function(_a){switch(_a.label){case 0:schemes=ModelStoreManagerRegistry.getSchemes();out={};_i=0,schemes_1=schemes;_a.label=1;case 1:if(!(_i<schemes_1.length))return[3,4];scheme=schemes_1[_i];return[4,ModelStoreManagerRegistry.getManager(scheme).listModels()];case 2:schemeOut=_a.sent();for(path in schemeOut){url=scheme+URL_SCHEME_SUFFIX+path;out[url]=schemeOut[path]}_a.label=3;case 3:_i++;return[3,1];case 4:return[2,out]}})})}exports.listModels=listModels;function removeModel(url){return __awaiter(this,void 0,void 0,function(){var schemeAndPath,manager;return __generator(this,function(_a){switch(_a.label){case 0:schemeAndPath=parseURL(url);manager=ModelStoreManagerRegistry.getManager(schemeAndPath.scheme);return[4,manager.removeModel(schemeAndPath.path)];case 1:return[2,_a.sent()]}})})}exports.removeModel=removeModel;function copyModel(sourceURL,destURL){return __awaiter(this,void 0,void 0,function(){var deleteSource;return __generator(this,function(_a){switch(_a.label){case 0:deleteSource=false;return[4,cloneModelInternal(sourceURL,destURL,deleteSource)];case 1:return[2,_a.sent()]}})})}exports.copyModel=copyModel;function moveModel(sourceURL,destURL){return __awaiter(this,void 0,void 0,function(){var deleteSource;return __generator(this,function(_a){switch(_a.label){case 0:deleteSource=true;return[4,cloneModelInternal(sourceURL,destURL,deleteSource)];case 1:return[2,_a.sent()]}})})}exports.moveModel=moveModel},{"../util":185,"./router_registry":64}],63:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var PassthroughLoader=function(){function PassthroughLoader(modelTopology,weightSpecs,weightData){this.modelTopology=modelTopology;this.weightSpecs=weightSpecs;this.weightData=weightData}PassthroughLoader.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){result={};if(this.modelTopology!=null){result=__assign({modelTopology:this.modelTopology},result)}if(this.weightSpecs!=null&&this.weightSpecs.length>0){result=__assign({weightSpecs:this.weightSpecs},result)}if(this.weightData!=null&&this.weightData.byteLength>0){result=__assign({weightData:this.weightData},result)}return[2,result]})})};return PassthroughLoader}();var PassthroughSaver=function(){function PassthroughSaver(saveHandler){this.saveHandler=saveHandler}PassthroughSaver.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.saveHandler(modelArtifacts)]})})};return PassthroughSaver}();function fromMemory(modelTopology,weightSpecs,weightData){return new PassthroughLoader(modelTopology,weightSpecs,weightData)}exports.fromMemory=fromMemory;function withSaveHandler(saveHandler){return new PassthroughSaver(saveHandler)}exports.withSaveHandler=withSaveHandler},{}],64:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var IORouterRegistry=function(){function IORouterRegistry(){this.saveRouters=[];this.loadRouters=[]}IORouterRegistry.getInstance=function(){if(IORouterRegistry.instance==null){IORouterRegistry.instance=new IORouterRegistry}return IORouterRegistry.instance};IORouterRegistry.registerSaveRouter=function(saveRouter){IORouterRegistry.getInstance().saveRouters.push(saveRouter)};IORouterRegistry.registerLoadRouter=function(loadRouter){IORouterRegistry.getInstance().loadRouters.push(loadRouter)};IORouterRegistry.getSaveHandlers=function(url){return IORouterRegistry.getHandlers(url,"save")};IORouterRegistry.getLoadHandlers=function(url){return IORouterRegistry.getHandlers(url,"load")};IORouterRegistry.getHandlers=function(url,handlerType){var validHandlers=[];var routers=handlerType==="load"?this.getInstance().loadRouters:this.getInstance().saveRouters;routers.forEach(function(router){var handler=router(url);if(handler!==null){validHandlers.push(handler)}});return validHandlers};return IORouterRegistry}();exports.IORouterRegistry=IORouterRegistry},{}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DTYPE_VALUE_SIZE_MAP={float32:4,int32:4,uint16:2,uint8:1,bool:1}},{}],66:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var util=require("../util");var io_utils_1=require("./io_utils");var types_1=require("./types");function loadWeightsAsArrayBuffer(fetchURLs,requestOptions){return __awaiter(this,void 0,void 0,function(){var requests,responses,buffers;return __generator(this,function(_a){switch(_a.label){case 0:requests=fetchURLs.map(function(fetchURL){return fetch(fetchURL,requestOptions)});return[4,Promise.all(requests)];case 1:responses=_a.sent();return[4,Promise.all(responses.map(function(response){return response.arrayBuffer()}))];case 2:buffers=_a.sent();return[2,buffers]}})})}exports.loadWeightsAsArrayBuffer=loadWeightsAsArrayBuffer;function loadWeights(manifest,filePathPrefix,weightNames,requestOptions){if(filePathPrefix===void 0){filePathPrefix=""}return __awaiter(this,void 0,void 0,function(){var groupIndicesToFetchMap,groupWeightsToFetch,weightsFound,allManifestWeightNames,weightsNotFound,groupIndicesToFetch,fetchUrls,buffers,weightsTensorMap,bufferIndexOffset;return __generator(this,function(_a){switch(_a.label){case 0:groupIndicesToFetchMap=manifest.map(function(){return false});groupWeightsToFetch={};weightsFound=weightNames!=null?weightNames.map(function(){return false}):[];allManifestWeightNames=[];manifest.forEach(function(manifestGroupConfig,groupIndex){var groupOffset=0;manifestGroupConfig.weights.forEach(function(weightsEntry){var rawDtype="quantization"in weightsEntry?weightsEntry.quantization.dtype:weightsEntry.dtype;var weightsBytes=types_1.DTYPE_VALUE_SIZE_MAP[rawDtype]*util.sizeFromShape(weightsEntry.shape);var enqueueWeightsForFetchingFn=function(){groupIndicesToFetchMap[groupIndex]=true;if(groupWeightsToFetch[groupIndex]==null){groupWeightsToFetch[groupIndex]=[]}groupWeightsToFetch[groupIndex].push({manifestEntry:weightsEntry,groupOffset:groupOffset,sizeBytes:weightsBytes})};if(weightNames!=null){weightNames.forEach(function(weightName,weightIndex){if(weightName===weightsEntry.name){enqueueWeightsForFetchingFn();weightsFound[weightIndex]=true}})}else{enqueueWeightsForFetchingFn()}allManifestWeightNames.push(weightsEntry.name);groupOffset+=weightsBytes})});if(!weightsFound.every(function(found){return found})){weightsNotFound=weightNames.filter(function(weight,i){return!weightsFound[i]});throw new Error("Could not find weights in manifest with names: "+(weightsNotFound.join(", ")+". \n")+"Manifest JSON has weights with names: "+(allManifestWeightNames.join(", ")+"."))}groupIndicesToFetch=groupIndicesToFetchMap.reduce(function(accumulator,shouldFetch,i){if(shouldFetch){accumulator.push(i)}return accumulator},[]);fetchUrls=[];groupIndicesToFetch.forEach(function(i){manifest[i].paths.forEach(function(filepath){var fetchUrl=filePathPrefix+(!filePathPrefix.endsWith("/")?"/":"")+filepath;fetchUrls.push(fetchUrl)})});return[4,loadWeightsAsArrayBuffer(fetchUrls,requestOptions)];case 1:buffers=_a.sent();weightsTensorMap={};bufferIndexOffset=0;groupIndicesToFetch.forEach(function(i){var numBuffers=manifest[i].paths.length;var groupBytes=0;for(var i_1=0;i_1<numBuffers;i_1++){groupBytes+=buffers[bufferIndexOffset+i_1].byteLength}var groupBuffer=new ArrayBuffer(groupBytes);var groupByteBuffer=new Uint8Array(groupBuffer);var groupBufferOffset=0;for(var i_2=0;i_2<numBuffers;i_2++){var buffer=new Uint8Array(buffers[bufferIndexOffset+i_2]);groupByteBuffer.set(buffer,groupBufferOffset);groupBufferOffset+=buffer.byteLength}var weightsEntries=groupWeightsToFetch[i];weightsEntries.forEach(function(weightsEntry){var byteBuffer=groupBuffer.slice(weightsEntry.groupOffset,weightsEntry.groupOffset+weightsEntry.sizeBytes);var nameToTensorMap=io_utils_1.decodeWeights(byteBuffer,[weightsEntry.manifestEntry]);for(var name_1 in nameToTensorMap){weightsTensorMap[name_1]=nameToTensorMap[name_1]}});bufferIndexOffset+=numBuffers});return[2,weightsTensorMap]}})})}exports.loadWeights=loadWeights},{"../util":185,"./io_utils":60,"./types":65}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DataStorage=function(){function DataStorage(dataMover){this.dataMover=dataMover;this.data=new WeakMap}DataStorage.prototype.get=function(dataId){if(!this.data.has(dataId)){this.dataMover.moveData(dataId)}return this.data.get(dataId)};DataStorage.prototype.set=function(dataId,value){this.data.set(dataId,value)};DataStorage.prototype.has=function(dataId){return this.data.has(dataId)};DataStorage.prototype.delete=function(dataId){return this.data.delete(dataId)};return DataStorage}();exports.DataStorage=DataStorage},{}],68:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var seedrandom=require("seedrandom");var environment_1=require("../environment");var log_1=require("../log");var array_ops_util=require("../ops/array_ops_util");var axis_util=require("../ops/axis_util");var broadcast_util=require("../ops/broadcast_util");var concat_util=require("../ops/concat_util");var erf_util=require("../ops/erf_util");var ops=require("../ops/ops");var ops_1=require("../ops/ops");var selu_util=require("../ops/selu_util");var slice_util_1=require("../ops/slice_util");var tensor_1=require("../tensor");var types_1=require("../types");var util=require("../util");var util_1=require("../util");var backend_1=require("./backend");var backend_util=require("./backend_util");var complex_util=require("./complex_util");var non_max_suppression_impl_1=require("./non_max_suppression_impl");var split_shared_1=require("./split_shared");var topk_impl_1=require("./topk_impl");var where_impl_1=require("./where_impl");var MathBackendCPU=function(){function MathBackendCPU(){this.blockSize=48;this.firstUse=true;if(environment_1.ENV.get("IS_BROWSER")){this.canvas=document.createElement("canvas")}}MathBackendCPU.prototype.setDataMover=function(dataMover){this.data=new backend_1.DataStorage(dataMover)};MathBackendCPU.prototype.register=function(dataId,shape,dtype){if(this.firstUse){this.firstUse=false;if(environment_1.ENV.get("IS_NODE")){log_1.warn("\n============================\n"+"Hi there . Looks like you are running TensorFlow.js in "+"Node.js. To speed things up dramatically, install our node "+"backend, which binds to TensorFlow C++, by running "+"npm i @tensorflow/tfjs-node, "+"or npm i @tensorflow/tfjs-node-gpu if you have CUDA. "+"Then call require('@tensorflow/tfjs-node'); (-gpu "+"suffix for CUDA) at the start of your program. "+"Visit https://github.com/tensorflow/tfjs-node for more details."+"\n============================\n")}}if(this.data.has(dataId)){throw new Error("Data buffer is already registered")}this.data.set(dataId,{dtype:dtype})};MathBackendCPU.prototype.write=function(dataId,values){if(values==null){throw new Error("MathBackendCPU.write(): values can not be null")}this.data.get(dataId).values=values};MathBackendCPU.prototype.fromPixels=function(pixels,numChannels){if(pixels==null){throw new Error("pixels passed to tf.fromPixels() can not be null")}var vals;if(environment_1.ENV.get("IS_NODE")&&pixels.getContext==null){throw new Error("When running in node, pixels must be an HTMLCanvasElement "+"like the one returned by the `canvas` npm package")}if(pixels.getContext!=null){vals=pixels.getContext("2d").getImageData(0,0,pixels.width,pixels.height).data}else if(pixels instanceof ImageData){vals=pixels.data}else if(pixels instanceof HTMLImageElement||pixels instanceof HTMLVideoElement){if(this.canvas==null){throw new Error("Can't read pixels from HTMLImageElement outside "+"the browser.")}this.canvas.width=pixels.width;this.canvas.height=pixels.height;this.canvas.getContext("2d").drawImage(pixels,0,0,pixels.width,pixels.height);vals=this.canvas.getContext("2d").getImageData(0,0,pixels.width,pixels.height).data}else{throw new Error("pixels passed to tf.fromPixels() must be either an "+"HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or "+("ImageData, but was "+pixels.constructor.name))}var values;if(numChannels===4){values=new Int32Array(vals)}else{var numPixels=pixels.width*pixels.height;values=new Int32Array(numPixels*numChannels);for(var i=0;i<numPixels;i++){for(var channel=0;channel<numChannels;++channel){values[i*numChannels+channel]=vals[i*4+channel]}}}var outShape=[pixels.height,pixels.width,numChannels];return ops_1.tensor3d(values,outShape,"int32")};MathBackendCPU.prototype.read=function(dataId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.readSync(dataId)]})})};MathBackendCPU.prototype.readSync=function(dataId){var _a=this.data.get(dataId),dtype=_a.dtype,complexTensors=_a.complexTensors;if(dtype==="complex64"){var realValues=complexTensors.real.dataSync();var imagValues=complexTensors.imag.dataSync();return complex_util.mergeRealAndImagArrays(realValues,imagValues)}return this.data.get(dataId).values};MathBackendCPU.prototype.disposeData=function(dataId){if(this.data.has(dataId)){var complexTensors=this.data.get(dataId).complexTensors;if(complexTensors!=null){complexTensors.real.dispose();complexTensors.imag.dispose()}this.data.delete(dataId)}};MathBackendCPU.prototype.time=function(f){return __awaiter(this,void 0,void 0,function(){var start,kernelMs;return __generator(this,function(_a){start=util_1.now();f();kernelMs=util_1.now()-start;return[2,{kernelMs:kernelMs}]})})};MathBackendCPU.prototype.memory=function(){return{unreliable:true}};MathBackendCPU.prototype.complex=function(real,imag){var result=tensor_1.Tensor.make(real.shape,{},"complex64");var resultData=this.data.get(result.dataId);resultData.complexTensors={real:environment_1.ENV.engine.keep(real.clone()),imag:environment_1.ENV.engine.keep(imag.clone())};return result};MathBackendCPU.prototype.real=function(input){var resultData=this.data.get(input.dataId);return resultData.complexTensors.real.clone()};MathBackendCPU.prototype.imag=function(input){var resultData=this.data.get(input.dataId);return resultData.complexTensors.imag.clone()};MathBackendCPU.prototype.assertNotComplex=function(tensor,opName){if(!Array.isArray(tensor)){tensor=[tensor]}tensor.forEach(function(t){if(t!=null){util.assert(t.dtype!=="complex64",opName+" does not support complex64 tensors.")}})};MathBackendCPU.prototype.slice=function(x,begin,size){this.assertNotComplex(x,"slice");var buffer=ops.buffer(size,x.dtype);for(var i=0;i<buffer.size;++i){var loc=buffer.indexToLoc(i);var xLoc=loc.map(function(idx,j){return idx+begin[j]});buffer.set.apply(buffer,[x.get.apply(x,xLoc)].concat(loc))}return buffer.toTensor()};MathBackendCPU.prototype.stridedSlice=function(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){this.assertNotComplex(x,"stridedSlice");var _a=slice_util_1.getStridedSlicedInfo(x.shape,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask),beginIndex=_a[0],size=_a[1],shrinkAxis=_a[2];var shape=size.filter(function(v,index){return shrinkAxis.indexOf(index)===-1});if(shape.some(function(axis){return axis===0})){return ops.tensor([],shape)}var buffer=ops.buffer(size,x.dtype);for(var i=0;i<buffer.size;i++){var loc=buffer.indexToLoc(i);var newLoc=new Array(loc.length);for(var j=0;j<newLoc.length;j++){newLoc[j]=loc[j]*strides[j]+beginIndex[j]}buffer.set.apply(buffer,[x.get.apply(x,newLoc)].concat(loc))}return buffer.toTensor().reshape(shape)};MathBackendCPU.prototype.reverse=function(x,axis){this.assertNotComplex(x,"reverse");var buffer=ops.buffer(x.shape,x.dtype);var xBuffer=x.buffer();var _loop_1=function(i){var outLoc=buffer.indexToLoc(i);var inLoc=outLoc.slice();axis.forEach(function(ax){return inLoc[ax]=x.shape[ax]-1-inLoc[ax]});buffer.set.apply(buffer,[xBuffer.get.apply(xBuffer,inLoc)].concat(outLoc))};for(var i=0;i<buffer.size;i++){_loop_1(i)}return buffer.toTensor()};MathBackendCPU.prototype.concat=function(tensors,axis){this.assertNotComplex(tensors,"concat");var tensors2D=tensors.map(function(t){var innerSize=util.sizeFromShape(t.shape.slice(axis));return t.as2D(-1,innerSize)});var outShape=concat_util.computeOutShape(tensors2D.map(function(t){return t.shape}),1);var values=ops.buffer(outShape,tensors[0].dtype).values;if(tensors2D[0].shape[0]===1){var offset_1=0;tensors2D.forEach(function(t){values.set(t.dataSync(),offset_1);offset_1+=t.size})}else{var colOffset_1=0;tensors2D.forEach(function(t){var tVals=t.dataSync();var tIdx=0;for(var row=0;row<t.shape[0];++row){var resIdx=row*outShape[1]+colOffset_1;for(var col=0;col<t.shape[1];++col){values[resIdx+col]=tVals[tIdx++]}}colOffset_1+=t.shape[1]})}var finalOutShape=concat_util.computeOutShape(tensors.map(function(t){return t.shape}),axis);return ops_1.tensor(values,finalOutShape,tensors[0].dtype)};MathBackendCPU.prototype.neg=function(x){this.assertNotComplex(x,"neg");return this.multiply(ops.scalar(-1),x)};MathBackendCPU.prototype.add=function(a,b){if(a.dtype==="complex64"||b.dtype==="complex64"){return this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(aReal,aImag,bReal,bImag){return{real:aReal+bReal,imag:aImag+bImag}})}return this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),function(aValue,bValue){return aValue+bValue})};MathBackendCPU.prototype.addN=function(tensors){this.assertNotComplex(tensors,"addN");var vals=tensors.map(function(t){return t.dataSync()});var result=ops.buffer(tensors[0].shape,tensors[0].dtype);var resultVals=result.values;for(var i=0;i<tensors.length;i++){var currVals=vals[i];for(var j=0;j<resultVals.length;j++){resultVals[j]+=currVals[j]}}return result.toTensor()};MathBackendCPU.prototype.subtract=function(a,b){if(a.dtype==="complex64"||b.dtype==="complex64"){return this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(aReal,aImag,bReal,bImag){return{real:aReal-bReal,imag:aImag-bImag}})}return this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),function(aValue,bValue){return aValue-bValue})};MathBackendCPU.prototype.pow=function(a,b){this.assertNotComplex([a,b],"pow");return this.broadcastedBinaryOp(a,b,a.dtype,function(aValue,bValue){return Math.pow(aValue,bValue)})};MathBackendCPU.prototype.batchMatMul=function(a,b,transposeA,transposeB){this.assertNotComplex([a,b],"matMul");var sharedDim=transposeA?a.shape[1]:a.shape[2];var leftDim=transposeA?a.shape[2]:a.shape[1];var rightDim=transposeB?b.shape[1]:b.shape[2];var batchDim=a.shape[0];var aValues=a.dataSync();var bValues=b.dataSync();var _a=transposeA?[a.strides[0],1,a.strides[1]]:[a.strides[0],a.strides[1],1],aBatch=_a[0],aOuterStep=_a[1],aInnerStep=_a[2];var _b=transposeB?[1,b.strides[1],b.strides[0]]:[b.strides[1],1,b.strides[0]],bInnerStep=_b[0],bOuterStep=_b[1],bBatch=_b[2];var size=leftDim*rightDim;var result=new Float32Array(batchDim*size);var blockSize=this.blockSize;for(var b_1=0;b_1<batchDim;b_1++){for(var i0=0;i0<leftDim;i0+=blockSize){for(var j0=0;j0<rightDim;j0+=blockSize){for(var k0=0;k0<sharedDim;k0+=blockSize){var iBlock=Math.min(i0+blockSize,leftDim);var jBlock=Math.min(j0+blockSize,rightDim);var kBlock=Math.min(k0+blockSize,sharedDim);for(var i=i0;i<iBlock;i++){for(var j=j0;j<jBlock;j++){var sum=0;for(var k=k0;k<kBlock;k++){sum+=aValues[b_1*aBatch+i*aOuterStep+k*aInnerStep]*bValues[k*bInnerStep+j*bOuterStep+b_1*bBatch]}result[b_1*size+(i*rightDim+j)]+=sum}}}}}}return ops.tensor3d(result,[batchDim,leftDim,rightDim])};MathBackendCPU.prototype.multiply=function(a,b){if(a.dtype==="complex64"||b.dtype==="complex64"){return this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(aReal,aImag,bReal,bImag){return{real:aReal*bReal-aImag*bImag,imag:aReal*bImag+aImag*bReal}})}return this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),function(aValue,bValue){return aValue*bValue})};MathBackendCPU.prototype.realDivide=function(a,b){this.assertNotComplex([a,b],"realDivide");var op=function(a,b){return a/b};var outputDtype="float32";return this.broadcastedBinaryOp(a,b,outputDtype,op)};MathBackendCPU.prototype.floorDiv=function(a,b){this.assertNotComplex([a,b],"floorDiv");var op=function(a,b){return Math.floor(a/b)};var outputDtype="int32";return this.broadcastedBinaryOp(a,b,outputDtype,op)};MathBackendCPU.prototype.sum=function(x,axes){this.assertNotComplex(x,"sum");axis_util.assertAxesAreInnerMostDims("sum",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var resultDtype=types_1.upcastType(x.dtype,"int32");var result=ops.zeros(outShape,resultDtype);var reduceSize=util.sizeFromShape(reduceShape);var vals=result.dataSync();var aVals=x.dataSync();for(var i=0;i<vals.length;++i){var offset=i*reduceSize;var sum=0;for(var j=0;j<reduceSize;++j){sum+=aVals[offset+j]}vals[i]=sum}return result};MathBackendCPU.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){this.assertNotComplex(x,"unsortedSegmentSum");var res=[];var numIters=x.rank-segmentIds.rank;for(var i=0;i<numIters;++i){segmentIds=segmentIds.expandDims(i+1)}for(var i=0;i<numSegments;++i){var segmentId=ops.scalar(i,"int32");var mask=ops.equal(segmentId,segmentIds).asType("float32");var sum=mask.mul(x).sum(0);res.push(sum)}return ops.stack(res)};MathBackendCPU.prototype.argMin=function(x,axis){this.assertNotComplex(x,"argMin");var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMin",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var result=ops.zeros(outShape,"int32");var reduceSize=util.sizeFromShape(reduceShape);var vals=result.dataSync();var aVals=x.dataSync();for(var i=0;i<vals.length;++i){var offset=i*reduceSize;var min=aVals[offset];var minIndex=0;for(var j=0;j<reduceSize;++j){var value=aVals[offset+j];if(value<min){min=value;minIndex=j}}vals[i]=minIndex}return result};MathBackendCPU.prototype.argMax=function(x,axis){this.assertNotComplex(x,"argMax");var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMax",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var result=ops.zeros(outShape,"int32");var reduceSize=util.sizeFromShape(reduceShape);var vals=result.dataSync();var aVals=x.dataSync();for(var i=0;i<vals.length;++i){var offset=i*reduceSize;var max=aVals[offset];var maxIndex=0;for(var j=0;j<reduceSize;++j){var value=aVals[offset+j];if(value>max){max=value;maxIndex=j}}vals[i]=maxIndex}return result};MathBackendCPU.prototype.cumsum=function(x,axis,exclusive,reverse){this.assertNotComplex(x,"cumsum");if(axis!==x.rank-1){throw new Error("backend.cumsum in CPU expects an inner-most axis="+(x.rank-1)+" "+("but got axis="+axis))}var resultDtype=types_1.upcastType(x.dtype,"int32");var result=ops.zeros(x.shape,resultDtype);var vals=result.dataSync();var aVals=x.dataSync();var finalDim=x.shape[x.rank-1];var indexAdjuster=reverse?function(i,j){return i+finalDim-j-1}:function(i,j){return i+j};for(var i=0;i<aVals.length;i+=finalDim){for(var j=0;j<finalDim;j++){var idx=indexAdjuster(i,j);if(j===0){vals[idx]=exclusive?0:aVals[idx]}else{var prevIdx=indexAdjuster(i,j-1);vals[idx]=exclusive?aVals[prevIdx]+vals[prevIdx]:aVals[idx]+vals[prevIdx]}}}return result};MathBackendCPU.prototype.equal=function(a,b){this.assertNotComplex([a,b],"equal");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal===bVal?1:0})};MathBackendCPU.prototype.notEqual=function(a,b){this.assertNotComplex([a,b],"notEqual");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal!==bVal?1:0})};MathBackendCPU.prototype.less=function(a,b){this.assertNotComplex([a,b],"less");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal<bVal?1:0})};MathBackendCPU.prototype.lessEqual=function(a,b){this.assertNotComplex([a,b],"lessEqual");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal<=bVal?1:0})};MathBackendCPU.prototype.greater=function(a,b){this.assertNotComplex([a,b],"greater");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal>bVal?1:0})};MathBackendCPU.prototype.greaterEqual=function(a,b){this.assertNotComplex([a,b],"greaterEqual");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal>=bVal?1:0})};MathBackendCPU.prototype.logicalNot=function(x){this.assertNotComplex(x,"logicalNot");var values=x.dataSync();var newValues=new Int32Array(values.length);for(var i=0;i<values.length;++i){newValues[i]=values[i]?0:1}return tensor_1.Tensor.make(x.shape,{values:newValues},"bool")};MathBackendCPU.prototype.logicalAnd=function(a,b){this.assertNotComplex([a,b],"logicalAnd");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal&&bVal})};MathBackendCPU.prototype.logicalOr=function(a,b){this.assertNotComplex([a,b],"logicalOr");return this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal||bVal})};MathBackendCPU.prototype.select=function(condition,a,b){this.assertNotComplex([condition,a,b],"select");var values=condition.dataSync();var aValues=a.dataSync();var bValues=b.dataSync();var result=ops.zeros(a.shape,types_1.upcastType(a.dtype,b.dtype));var newValues=result.dataSync();var index=0;var offset=condition.rank===0||condition.rank>1||a.rank===1?1:a.shape[1];for(var i=0;i<values.length;i++){for(var j=0;j<offset;j++){if(values[i]===1){newValues[index++]=aValues[i]}else{newValues[index++]=bValues[i]}}}return result};MathBackendCPU.prototype.where=function(condition){this.assertNotComplex([condition],"where");var condVals=condition.dataSync();return where_impl_1.whereImpl(condition.shape,condVals)};MathBackendCPU.prototype.topk=function(x,k,sorted){this.assertNotComplex(x,"topk");var xVals=x.dataSync();return topk_impl_1.topkImpl(xVals,x.shape,x.dtype,k,sorted)};MathBackendCPU.prototype.min=function(x,axes){this.assertNotComplex(x,"min");axis_util.assertAxesAreInnerMostDims("min",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var result=ops.zeros(outShape,x.dtype);var reduceSize=util.sizeFromShape(reduceShape);var vals=result.dataSync();var aVals=x.dataSync();for(var i=0;i<vals.length;++i){var offset=i*reduceSize;var min=aVals[offset];for(var j=0;j<reduceSize;++j){var value=aVals[offset+j];if(value<min){min=value}}vals[i]=min}return result};MathBackendCPU.prototype.minimum=function(a,b){this.assertNotComplex([a,b],"minimum");return this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){return Math.min(aVal,bVal)})};MathBackendCPU.prototype.mod=function(a,b){this.assertNotComplex([a,b],"mod");return this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){var rem=aVal%bVal;if(aVal<0&&bVal<0||aVal>=0&&bVal>=0){return rem}else{return(rem+bVal)%bVal}})};MathBackendCPU.prototype.max=function(x,axes){this.assertNotComplex(x,"max");axis_util.assertAxesAreInnerMostDims("max",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var result=ops.zeros(outShape,x.dtype);var reduceSize=util.sizeFromShape(reduceShape);var vals=result.dataSync();var aVals=x.dataSync();for(var i=0;i<vals.length;++i){var offset=i*reduceSize;var max=aVals[offset];for(var j=0;j<reduceSize;++j){var value=aVals[offset+j];if(value>max){max=value}}vals[i]=max}return result};MathBackendCPU.prototype.maximum=function(a,b){this.assertNotComplex([a,b],"maximum");return this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){return Math.max(aVal,bVal)})};MathBackendCPU.prototype.all=function(x,axes){this.assertNotComplex(x,"all");axis_util.assertAxesAreInnerMostDims("all",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var result=ops.zeros(outShape,x.dtype);var reduceSize=util.sizeFromShape(reduceShape);var vals=result.dataSync();var aVals=x.dataSync();for(var i=0;i<vals.length;++i){var offset=i*reduceSize;var all=aVals[offset];for(var j=0;j<reduceSize;++j){var value=aVals[offset+j];all=all&&value}vals[i]=all}return result};MathBackendCPU.prototype.any=function(x,axes){this.assertNotComplex(x,"any");axis_util.assertAxesAreInnerMostDims("any",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var result=ops.zeros(outShape,x.dtype);var reduceSize=util.sizeFromShape(reduceShape);var vals=result.dataSync();var aVals=x.dataSync();for(var i=0;i<vals.length;++i){var offset=i*reduceSize;var anyVal=aVals[offset];for(var j=0;j<reduceSize;++j){var value=aVals[offset+j];anyVal=anyVal||value}vals[i]=anyVal}return result};MathBackendCPU.prototype.squaredDifference=function(a,b){this.assertNotComplex([a,b],"squaredDifference");return this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){var diff=aVal-bVal;return diff*diff})};MathBackendCPU.prototype.ceil=function(x){this.assertNotComplex(x,"ceil");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){newValues[i]=Math.ceil(values[i])}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.floor=function(x){this.assertNotComplex(x,"floor");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){newValues[i]=Math.floor(values[i])}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.sign=function(x){this.assertNotComplex(x,"x");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){if(values[i]<0){newValues[i]=-1}else if(values[i]>0){newValues[i]=1}else{newValues[i]=0}}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.round=function(x){this.assertNotComplex(x,"round");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){var base=Math.floor(values[i]);if(values[i]-base<.5){newValues[i]=Math.floor(values[i])}else if(values[i]-base>.5){newValues[i]=Math.ceil(values[i])}else{if(base%2===0){newValues[i]=base}else{newValues[i]=base+1}}}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.exp=function(x){this.assertNotComplex(x,"exp");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){newValues[i]=Math.exp(values[i])}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.expm1=function(x){this.assertNotComplex(x,"expm1");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){newValues[i]=Math.expm1(values[i])}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.log=function(x){this.assertNotComplex(x,"log");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.log(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.log1p=function(x){this.assertNotComplex(x,"log1p");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.log1p(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.sqrt=function(x){this.assertNotComplex(x,"sqrt");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.sqrt(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.rsqrt=function(x){this.assertNotComplex(x,"rsqrt");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){var value=values[i];newValues[i]=1/Math.sqrt(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.square=function(x){this.assertNotComplex(x,"square");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){var value=values[i];newValues[i]=value*value}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.reciprocal=function(x){this.assertNotComplex(x,"reciprocal");var values=x.dataSync();var newValues=new Float32Array(values.length);for(var i=0;i<values.length;++i){newValues[i]=1/values[i]}return tensor_1.Tensor.make(x.shape,{values:newValues})};MathBackendCPU.prototype.relu=function(x){this.assertNotComplex(x,"relu");var res=ops.zeros(x.shape,x.dtype);var resVals=res.dataSync();var inVals=x.dataSync();for(var i=0;i<inVals.length;++i){resVals[i]=Math.max(0,inVals[i])}return res};MathBackendCPU.prototype.elu=function(x){this.assertNotComplex(x,"elu");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){var v=values[i];if(v>=0){resultValues[i]=v}else{resultValues[i]=Math.exp(v)-1}}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.eluDer=function(dy,y){this.assertNotComplex([dy,y],"eluDer");var resultValues=new Float32Array(y.size);var values=y.dataSync();var dyValues=dy.dataSync();for(var i=0;i<values.length;++i){var v=values[i];if(v>=1){resultValues[i]=dyValues[i]}else{resultValues[i]=dyValues[i]*(v+1)}}return tensor_1.Tensor.make(y.shape,{values:resultValues})};MathBackendCPU.prototype.selu=function(x){this.assertNotComplex(x,"selu");var scaleAlpha=selu_util.SELU_SCALEALPHA;var scale=selu_util.SELU_SCALE;var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){var v=values[i];if(v>=0){resultValues[i]=scale*v}else{resultValues[i]=scaleAlpha*(Math.exp(v)-1)}}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.clip=function(x,min,max){this.assertNotComplex(x,"clip");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>max?max:v<min?min:v}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.abs=function(x){this.assertNotComplex(x,"abs");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.abs(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.int=function(x){this.assertNotComplex(x,"int");var resultValues=new Int32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=values[i]}return tensor_1.Tensor.make(x.shape,{values:resultValues},"int32")};MathBackendCPU.prototype.sigmoid=function(x){this.assertNotComplex(x,"sigmoid");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=1/(1+Math.exp(-values[i]))}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.softplus=function(x){this.assertNotComplex(x,"softplus");var epsilon=1.1920928955078125e-7;var threshold=Math.log(epsilon)+2;var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){var tooLarge=values[i]>-threshold;var tooSmall=values[i]<threshold;var expX=Math.exp(values[i]);var result=void 0;if(tooSmall){result=expX}else if(tooLarge){result=values[i]}else{result=Math.log(1+expX)}resultValues[i]=result}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.sin=function(x){this.assertNotComplex(x,"sin");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.sin(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.cos=function(x){this.assertNotComplex(x,"cos");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.cos(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.tan=function(x){this.assertNotComplex(x,"tan");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.tan(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.asin=function(x){this.assertNotComplex(x,"asin");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.asin(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.acos=function(x){this.assertNotComplex(x,"acos");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.acos(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.atan=function(x){this.assertNotComplex(x,"atan");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.atan(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.atan2=function(a,b){this.assertNotComplex([a,b],"atan2");return this.broadcastedBinaryOp(a,b,a.dtype,function(aValue,bValue){return Math.atan2(aValue,bValue)})};MathBackendCPU.prototype.sinh=function(x){this.assertNotComplex(x,"sinh");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.sinh(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.cosh=function(x){this.assertNotComplex(x,"cosh");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.cosh(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.tanh=function(x){this.assertNotComplex(x,"tanh");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=util.tanh(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.asinh=function(x){this.assertNotComplex(x,"asinh");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.asinh(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.acosh=function(x){this.assertNotComplex(x,"acosh");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.acosh(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.atanh=function(x){this.assertNotComplex(x,"atanh");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){resultValues[i]=Math.atanh(values[i])}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.erf=function(x){this.assertNotComplex(x,"erf");var resultValues=new Float32Array(x.size);var values=x.dataSync();var p=erf_util.ERF_P;var a1=erf_util.ERF_A1;var a2=erf_util.ERF_A2;var a3=erf_util.ERF_A3;var a4=erf_util.ERF_A4;var a5=erf_util.ERF_A5;for(var i=0;i<values.length;++i){var v=values[i];var t=1/(1+p*v);resultValues[i]=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-v*v)}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.step=function(x,alpha){if(alpha===void 0){alpha=0}this.assertNotComplex(x,"step");var resultValues=new Float32Array(x.size);var values=x.dataSync();for(var i=0;i<values.length;++i){var value=values[i];if(isNaN(value)){resultValues[i]=NaN}else{resultValues[i]=value>0?1:alpha}}return tensor_1.Tensor.make(x.shape,{values:resultValues})};MathBackendCPU.prototype.conv2d=function(x,filter,convInfo){this.assertNotComplex([x,filter],"conv2d");var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var dilationHeight=convInfo.dilationHeight;var dilationWidth=convInfo.dilationWidth;var padLeft=convInfo.padInfo.left;var padTop=convInfo.padInfo.top;var y=ops.buffer(convInfo.outShape,x.dtype);var xVals=x.dataSync();var wVals=filter.dataSync();var yVals=y.values;for(var b=0;b<convInfo.batchSize;++b){var xOffset1=b*x.strides[0];var yOffset1=b*y.strides[0];for(var yR=0;yR<convInfo.outHeight;++yR){var yOffset2=yOffset1+yR*y.strides[1];var xRCorner=yR*convInfo.strideHeight-padLeft;for(var wR=0;wR<filterHeight;wR++){var xR=xRCorner+wR*dilationHeight;if(xR<0||xR>=convInfo.inHeight){continue}var wOffset1=wR*filter.strides[0];var xOffset2=xOffset1+xR*x.strides[1];for(var yC=0;yC<convInfo.outWidth;++yC){var yOffset3=yOffset2+yC*convInfo.outChannels;var xCCorner=yC*convInfo.strideWidth-padTop;for(var wC=0;wC<filterWidth;wC++){var xC=xCCorner+wC*dilationWidth;if(xC<0||xC>=convInfo.inWidth){continue}var wOffset2=wOffset1+wC*filter.strides[1];var xOffset3=xOffset2+xC*convInfo.inChannels;var wOffset3=wOffset2;for(var d1=0;d1<convInfo.inChannels;++d1){var xVal=xVals[xOffset3+d1];for(var d2=0;d2<convInfo.outChannels;++d2){yVals[yOffset3+d2]+=xVal*wVals[wOffset3+d2]}wOffset3+=convInfo.outChannels}}}}}}return y.toTensor()};MathBackendCPU.prototype.conv2dDerInput=function(dy,filter,convInfo){this.assertNotComplex([dy,filter],"conv2dDerInput");var dx=ops.buffer(convInfo.inShape,"float32");var dxValues=dx.values;var _a=dx.strides,dxS0=_a[0],dxS1=_a[1],dxS2=_a[2];var dyValues=dy.dataSync();var _b=dy.strides,dyS0=_b[0],dyS1=_b[1],dyS2=_b[2];var fltValues=filter.dataSync();var _c=filter.strides,fltS0=_c[0],fltS1=_c[1],fltS2=_c[2];var batchSize=convInfo.batchSize,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,inHeight=convInfo.inHeight,inWidth=convInfo.inWidth,outChannels=convInfo.outChannels,outHeight=convInfo.outHeight,outWidth=convInfo.outWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth;var topPad=filterHeight-1-convInfo.padInfo.top;var leftPad=filterWidth-1-convInfo.padInfo.left;for(var b=0;b<batchSize;++b){for(var d1=0;d1<inChannels;++d1){for(var xR=0;xR<inHeight;++xR){var xRCorner=xR-topPad;var xRMin=Math.max(0,Math.ceil(xRCorner/strideHeight));var yRMax=Math.min(outHeight,(filterHeight+xRCorner)/strideHeight);for(var xC=0;xC<inWidth;++xC){var xCCorner=xC-leftPad;var xCMin=Math.max(0,Math.ceil(xCCorner/strideWidth));var yCMax=Math.min(outWidth,(filterWidth+xCCorner)/strideWidth);var dotProd=0;for(var yR=xRMin;yR<yRMax;++yR){var wR=yR*strideHeight-xRCorner;for(var yC=xCMin;yC<yCMax;++yC){var wC=yC*strideWidth-xCCorner;var dyOffset=dyS0*b+dyS1*yR+dyS2*yC;var fltOffset=fltS0*(filterHeight-1-wR)+fltS1*(filterWidth-1-wC)+fltS2*d1;for(var d2=0;d2<outChannels;++d2){var pixel=dyValues[dyOffset+d2];var weight=fltValues[fltOffset+d2];dotProd+=pixel*weight}}}dxValues[dxS0*b+dxS1*xR+dxS2*xC+d1]=dotProd}}}}return dx.toTensor()};MathBackendCPU.prototype.conv2dDerFilter=function(x,dy,convInfo){this.assertNotComplex([x,dy],"conv2dDerFilter");var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var dW=ops.buffer(convInfo.filterShape,"float32");var leftPad=convInfo.padInfo.left;var topPad=convInfo.padInfo.top;for(var wR=0;wR<filterHeight;++wR){var yRMin=Math.max(0,Math.ceil((topPad-wR)/strideHeight));var yRMax=Math.min(convInfo.outHeight,(convInfo.inHeight+topPad-wR)/strideHeight);for(var wC=0;wC<filterWidth;++wC){var yCMin=Math.max(0,Math.ceil((leftPad-wC)/strideWidth));var yCMax=Math.min(convInfo.outWidth,(convInfo.inWidth+leftPad-wC)/strideWidth);for(var d1=0;d1<convInfo.inChannels;++d1){for(var d2=0;d2<convInfo.outChannels;++d2){var dotProd=0;for(var b=0;b<convInfo.batchSize;++b){for(var yR=yRMin;yR<yRMax;++yR){var xR=wR+yR*strideHeight-topPad;for(var yC=yCMin;yC<yCMax;++yC){var xC=wC+yC*strideWidth-leftPad;dotProd+=x.get(b,xR,xC,d1)*dy.get(b,yR,yC,d2)}}}dW.set(dotProd,wR,wC,d1,d2)}}}}return dW.toTensor()};MathBackendCPU.prototype.depthwiseConv2D=function(x,filter,convInfo){this.assertNotComplex([x,filter],"depthwiseConv2D");var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var dilationHeight=convInfo.dilationHeight;var dilationWidth=convInfo.dilationWidth;var padLeft=convInfo.padInfo.left;var padTop=convInfo.padInfo.top;var chMul=convInfo.outChannels/convInfo.inChannels;var y=ops.buffer(convInfo.outShape,x.dtype);var xVals=x.dataSync();var wVals=filter.dataSync();var yVals=y.values;for(var b=0;b<convInfo.batchSize;++b){var xOffset1=b*x.strides[0];var yOffset1=b*y.strides[0];for(var yR=0;yR<convInfo.outHeight;++yR){var yOffset2=yOffset1+yR*y.strides[1];var xRCorner=yR*convInfo.strideHeight-padLeft;for(var wR=0;wR<filterHeight;++wR){var xR=xRCorner+wR*dilationHeight;if(xR<0||xR>=convInfo.inHeight){continue}var wOffset1=wR*filter.strides[0];var xOffset2=xOffset1+xR*x.strides[1];for(var yC=0;yC<convInfo.outWidth;++yC){var yOffset3=yOffset2+yC*y.strides[2];var xCCorner=yC*convInfo.strideWidth-padTop;for(var wC=0;wC<filterWidth;++wC){var xC=xCCorner+wC*dilationWidth;if(xC<0||xC>=convInfo.inWidth){continue}var wOffset2=wOffset1+wC*filter.strides[1];var xOffset3=xOffset2+xC*convInfo.inChannels;var yOffset4=yOffset3;var wOffset3=wOffset2;for(var d1=0;d1<convInfo.inChannels;++d1){var xVal=xVals[xOffset3+d1];for(var q=0;q<chMul;++q){yVals[yOffset4+q]+=xVal*wVals[wOffset3+q]}yOffset4+=chMul;wOffset3+=chMul}}}}}}return y.toTensor()};MathBackendCPU.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){this.assertNotComplex([dy,filter],"depthwiseConv2DDerInput");var dx=ops.buffer(convInfo.inShape,"float32");var dxValues=dx.values;var _a=dx.strides,dxS0=_a[0],dxS1=_a[1],dxS2=_a[2];var dyValues=dy.dataSync();var _b=dy.strides,dyS0=_b[0],dyS1=_b[1],dyS2=_b[2];var fltValues=filter.dataSync();var _c=filter.strides,fltS0=_c[0],fltS1=_c[1],fltS2=_c[2];var batchSize=convInfo.batchSize,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,inHeight=convInfo.inHeight,inWidth=convInfo.inWidth,outChannels=convInfo.outChannels,outHeight=convInfo.outHeight,outWidth=convInfo.outWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth;var topPad=filterHeight-1-convInfo.padInfo.top;var leftPad=filterWidth-1-convInfo.padInfo.left;var chMul=outChannels/inChannels;for(var b=0;b<batchSize;++b){for(var d1=0;d1<inChannels;++d1){for(var xR=0;xR<inHeight;++xR){var xRCorner=xR-topPad;var xRMin=Math.max(0,Math.ceil(xRCorner/strideHeight));var yRMax=Math.min(outHeight,(filterHeight+xRCorner)/strideHeight);for(var xC=0;xC<inWidth;++xC){var xCCorner=xC-leftPad;var xCMin=Math.max(0,Math.ceil(xCCorner/strideWidth));var yCMax=Math.min(outWidth,(filterWidth+xCCorner)/strideWidth);var dotProd=0;for(var yR=xRMin;yR<yRMax;++yR){var wR=yR*strideHeight-xRCorner;for(var yC=xCMin;yC<yCMax;++yC){var wC=yC*strideWidth-xCCorner;var dyOffset=dyS0*b+dyS1*yR+dyS2*yC;var fltOffset=fltS0*(filterHeight-1-wR)+fltS1*(filterWidth-1-wC)+fltS2*d1;for(var dm=0;dm<chMul;++dm){var d2=d1*chMul+dm;var pixel=dyValues[dyOffset+d2];var weight=fltValues[fltOffset+dm];dotProd+=pixel*weight}}}dxValues[dxS0*b+dxS1*xR+dxS2*xC+d1]=dotProd}}}}return dx.toTensor()};MathBackendCPU.prototype.depthwiseConv2DDerFilter=function(x,dy,convInfo){this.assertNotComplex([x,dy],"depthwiseConv2DDerFilter");var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var dW=ops.buffer(convInfo.filterShape,"float32");var leftPad=convInfo.padInfo.left;var topPad=convInfo.padInfo.top;var chMul=convInfo.outChannels/convInfo.inChannels;for(var wR=0;wR<filterHeight;++wR){var yRMin=Math.max(0,Math.ceil((topPad-wR)/strideHeight));var yRMax=Math.min(convInfo.outHeight,(convInfo.inHeight+topPad-wR)/strideHeight);for(var wC=0;wC<filterWidth;++wC){var yCMin=Math.max(0,Math.ceil((leftPad-wC)/strideWidth));var yCMax=Math.min(convInfo.outWidth,(convInfo.inWidth+leftPad-wC)/strideWidth);for(var d2=0;d2<convInfo.outChannels;++d2){var d1=Math.trunc(d2/chMul);var dm=d2%chMul;var dotProd=0;for(var b=0;b<convInfo.batchSize;++b){for(var yR=yRMin;yR<yRMax;++yR){var xR=wR+yR*strideHeight-topPad;for(var yC=yCMin;yC<yCMax;++yC){var xC=wC+yC*strideWidth-leftPad;dotProd+=x.get(b,xR,xC,d1)*dy.get(b,yR,yC,d2)}}}dW.set(dotProd,wR,wC,d1,dm)}}}return dW.toTensor()};MathBackendCPU.prototype.tile=function(x,reps){this.assertNotComplex(x,"tile");var newShape=new Array(x.rank);for(var i=0;i<newShape.length;i++){newShape[i]=x.shape[i]*reps[i]}var result=ops.buffer(newShape,x.dtype);var xBuf=x.buffer();for(var i=0;i<result.values.length;++i){var newLoc=result.indexToLoc(i);var originalLoc=new Array(x.rank);for(var i_1=0;i_1<originalLoc.length;i_1++){originalLoc[i_1]=newLoc[i_1]%x.shape[i_1]}var originalIndex=xBuf.locToIndex(originalLoc);result.values[i]=xBuf.values[originalIndex]}return result.toTensor()};MathBackendCPU.prototype.pad=function(x,paddings,constantValue){this.assertNotComplex(x,"pad");var outShape=paddings.map(function(p,i){return p[0]+x.shape[i]+p[1]});var start=paddings.map(function(p){return p[0]});var xBuffer=x.buffer();var buffer=ops.buffer(outShape,x.dtype);if(constantValue!==0){buffer.values.fill(constantValue)}for(var i=0;i<x.size;i++){var coords=xBuffer.indexToLoc(i);var outCoords=coords.map(function(c,i){return c+start[i]});buffer.set.apply(buffer,[x.get.apply(x,coords)].concat(outCoords))}return buffer.toTensor()};MathBackendCPU.prototype.transpose=function(x,perm){this.assertNotComplex(x,"transpose");var newShape=new Array(x.rank);for(var i=0;i<newShape.length;i++){newShape[i]=x.shape[perm[i]]}var values=x.dataSync();var result=ops_1.buffer(newShape,x.dtype);var xBuf=x.buffer();for(var i=0;i<x.size;++i){var loc=xBuf.indexToLoc(i);var newLoc=new Array(loc.length);for(var i_2=0;i_2<newLoc.length;i_2++){newLoc[i_2]=loc[perm[i_2]]}var newIndex=result.locToIndex(newLoc);result.values[newIndex]=values[i]}return result.toTensor()};MathBackendCPU.prototype.gather=function(x,indices,axis){this.assertNotComplex([x,indices],"gather");var newShape=x.shape.slice();var indicesValues=indices.dataSync();newShape[axis]=indicesValues.length;var result=ops_1.buffer(newShape,x.dtype);var xBuf=x.buffer();for(var i=0;i<result.size;++i){var newLoc=result.indexToLoc(i);var originalLoc=newLoc.slice();originalLoc[axis]=indicesValues[newLoc[axis]];var originalIndex=xBuf.locToIndex(originalLoc);result.values[i]=xBuf.values[originalIndex]}return result.toTensor()};MathBackendCPU.prototype.batchToSpaceND=function(x,blockShape,crops){this.assertNotComplex([x],"batchToSpaceND");var prod=blockShape.reduce(function(a,b){return a*b});var reshaped=array_ops_util.getReshaped(x.shape,blockShape,prod);var permuted=array_ops_util.getPermuted(reshaped.length,blockShape.length);var reshapedPermuted=array_ops_util.getReshapedPermuted(x.shape,blockShape,prod);var sliceBeginCoords=array_ops_util.getSliceBeginCoords(crops,blockShape.length);var sliceSize=array_ops_util.getSliceSize(reshapedPermuted,crops,blockShape.length);return x.reshape(reshaped).transpose(permuted).reshape(reshapedPermuted).slice(sliceBeginCoords,sliceSize)};MathBackendCPU.prototype.spaceToBatchND=function(x,blockShape,paddings){this.assertNotComplex([x],"spaceToBatchND");var prod=blockShape.reduce(function(a,b){return a*b});var completePaddings=[[0,0]];completePaddings.push.apply(completePaddings,paddings);for(var i=1+blockShape.length;i<x.shape.length;++i){completePaddings.push([0,0])}var paddedX=x.pad(completePaddings);var reshapedPaddedShape=array_ops_util.getReshaped(paddedX.shape,blockShape,prod,false);var permutedReshapedPaddedPermutation=array_ops_util.getPermuted(reshapedPaddedShape.length,blockShape.length,false);var flattenShape=array_ops_util.getReshapedPermuted(paddedX.shape,blockShape,prod,false);return paddedX.reshape(reshapedPaddedShape).transpose(permutedReshapedPaddedPermutation).reshape(flattenShape)};MathBackendCPU.prototype.pool=function(x,convInfo,poolType){this.assertNotComplex(x,"pool");var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var y=ops.buffer(convInfo.outShape,"float32");var padTop=convInfo.padInfo.top;var padLeft=convInfo.padInfo.left;var initialValue=poolType==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;for(var b=0;b<convInfo.batchSize;++b){for(var d=0;d<convInfo.inChannels;++d){for(var yR=0;yR<convInfo.outHeight;++yR){var xRCorner=yR*strideHeight-padTop;var xRMin=Math.max(0,xRCorner);var xRMax=Math.min(convInfo.inHeight,filterHeight+xRCorner);for(var yC=0;yC<convInfo.outWidth;++yC){var xCCorner=yC*strideWidth-padLeft;var xCMin=Math.max(0,xCCorner);var xCMax=Math.min(convInfo.inWidth,filterWidth+xCCorner);var minMaxValue=initialValue;var avgValue=0;var count=0;for(var xR=xRMin;xR<xRMax;++xR){for(var xC=xCMin;xC<xCMax;++xC){var pixel=x.get(b,xR,xC,d);if(poolType==="max"&&pixel>minMaxValue){minMaxValue=pixel}else if(poolType==="avg"){avgValue+=pixel;count++}}if(isNaN(minMaxValue)){break}}y.set(poolType==="avg"?avgValue/count:minMaxValue,b,yR,yC,d)}}}}return y.toTensor()};MathBackendCPU.prototype.maxPool=function(x,convInfo){return this.pool(x,convInfo,"max")};MathBackendCPU.prototype.maxPoolPositions=function(x,convInfo){var maxPositions=ops.buffer(convInfo.outShape,"int32");var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var padTop=convInfo.padInfo.top;var padLeft=convInfo.padInfo.left;for(var b=0;b<convInfo.batchSize;++b){for(var d=0;d<convInfo.inChannels;++d){for(var yR=0;yR<convInfo.outHeight;++yR){var xRCorner=yR*strideHeight-padTop;var xRMin=Math.max(0,xRCorner);var xRMax=Math.min(convInfo.inHeight,filterHeight+xRCorner);for(var yC=0;yC<convInfo.outWidth;++yC){var xCCorner=yC*strideWidth-padLeft;var xCMin=Math.max(0,xCCorner);var xCMax=Math.min(convInfo.inWidth,filterWidth+xCCorner);var maxValue=Number.NEGATIVE_INFINITY;var maxPosition=-1;for(var xR=xRMin;xR<xRMax;++xR){var wR=xR-xRCorner;for(var xC=xCMin;xC<xCMax;++xC){var wC=xC-xCCorner;var pixel=x.get(b,xR,xC,d);if(pixel>maxValue){maxValue=pixel;maxPosition=wR*filterWidth+wC}}}maxPositions.set(maxPosition,b,yR,yC,d)}}}}return maxPositions.toTensor()};MathBackendCPU.prototype.maxPoolBackprop=function(dy,x,y,convInfo){this.assertNotComplex([x,y],"maxPoolBackprop");var maxPositions=this.maxPoolPositions(x,convInfo);var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var padLeft=filterWidth-1-convInfo.padInfo.left;var padTop=filterHeight-1-convInfo.padInfo.top;var dx=ops.buffer(x.shape,"float32");for(var b=0;b<convInfo.batchSize;++b){for(var d=0;d<convInfo.inChannels;++d){for(var dxR=0;dxR<convInfo.inHeight;++dxR){for(var dxC=0;dxC<convInfo.inWidth;++dxC){var dyRCorner=dxR-padTop;var dyCCorner=dxC-padLeft;var dotProd=0;for(var wR=0;wR<filterHeight;++wR){var dyR=(dyRCorner+wR)/strideHeight;if(dyR<0||dyR>=convInfo.outHeight||Math.floor(dyR)!==dyR){continue}for(var wC=0;wC<filterWidth;++wC){var dyC=(dyCCorner+wC)/strideWidth;if(dyC<0||dyC>=convInfo.outWidth||Math.floor(dyC)!==dyC){continue}var maxPos=filterHeight*filterWidth-1-maxPositions.get(b,dyR,dyC,d);var curPos=wR*filterWidth+wC;var mask=maxPos===curPos?1:0;if(mask===0){continue}var pixel=dy.get(b,dyR,dyC,d);dotProd+=pixel*mask}}dx.set(dotProd,b,dxR,dxC,d)}}}}return dx.toTensor()};MathBackendCPU.prototype.avgPoolBackprop=function(dy,x,convInfo){this.assertNotComplex([dy,x],"avgPoolBackprop");var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var padLeft=filterWidth-1-convInfo.padInfo.left;var padTop=filterHeight-1-convInfo.padInfo.top;var dx=ops.buffer(x.shape,"float32");var avgMultiplier=1/(filterHeight*filterWidth);for(var b=0;b<convInfo.batchSize;++b){for(var d=0;d<convInfo.inChannels;++d){for(var dxR=0;dxR<convInfo.inHeight;++dxR){for(var dxC=0;dxC<convInfo.inWidth;++dxC){var dyRCorner=dxR-padTop;var dyCCorner=dxC-padLeft;var dotProd=0;for(var wR=0;wR<filterHeight;++wR){var dyR=(dyRCorner+wR)/strideHeight;if(dyR<0||dyR>=convInfo.outHeight||Math.floor(dyR)!==dyR){continue}for(var wC=0;wC<filterWidth;++wC){var dyC=(dyCCorner+wC)/strideWidth;if(dyC<0||dyC>=convInfo.outWidth||Math.floor(dyC)!==dyC){continue}var pixel=dy.get(b,dyR,dyC,d);dotProd+=pixel}}dx.set(dotProd*avgMultiplier,b,dxR,dxC,d)}}}}return dx.toTensor()};MathBackendCPU.prototype.cast=function(x,dtype){return backend_util.castTensor(x,dtype,this)};MathBackendCPU.prototype.reshape=function(x,shape){return backend_util.reshapeTensor(x,shape)};MathBackendCPU.prototype.avgPool=function(x,convInfo){this.assertNotComplex(x,"avgPool");return this.pool(x,convInfo,"avg").toFloat()};MathBackendCPU.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){this.assertNotComplex(x,"resizeBilinear");var _a=x.shape,batch=_a[0],oldHeight=_a[1],oldWidth=_a[2],numChannels=_a[3];var output=ops.buffer([batch,newHeight,newWidth,numChannels],x.dtype);var effectiveInputSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth];var effectiveOutputSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth];for(var b=0;b<batch;b++){for(var r=0;r<newHeight;r++){for(var c=0;c<newWidth;c++){for(var d=0;d<numChannels;d++){var sourceFracRow=effectiveInputSize[0]*r/effectiveOutputSize[0];var sourceFracCol=effectiveInputSize[1]*c/effectiveOutputSize[1];var sourceRowFloor=Math.floor(sourceFracRow);var sourceRowCeil=Math.min(oldHeight-1,Math.ceil(sourceFracRow));var sourceColFloor=Math.floor(sourceFracCol);var sourceColCeil=Math.min(oldWidth-1,Math.ceil(sourceFracCol));var topLeft=x.get(b,sourceRowFloor,sourceColFloor,d);var bottomLeft=x.get(b,sourceRowCeil,sourceColFloor,d);var topRight=x.get(b,sourceRowFloor,sourceColCeil,d);var bottomRight=x.get(b,sourceRowCeil,sourceColCeil,d);var rowFrac=sourceFracRow-sourceRowFloor;var colFrac=sourceFracCol-sourceColFloor;var top_1=topLeft+(topRight-topLeft)*colFrac;var bottom=bottomLeft+(bottomRight-bottomLeft)*colFrac;var newValue=top_1+(bottom-top_1)*rowFrac;output.set(newValue,b,r,c,d)}}}}return output.toTensor()};MathBackendCPU.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){this.assertNotComplex([dy,x],"resizeBilinearBackprop");var _a=x.shape,batch=_a[0],xHeight=_a[1],xWidth=_a[2],depth=_a[3];var _b=dy.shape,yHeight=_b[1],yWidth=_b[2];var output=ops.buffer([batch,xHeight,xWidth,depth],x.dtype);var effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth];var effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth];var heightScale=effectiveXSize[0]/effectiveYSize[0];var widthScale=effectiveXSize[1]/effectiveYSize[1];for(var b=0;b<batch;b++){for(var r=0;r<yHeight;r++){var dxR=r*heightScale;var topDxRIndex=Math.floor(dxR);var bottomDxRIndex=Math.min(Math.ceil(dxR),xHeight-1);var dxRLerp=dxR-topDxRIndex;var inverseDxRLerp=1-dxRLerp;for(var c=0;c<yWidth;c++){var dxC=c*widthScale;var leftDxCIndex=Math.floor(dxC);var rightDxCIndex=Math.min(Math.ceil(dxC),xWidth-1);var dxCLerp=dxC-leftDxCIndex;var inverseDxCLerp=1-dxCLerp;for(var d=0;d<depth;d++){var dyVal=dy.get(b,r,c,d);var topLeft=output.get(b,topDxRIndex,leftDxCIndex,d);topLeft+=dyVal*inverseDxRLerp*inverseDxCLerp;output.set(topLeft,b,topDxRIndex,leftDxCIndex,d);var topRight=output.get(b,topDxRIndex,rightDxCIndex,d);topRight+=dyVal*inverseDxRLerp*dxCLerp;output.set(topRight,b,topDxRIndex,rightDxCIndex,d);var bottomLeft=output.get(b,bottomDxRIndex,leftDxCIndex,d);bottomLeft+=dyVal*dxRLerp*inverseDxCLerp;output.set(bottomLeft,b,bottomDxRIndex,leftDxCIndex,d);var bottomRight=output.get(b,bottomDxRIndex,rightDxCIndex,d);bottomRight+=dyVal*dxRLerp*dxCLerp;output.set(bottomRight,b,bottomDxRIndex,rightDxCIndex,d)}}}}return output.toTensor()};MathBackendCPU.prototype.resizeNearestNeighbor=function(x,newHeight,newWidth,alignCorners){this.assertNotComplex(x,"resizeNearestNeighbor");var _a=x.shape,batch=_a[0],oldHeight=_a[1],oldWidth=_a[2],numChannels=_a[3];var output=ops.buffer([batch,newHeight,newWidth,numChannels],x.dtype);var effectiveInputSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth];var effectiveOutputSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth];for(var b=0;b<batch;b++){for(var r=0;r<newHeight;r++){for(var c=0;c<newWidth;c++){for(var d=0;d<numChannels;d++){var sourceFracRow=effectiveInputSize[0]*r/effectiveOutputSize[0];var sourceFracCol=effectiveInputSize[1]*c/effectiveOutputSize[1];var sourceNearestRow=Math.min(oldHeight-1,alignCorners?Math.round(sourceFracRow):Math.floor(sourceFracRow));var sourceNearestCol=Math.min(oldWidth-1,alignCorners?Math.round(sourceFracCol):Math.floor(sourceFracCol));var newValue=x.get(b,sourceNearestRow,sourceNearestCol,d);output.set(newValue,b,r,c,d)}}}}return output.toTensor()};MathBackendCPU.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){this.assertNotComplex([dy,x],"resizeNearestNeighborBackprop");var _a=x.shape,batch=_a[0],xHeight=_a[1],xWidth=_a[2],depth=_a[3];var _b=dy.shape,yHeight=_b[1],yWidth=_b[2];var output=ops.buffer([batch,xHeight,xWidth,depth],x.dtype);var effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth];var effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth];var heightScale=effectiveXSize[0]/effectiveYSize[0];var widthScale=effectiveXSize[1]/effectiveYSize[1];var invHeightScale=1/heightScale;var invWidthScale=1/widthScale;var winHeight=Math.ceil(invHeightScale)*2+2;var winWidth=Math.ceil(invWidthScale)*2+2;for(var b=0;b<batch;b++){for(var r=0;r<xHeight;r++){for(var c=0;c<xWidth;c++){var startRLerp=Math.floor(r*invHeightScale);var startDyR=Math.floor(startRLerp-winHeight/2);var startCLerp=Math.floor(c*invWidthScale);var startDyC=Math.floor(startCLerp-winWidth/2);for(var d=0;d<depth;d++){var accum=0;for(var dyROffset=0;dyROffset<winHeight;dyROffset++){var dyR=dyROffset+startDyR;if(dyR<0||dyR>=yHeight){continue}for(var dyCOffSet=0;dyCOffSet<winWidth;dyCOffSet++){var dyC=dyCOffSet+startDyC;if(dyC<0||dyC>=yWidth){continue}var sourceFracRow=effectiveXSize[0]*(dyR/effectiveYSize[0]);var sourceFracCol=effectiveXSize[1]*(dyC/effectiveYSize[1]);var sourceNearestRow=Math.min(xHeight-1,alignCorners?Math.round(sourceFracRow):Math.floor(sourceFracRow));var sourceNearestCol=Math.min(xWidth-1,alignCorners?Math.round(sourceFracCol):Math.floor(sourceFracCol));if(r===sourceNearestRow&&c===sourceNearestCol){accum+=dy.get(b,dyR,dyC,d)}}}output.set(accum,b,r,c,d)}}}}return output.toTensor()};MathBackendCPU.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){this.assertNotComplex([x,mean,variance,scale,offset],"batchNormalization");var xVals=x.dataSync();var mVals=mean.dataSync();var varVals=variance.dataSync();var sVals=scale?scale.dataSync():new Float32Array([1]);var offVals=offset?offset.dataSync():new Float32Array([0]);var outVals=new Float32Array(xVals.length);var offValsLength=offVals.length;var sValsLength=sVals.length;var varValsLength=varVals.length;var mValsLength=mVals.length;var offi=0;var mi=0;var si=0;var vi=0;for(var i=0;i<xVals.length;++i){outVals[i]=offVals[offi++]+(xVals[i]-mVals[mi++])*sVals[si++]/Math.sqrt(varVals[vi++]+varianceEpsilon);if(offi>=offValsLength){offi=0}if(mi>=mValsLength){mi=0}if(si>=sValsLength){si=0}if(vi>=varValsLength){vi=0}}return ops_1.tensor4d(outVals,x.shape)};MathBackendCPU.prototype.localResponseNormalization4D=function(x,depthRadius,bias,alpha,beta){this.assertNotComplex(x,"localResponseNormalization4D");var channels=x.shape[3];var maxD=channels-1;var xValues=x.dataSync();var size=util.sizeFromShape(x.shape);var result=new Float32Array(size);function sumAcrossChannels(offset){var currentChannel=offset%channels;var beginSumOffset=offset-currentChannel+Math.max(0,currentChannel-depthRadius);var endSumOffset=offset-currentChannel+Math.min(currentChannel+depthRadius,maxD);var sum=0;for(;beginSumOffset<=endSumOffset;beginSumOffset++){var z=xValues[beginSumOffset];sum+=z*z}return sum}for(var offset=0;offset<size;offset++){var sum=sumAcrossChannels(offset);var val=xValues[offset]*Math.pow(bias+alpha*sum,-beta);result[offset]=val}return ops.tensor4d(result,x.shape)};MathBackendCPU.prototype.LRNGrad=function(dy,inputImage,outputImage,depthRadius,bias,alpha,beta){this.assertNotComplex(dy,"LRNGrad");var channels=dy.shape[3];var dyValues=dy.dataSync();var inputImageValues=inputImage.dataSync();var outputImageValues=outputImage.dataSync();var result=new Float32Array(util.sizeFromShape(dy.shape));var size=util.sizeFromShape(dy.shape);for(var offset=0;offset<size;offset++){var currentChannel=offset%channels;var depthBegin=offset-currentChannel+Math.max(0,currentChannel-depthRadius);var depthEnd=offset-currentChannel+Math.min(channels,currentChannel+depthRadius+1);var norm=0;for(var k=depthBegin;k<depthEnd;k++){norm+=Math.pow(inputImageValues[k],2)}norm=alpha*norm+bias;for(var k=depthBegin;k<depthEnd;k++){var dyi=-2*alpha*beta*inputImageValues[k]*outputImageValues[offset]/norm;if(offset===k){dyi+=Math.pow(norm,-beta)}dyi*=dyValues[offset];result[k]+=dyi}}return ops.tensor4d(result,dy.shape)};MathBackendCPU.prototype.multinomial=function(logits,normalized,numSamples,seed){this.assertNotComplex(logits,"multinomial");var probabilities=normalized?logits:ops.softmax(logits);var batchSize=probabilities.shape[0];var numEvents=probabilities.shape[1];var res=ops.zeros([batchSize,numSamples],"int32");var resVals=res.dataSync();var probVals=probabilities.dataSync();for(var b=0;b<batchSize;++b){var offset=b*numEvents;var cdf=new Float32Array(numEvents-1);cdf[0]=probVals[offset];for(var event_1=1;event_1<cdf.length;++event_1){cdf[event_1]=cdf[event_1-1]+probVals[offset+event_1]}var random=seedrandom.alea(seed.toString());var outOffset=b*numSamples;for(var sampleId=0;sampleId<numSamples;++sampleId){var r=random();resVals[outOffset+sampleId]=cdf.length;for(var event_2=0;event_2<cdf.length;event_2++){if(r<cdf[event_2]){resVals[outOffset+sampleId]=event_2;break}}}}return res};MathBackendCPU.prototype.oneHot=function(indices,depth,onValue,offValue){this.assertNotComplex(indices,"oneHot");var res=new Float32Array(indices.size*depth);res.fill(offValue);for(var event_3=0;event_3<indices.size;++event_3){if(indices.get(event_3)>=0&&indices.get(event_3)<depth){res[event_3*depth+indices.get(event_3)]=onValue}}return ops.tensor2d(res,[indices.size,depth],"int32")};MathBackendCPU.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){this.assertNotComplex(boxes,"nonMaxSuppression");var boxesVals=boxes.dataSync();var scoresVals=scores.dataSync();return non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold)};MathBackendCPU.prototype.depthToSpace=function(x,blockSize,dataFormat){util.assert(dataFormat==="NHWC","Only NHWC dataFormat supported on CPU for depthToSpace. Got "+dataFormat);util.assert(blockSize>1,"blockSize should be > 1 for depthToSpace, but was: "+blockSize);var batchSize=x.shape[0];var inputHeight=x.shape[1];var inputWidth=x.shape[2];var inputDepth=x.shape[3];var outputHeight=inputHeight*blockSize;var outputWidth=inputWidth*blockSize;var outputDepth=inputDepth/(blockSize*blockSize);var xValues=x.dataSync();var result=new Float32Array(batchSize*outputHeight*outputWidth*outputDepth);var outputIdx=0;for(var b=0;b<batchSize;++b){for(var h=0;h<outputHeight;++h){var inH=Math.floor(h/blockSize);var offsetH=h%blockSize;for(var w=0;w<outputWidth;++w){var inW=Math.floor(w/blockSize);var offsetW=w%blockSize;var offsetD=(offsetH*blockSize+offsetW)*outputDepth;for(var d=0;d<outputDepth;++d){var inD=d+offsetD;var inputIdx=inD+inputDepth*(inW+inputWidth*(inH+inputHeight*b));result[outputIdx++]=xValues[inputIdx]}}}}return ops.tensor4d(result,[batchSize,outputHeight,outputWidth,outputDepth])};MathBackendCPU.prototype.broadcastedBinaryOp=function(a,b,dtype,op){var newShape=broadcast_util.assertAndGetBroadcastShape(a.shape,b.shape);var result=ops.buffer(newShape,dtype);var aVals=a.dataSync();var bVals=b.dataSync();var aBroadcastDims=broadcast_util.getBroadcastDims(a.shape,newShape);var bBroadcastDims=broadcast_util.getBroadcastDims(b.shape,newShape);var resVals=result.values;if(aBroadcastDims.length+bBroadcastDims.length===0){for(var i=0;i<resVals.length;++i){resVals[i]=op(aVals[i%aVals.length],bVals[i%bVals.length])}}else{var aBuf=a.buffer();var bBuf=b.buffer();var _loop_2=function(i){var loc=result.indexToLoc(i);var aLoc=loc.slice(-a.rank);aBroadcastDims.forEach(function(d){return aLoc[d]=0});var aIndex=aBuf.locToIndex(aLoc);var bLoc=loc.slice(-b.rank);bBroadcastDims.forEach(function(d){return bLoc[d]=0});var bIndex=bBuf.locToIndex(bLoc);resVals[i]=op(aVals[aIndex],bVals[bIndex])};for(var i=0;i<resVals.length;++i){_loop_2(i)}}return result.toTensor()};MathBackendCPU.prototype.broadcastedBinaryComplexOp=function(a,b,op){var newShape=broadcast_util.assertAndGetBroadcastShape(a.shape,b.shape);var realResult=ops.buffer(newShape,"float32");var imagResult=ops.buffer(newShape,"float32");var aVals=a.dataSync();var bVals=b.dataSync();var aBroadcastDims=broadcast_util.getBroadcastDims(a.shape,newShape);var bBroadcastDims=broadcast_util.getBroadcastDims(b.shape,newShape);var realVals=realResult.values;var imagVals=imagResult.values;if(aBroadcastDims.length+bBroadcastDims.length===0){for(var i=0;i<realVals.length;i++){var aIdx=i%aVals.length;var bIdx=i%bVals.length;var result=op(aVals[aIdx*2],aVals[aIdx*2+1],bVals[bIdx*2],bVals[bIdx*2+1]);realVals[i]=result.real;imagVals[i]=result.imag}}else{var aRealBuf=this.data.get(a.dataId).complexTensors.real.buffer();var bRealBuf=this.data.get(b.dataId).complexTensors.real.buffer();var _loop_3=function(i){var loc=realResult.indexToLoc(i);var aLoc=loc.slice(-a.rank);aBroadcastDims.forEach(function(d){return aLoc[d]=0});var aIndex=aRealBuf.locToIndex(aLoc);var bLoc=loc.slice(-b.rank);bBroadcastDims.forEach(function(d){return bLoc[d]=0});var bIndex=bRealBuf.locToIndex(bLoc);var opResult=op(aVals[aIndex*2],aVals[aIndex*2+1],bVals[bIndex*2],bVals[bIndex*2+1]);realVals[i]=opResult.real;imagVals[i]=opResult.imag};for(var i=0;i<realVals.length;i++){_loop_3(i)}}return this.complex(realResult.toTensor(),imagResult.toTensor())};MathBackendCPU.prototype.split=function(x,sizeSplits,axis){return split_shared_1.split(x,sizeSplits,axis)};MathBackendCPU.prototype.dispose=function(){};MathBackendCPU.prototype.floatPrecision=function(){return 32};MathBackendCPU.prototype.cropAndResize=function(images,boxes,boxIndex,cropSize,method,extrapolationValue){var _a=images.shape,batch=_a[0],imageHeight=_a[1],imageWidth=_a[2],numChannels=_a[3];var numBoxes=boxes.shape[0];var cropHeight=cropSize[0],cropWidth=cropSize[1];var output=ops.buffer([numBoxes,cropHeight,cropWidth,numChannels]);var boxVals=boxes.dataSync();var boxIndVals=boxIndex.dataSync();var imageVals=images.dataSync();var inStride=images.strides;var outStride=output.strides;for(var b=0;b<numBoxes;b++){var startInd=b*4;var y1=boxVals[startInd];var x1=boxVals[startInd+1];var y2=boxVals[startInd+2];var x2=boxVals[startInd+3];var bInd=boxIndVals[b];if(bInd>=batch){continue}var heightScale=cropHeight>1?(y2-y1)*(imageHeight-1)/(cropHeight-1):0;var widthScale=cropWidth>1?(x2-x1)*(imageWidth-1)/(cropWidth-1):0;for(var y=0;y<cropHeight;y++){var yInd=cropHeight>1?y1*(imageHeight-1)+y*heightScale:.5*(y1+y2)*(imageHeight-1);if(yInd<0||yInd>imageHeight-1){for(var x=0;x<cropWidth;x++){for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}}continue}if(method==="bilinear"){var topInd=Math.floor(yInd);var bottomInd=Math.ceil(yInd);var yLerp=yInd-topInd;for(var x=0;x<cropWidth;x++){var xInd=cropWidth>1?x1*(imageWidth-1)+x*widthScale:.5*(x1+x2)*(imageWidth-1);if(xInd<0||xInd>imageWidth-1){for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}continue}var leftInd=Math.floor(xInd);var rightInd=Math.ceil(xInd);var xLerp=xInd-leftInd;for(var c=0;c<numChannels;c++){var ind=c+leftInd*inStride[2]+topInd*inStride[1]+bInd*inStride[0];var topLeft=imageVals[ind];ind=c+rightInd*inStride[2]+topInd*inStride[1]+bInd*inStride[0];var topRight=imageVals[ind];ind=c+leftInd*inStride[2]+bottomInd*inStride[1]+bInd*inStride[0];var bottomLeft=imageVals[ind];ind=c+rightInd*inStride[2]+bottomInd*inStride[1]+bInd*inStride[0];var bottomRight=imageVals[ind];var top_2=topLeft+(topRight-topLeft)*xLerp;var bottom=bottomLeft+(bottomRight-bottomLeft)*xLerp;ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=top_2+(bottom-top_2)*yLerp}}}else{for(var x=0;x<cropWidth;++x){var xInd=cropWidth>1?x1*(imageWidth-1)+x*widthScale:.5*(x1+x2)*(imageWidth-1);if(xInd<0||xInd>imageWidth-1){for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}continue}var closestX=Math.round(xInd);var closestY=Math.round(yInd);for(var c=0;c<numChannels;c++){var inInd=c+closestX*inStride[2]+closestY*inStride[1]+bInd*inStride[0];var outInd=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[outInd]=imageVals[inInd]}}}}}return output.toTensor()};return MathBackendCPU}();exports.MathBackendCPU=MathBackendCPU;environment_1.ENV.registerBackend("cpu",function(){return new MathBackendCPU},1,tensor_1.setTensorTracker)},{"../environment":51,"../log":124,"../ops/array_ops_util":126,"../ops/axis_util":127,"../ops/broadcast_util":130,"../ops/concat_util":134,"../ops/erf_util":137,"../ops/ops":148,"../ops/selu_util":157,"../ops/slice_util":159,"../tensor":178,"../types":184,"../util":185,"./backend":67,"./backend_util":69,"./complex_util":71,"./non_max_suppression_impl":72,"./split_shared":73,"./topk_impl":74,"./where_impl":123,seedrandom:256}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tensor_ops_1=require("../ops/tensor_ops");var tensor_1=require("../tensor");var util_1=require("../util");function castTensor(x,dtype,backend){if(dtype==="complex64"){if(x.dtype==="complex64"){return x.clone()}var zerosTensor=tensor_ops_1.zeros(x.shape);var floatX=x.toFloat();var result=backend.complex(floatX,zerosTensor);zerosTensor.dispose();floatX.dispose();return result}if(!util_1.hasEncodingLoss(x.dtype,dtype)){return tensor_1.Tensor.make(x.shape,{dataId:x.dataId},dtype)}if(x.dtype==="complex64"){var real=backend.real(x);var result=real.cast(dtype);real.dispose();return result}if(dtype==="int32"){return backend.int(x)}else if(dtype==="bool"){var zero=tensor_ops_1.scalar(0,x.dtype);var result=backend.notEqual(x,zero);zero.dispose();return result}else{throw new Error("Error in Cast: unknown dtype argument ("+dtype+")")}}exports.castTensor=castTensor;function reshapeTensor(x,shape){return tensor_1.Tensor.make(shape,{dataId:x.dataId},x.dtype)}exports.reshapeTensor=reshapeTensor},{"../ops/tensor_ops":162,"../tensor":178,"../util":185}],70:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var environment_1=require("../environment");var globals_1=require("../globals");var log_1=require("../log");var array_ops_util=require("../ops/array_ops_util");var axis_util=require("../ops/axis_util");var concat_util_1=require("../ops/concat_util");var reduce_util=require("../ops/reduce_util");var segment_util=require("../ops/segment_util");var slice_util_1=require("../ops/slice_util");var softmax_1=require("../ops/softmax");var tensor_ops_1=require("../ops/tensor_ops");var tensor_1=require("../tensor");var types_1=require("../types");var util=require("../util");var util_1=require("../util");var backend_1=require("./backend");var backend_util=require("./backend_util");var complex_util_1=require("./complex_util");var non_max_suppression_impl_1=require("./non_max_suppression_impl");var split_shared_1=require("./split_shared");var topk_impl_1=require("./topk_impl");var argminmax_gpu_1=require("./webgl/argminmax_gpu");var avg_pool_backprop_gpu_1=require("./webgl/avg_pool_backprop_gpu");var batchnorm_gpu_1=require("./webgl/batchnorm_gpu");var binaryop_complex_gpu=require("./webgl/binaryop_complex_gpu");var binaryop_complex_gpu_1=require("./webgl/binaryop_complex_gpu");var binaryop_gpu=require("./webgl/binaryop_gpu");var binaryop_gpu_1=require("./webgl/binaryop_gpu");var clip_gpu_1=require("./webgl/clip_gpu");var concat_gpu_1=require("./webgl/concat_gpu");var conv_backprop_gpu_1=require("./webgl/conv_backprop_gpu");var conv_backprop_gpu_depthwise_1=require("./webgl/conv_backprop_gpu_depthwise");var conv_gpu_1=require("./webgl/conv_gpu");var conv_gpu_depthwise_1=require("./webgl/conv_gpu_depthwise");var crop_and_resize_gpu_1=require("./webgl/crop_and_resize_gpu");var cumsum_gpu_1=require("./webgl/cumsum_gpu");var depth_to_space_gpu_1=require("./webgl/depth_to_space_gpu");var encode_float_gpu_1=require("./webgl/encode_float_gpu");var from_pixels_gpu_1=require("./webgl/from_pixels_gpu");var gather_gpu_1=require("./webgl/gather_gpu");var gpgpu_context_1=require("./webgl/gpgpu_context");var gpgpu_math=require("./webgl/gpgpu_math");var gpgpu_util=require("./webgl/gpgpu_util");var lrn_gpu_1=require("./webgl/lrn_gpu");var lrn_grad_gpu_1=require("./webgl/lrn_grad_gpu");var max_pool_backprop_gpu_1=require("./webgl/max_pool_backprop_gpu");var mulmat_gpu_1=require("./webgl/mulmat_gpu");var mulmat_packed_gpu_1=require("./webgl/mulmat_packed_gpu");var multinomial_gpu_1=require("./webgl/multinomial_gpu");var onehot_gpu_1=require("./webgl/onehot_gpu");var pack_gpu_1=require("./webgl/pack_gpu");var pad_gpu_1=require("./webgl/pad_gpu");var pool_gpu_1=require("./webgl/pool_gpu");var reduce_gpu_1=require("./webgl/reduce_gpu");var resize_bilinear_backprop_gpu_1=require("./webgl/resize_bilinear_backprop_gpu");var resize_bilinear_gpu_1=require("./webgl/resize_bilinear_gpu");var resize_nearest_neighbor_backprop_gpu_1=require("./webgl/resize_nearest_neighbor_backprop_gpu");var resize_nearest_neighbor_gpu_1=require("./webgl/resize_nearest_neighbor_gpu");var reverse_gpu_1=require("./webgl/reverse_gpu");var segment_gpu_1=require("./webgl/segment_gpu");var select_gpu_1=require("./webgl/select_gpu");var slice_gpu_1=require("./webgl/slice_gpu");var strided_slice_gpu_1=require("./webgl/strided_slice_gpu");var tex_util_1=require("./webgl/tex_util");var texture_manager_1=require("./webgl/texture_manager");var tile_gpu_1=require("./webgl/tile_gpu");var transpose_gpu_1=require("./webgl/transpose_gpu");var unary_op=require("./webgl/unaryop_gpu");var unaryop_gpu_1=require("./webgl/unaryop_gpu");var unpack_gpu_1=require("./webgl/unpack_gpu");var webgl_util=require("./webgl/webgl_util");var where_impl_1=require("./where_impl");var BEFORE_PAGING_CONSTANT=300;exports.SIZE_UPLOAD_UNIFORM=32;var MathBackendWebGL=function(){function MathBackendWebGL(gpgpu,delayedStorage){if(delayedStorage===void 0){delayedStorage=true}this.gpgpu=gpgpu;this.delayedStorage=delayedStorage;this.pendingRead=new WeakMap;this.pendingDisposal=new WeakSet;this.lruDataGPU=[];this.numBytesInGPU=0;this.uploadWaitMs=0;this.downloadWaitMs=0;this.binaryCache={};this.disposed=false;if(environment_1.ENV.get("WEBGL_VERSION")<1){throw new Error("WebGL is not supported on this device")}if(environment_1.ENV.get("IS_BROWSER")){this.canvas=document.createElement("canvas")}if(gpgpu==null){this.gpgpu=new gpgpu_context_1.GPGPUContext(gpgpu_util.createWebGLContext(this.canvas));this.gpgpuCreatedLocally=true}else{this.gpgpuCreatedLocally=false}if(environment_1.ENV.get("WEBGL_PAGING_ENABLED")){this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*BEFORE_PAGING_CONSTANT}this.textureManager=new texture_manager_1.TextureManager(this.gpgpu)}MathBackendWebGL.prototype.register=function(dataId,shape,dtype){if(this.texData.has(dataId)){throw new Error("Data buffer is already registered")}this.texData.set(dataId,{shape:shape,dtype:dtype,values:null,texture:null,complexTensors:null,texShape:null,usage:tex_util_1.TextureUsage.RENDER})};MathBackendWebGL.prototype.setDataMover=function(dataMover){this.texData=new backend_1.DataStorage(dataMover)};MathBackendWebGL.prototype.fromPixels=function(pixels,numChannels){if(pixels==null){throw new Error("pixels passed to tf.fromPixels() can not be null")}var texShape=[pixels.height,pixels.width];var outShape=[pixels.height,pixels.width,numChannels];if(!(pixels instanceof HTMLVideoElement)&&!(pixels instanceof HTMLImageElement)&&!(pixels instanceof HTMLCanvasElement)&&!(pixels instanceof ImageData)){throw new Error("pixels passed to tf.fromPixels() must be either an "+"HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or "+("ImageData, but was "+pixels.constructor.name))}if(pixels instanceof HTMLVideoElement){if(this.fromPixelsCanvas==null){if(!environment_1.ENV.get("IS_BROWSER")){throw new Error("Can't read pixels from HTMLImageElement outside the browser.")}if(document.readyState!=="complete"){throw new Error("The DOM is not ready yet. Please call tf.fromPixels() "+"once the DOM is ready. One way to do that is to add an event "+"listener for `DOMContentLoaded` on the document object")}this.fromPixelsCanvas=document.createElement("canvas")}this.fromPixelsCanvas.width=pixels.width;this.fromPixelsCanvas.height=pixels.height;this.fromPixelsCanvas.getContext("2d").drawImage(pixels,0,0,pixels.width,pixels.height);pixels=this.fromPixelsCanvas}var tempPixelHandle=this.makeTensorHandle(texShape,"int32");this.texData.get(tempPixelHandle.dataId).usage=tex_util_1.TextureUsage.PIXELS;this.gpgpu.uploadPixelDataToTexture(this.getTexture(tempPixelHandle.dataId),pixels);var program=new from_pixels_gpu_1.FromPixelsProgram(outShape);var res=this.compileAndRun(program,[tempPixelHandle]);this.disposeData(tempPixelHandle.dataId);return res};MathBackendWebGL.prototype.makeTensorHandle=function(shape,dtype){var dataId={};this.register(dataId,shape,dtype);return{dataId:dataId,shape:shape,dtype:dtype}};MathBackendWebGL.prototype.write=function(dataId,values){if(values==null){throw new Error("MathBackendWebGL.write(): values can not be null")}var texData=this.texData.get(dataId);var texture=texData.texture,texShape=texData.texShape,usage=texData.usage,dtype=texData.dtype;if(dtype==="complex64"){throw new Error("Cannot write to a complex64 dtype. "+"Please use tf.complex(real, imag).")}if(texture!=null){this.releaseTexture(dataId,texture,texShape,usage);texData.texture=null;texData.texShape=null}texData.usage=tex_util_1.TextureUsage.UPLOAD;texData.values=values;if(!this.delayedStorage){this.uploadToGPU(dataId)}};MathBackendWebGL.prototype.readSync=function(dataId){var texData=this.texData.get(dataId);var values=texData.values,dtype=texData.dtype,complexTensors=texData.complexTensors;if(values!=null){this.cacheOnCPU(dataId);return values}var shouldTimeProgram=this.activeTimers!=null;var start;if(shouldTimeProgram){start=performance.now()}var result;if(dtype==="complex64"){var realValues=complexTensors.real.dataSync();var imagValues=complexTensors.imag.dataSync();result=complex_util_1.mergeRealAndImagArrays(realValues,imagValues)}else{result=this.getValuesFromTexture(dataId)}if(shouldTimeProgram){this.downloadWaitMs+=performance.now()-start}this.cacheOnCPU(dataId,result);return texData.values};MathBackendWebGL.prototype.read=function(dataId){return __awaiter(this,void 0,void 0,function(){var subscribers_1,texData,texture,values,texShape,bufferOrTexture,vals,subscribers;return __generator(this,function(_a){switch(_a.label){case 0:if(this.pendingRead.has(dataId)){subscribers_1=this.pendingRead.get(dataId);return[2,new Promise(function(resolve){return subscribers_1.push(resolve)})]}texData=this.texData.get(dataId);texture=texData.texture,values=texData.values,texShape=texData.texShape;if(values!=null){this.cacheOnCPU(dataId);return[2,values]}this.pendingRead.set(dataId,[]);if(!environment_1.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&environment_1.ENV.get("WEBGL_VERSION")===2){throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and "+"WEBGL_VERSION=2 not yet supported.")}bufferOrTexture=this.gpgpu.maybeCreateBufferFromTexture(texture,texShape[0],texShape[1]);return[4,this.gpgpu.createAndWaitForFence()];case 1:_a.sent();if(bufferOrTexture instanceof WebGLTexture){vals=this.getValuesFromTexture(dataId)}else{vals=this.gpgpu.downloadFloat32MatrixFromBuffer(bufferOrTexture,texShape[0],texShape[1])}this.cacheOnCPU(dataId,vals);subscribers=this.pendingRead.get(dataId);this.pendingRead.delete(dataId);subscribers.forEach(function(resolve){return resolve(vals)});if(this.pendingDisposal.has(dataId)){this.pendingDisposal.delete(dataId);this.disposeData(dataId)}return[2,vals]}})})};MathBackendWebGL.prototype.getValuesFromTexture=function(dataId){var _a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype,texture=_a.texture,texShape=_a.texShape;if(environment_1.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(dataId).usage===tex_util_1.TextureUsage.PACK){return this.gpgpu.downloadMatrixFromPackedTexture(texture,texShape[0],texShape[1])}else{return this.gpgpu.downloadFloat32MatrixFromOutputTexture(texture,texShape[0],texShape[1])}}var tmpTarget=this.makeTensorHandle(shape,"float32");tmpTarget.size=util_1.sizeFromShape(shape);this.texData.get(tmpTarget.dataId).usage=tex_util_1.TextureUsage.DOWNLOAD;var program=new encode_float_gpu_1.EncodeFloatProgram(shape);var pageToCpu=false;this.compileAndRun(program,[{shape:shape,dtype:dtype,dataId:dataId}],tmpTarget,null,pageToCpu);var tmpData=this.texData.get(tmpTarget.dataId);var vals=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(tmpData.texture,tmpData.texShape[0],tmpData.texShape[1]);this.disposeData(tmpTarget.dataId);return vals};MathBackendWebGL.prototype.time=function(f){return __awaiter(this,void 0,void 0,function(){var oldActiveTimers,newActiveTimers,outerMostTime,flattenedActiveTimers,kernelMs,res;return __generator(this,function(_a){switch(_a.label){case 0:oldActiveTimers=this.activeTimers;newActiveTimers=[];outerMostTime=false;if(this.programTimersStack==null){this.programTimersStack=newActiveTimers;outerMostTime=true}else{this.activeTimers.push(newActiveTimers)}this.activeTimers=newActiveTimers;f();flattenedActiveTimers=util.flatten(this.activeTimers);this.activeTimers=oldActiveTimers;if(outerMostTime){this.programTimersStack=null}return[4,Promise.all(flattenedActiveTimers).then(function(results){var sum=0;results.forEach(function(result){return sum+=result});return sum})];case 1:kernelMs=_a.sent();res={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:kernelMs,wallMs:null};this.uploadWaitMs=0;this.downloadWaitMs=0;return[2,res]}})})};MathBackendWebGL.prototype.memory=function(){return{unreliable:false,numBytesInGPU:this.numBytesInGPU}};MathBackendWebGL.prototype.startTimer=function(){if(environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0){return this.gpgpu.beginQuery()}return{startMs:performance.now(),endMs:null}};MathBackendWebGL.prototype.endTimer=function(query){if(environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0){this.gpgpu.endQuery();return query}query.endMs=performance.now();return query};MathBackendWebGL.prototype.getQueryTime=function(query){return __awaiter(this,void 0,void 0,function(){var timerQuery;return __generator(this,function(_a){if(environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0){return[2,this.gpgpu.waitForQueryAndGetTime(query)]}timerQuery=query;return[2,timerQuery.endMs-timerQuery.startMs]})})};MathBackendWebGL.prototype.disposeData=function(dataId){if(this.pendingDisposal.has(dataId)){return}if(this.pendingRead.has(dataId)){this.pendingDisposal.add(dataId);return}if(this.texData.has(dataId)){var _a=this.texData.get(dataId),texture=_a.texture,texShape=_a.texShape,usage=_a.usage,complexTensors=_a.complexTensors;if(texture!=null){this.releaseTexture(dataId,texture,texShape,usage)}if(complexTensors!=null){complexTensors.real.dispose();complexTensors.imag.dispose()}this.texData.delete(dataId)}};MathBackendWebGL.prototype.getTexture=function(dataId){this.uploadToGPU(dataId);return this.texData.get(dataId).texture};MathBackendWebGL.prototype.getGPGPUContext=function(){return this.gpgpu};MathBackendWebGL.prototype.getCanvas=function(){return this.canvas};MathBackendWebGL.prototype.complex=function(real,imag){var result=this.makeOutputArray(real.shape,"complex64");var resultData=this.texData.get(result.dataId);resultData.complexTensors={real:environment_1.ENV.engine.keep(real.clone()),imag:environment_1.ENV.engine.keep(imag.clone())};return result};MathBackendWebGL.prototype.real=function(input){var resultData=this.texData.get(input.dataId);return resultData.complexTensors.real.clone()};MathBackendWebGL.prototype.imag=function(input){var resultData=this.texData.get(input.dataId);return resultData.complexTensors.imag.clone()};MathBackendWebGL.prototype.slice=function(x,begin,size){var program=new slice_gpu_1.SliceProgram(size);var customSetup=program.getCustomSetupFunc(begin);return this.compileAndRun(program,[x],null,customSetup)};MathBackendWebGL.prototype.stridedSlice=function(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){var _a=slice_util_1.getStridedSlicedInfo(x.shape,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask),beginIndex=_a[0],size=_a[1],shrinkAxis=_a[2];var shape=size.filter(function(v,index){return shrinkAxis.indexOf(index)===-1});if(shape.some(function(axis){return axis===0})){return tensor_ops_1.tensor([],shape)}var program=new strided_slice_gpu_1.StridedSliceProgram(beginIndex,strides,size,shrinkAxis);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.reverse=function(x,axis){var program=new reverse_gpu_1.ReverseProgram(x.shape,axis);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.concat2Tensors=function(a,b,axis){var outShape=concat_util_1.computeOutShape([a.shape,b.shape],axis);var a2D=a.as2D(-1,util_1.sizeFromShape(a.shape.slice(axis)));var b2D=b.as2D(-1,util_1.sizeFromShape(b.shape.slice(axis)));var program=new concat_gpu_1.ConcatProgram(a2D.shape,b2D.shape);var res=this.compileAndRun(program,[a2D,b2D]);return res.reshape(outShape)};MathBackendWebGL.prototype.concat=function(tensors,axis){if(tensors.length===1){return tensors[0]}var result=tensors[0];for(var i=1;i<tensors.length;++i){result=this.concat2Tensors(result,tensors[i],axis)}return result};MathBackendWebGL.prototype.neg=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.NEG);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.batchMatMul=function(a,b,transposeA,transposeB){var outerShapeA=transposeA?a.shape[2]:a.shape[1];var outerShapeB=transposeB?b.shape[1]:b.shape[2];if(environment_1.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")&&a.shape[0]===1&&b.shape[0]===1&&util.arraysEqual(webgl_util.getTextureShapeFromLogicalShape(this.gpgpu.gl,[outerShapeA,outerShapeB]),[outerShapeA,outerShapeB])){var aSqueezed=a.as2D(a.shape[1],a.shape[2]);var bSqueezed=b.as2D(b.shape[1],b.shape[2]);var packProgramA=new pack_gpu_1.PackProgram(aSqueezed.shape);var packedAOutput=tensor_1.Tensor.make(aSqueezed.shape,{});this.texData.get(packedAOutput.dataId).usage=tex_util_1.TextureUsage.PACK;var packedA=this.compileAndRun(packProgramA,[aSqueezed],packedAOutput);var packProgramB=new pack_gpu_1.PackProgram(bSqueezed.shape);var packedBOutput=tensor_1.Tensor.make(bSqueezed.shape,{});this.texData.get(packedBOutput.dataId).usage=tex_util_1.TextureUsage.PACK;var packedB=this.compileAndRun(packProgramB,[bSqueezed],packedBOutput);var program=new mulmat_packed_gpu_1.MatMulPackedProgram(packedA.shape,packedB.shape,[outerShapeA,outerShapeB],transposeA,transposeB);var packedMatMulOutput=tensor_1.Tensor.make(program.outputShape,{});this.texData.get(packedMatMulOutput.dataId).usage=tex_util_1.TextureUsage.PACK;var result=this.compileAndRun(program,[packedA,packedB],packedMatMulOutput);var unpackProgram=new unpack_gpu_1.UnpackProgram(result.shape);var unpacked=this.compileAndRun(unpackProgram,[result]);packedAOutput.dispose();packedBOutput.dispose();packedMatMulOutput.dispose();return unpacked.reshape([1,result.shape[0],result.shape[1]])}else{return this.compileAndRun(new mulmat_gpu_1.MatMulProgram(a.shape,b.shape,transposeA,transposeB),[a,b])}};MathBackendWebGL.prototype.multiply=function(a,b){if(a.dtype==="complex64"){var aData=this.texData.get(a.dataId);var bData=this.texData.get(b.dataId);var realProgram=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.REAL,a.shape,b.shape);var imagProgram=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.IMAG,a.shape,b.shape);var inputs=[this.makeComplexComponentTensorHandle(a,aData.complexTensors.real),this.makeComplexComponentTensorHandle(a,aData.complexTensors.imag),this.makeComplexComponentTensorHandle(b,bData.complexTensors.real),this.makeComplexComponentTensorHandle(b,bData.complexTensors.imag)];var real=this.compileAndRun(realProgram,inputs);var imag=this.compileAndRun(imagProgram,inputs);var complex=this.complex(real,imag);real.dispose();imag.dispose();return complex}var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MUL,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,a.dtype);return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){var inputs=[x,mean,variance];var offsetShape=null;if(offset!=null){offsetShape=offset.shape;inputs.push(offset)}var scaleShape=null;if(scale!=null){scaleShape=scale.shape;inputs.push(scale)}var program=new batchnorm_gpu_1.BatchNormProgram(x.shape,mean.shape,variance.shape,offsetShape,scaleShape,varianceEpsilon);return this.compileAndRun(program,inputs)};MathBackendWebGL.prototype.localResponseNormalization4D=function(x,radius,bias,alpha,beta){var program=new lrn_gpu_1.LRNProgram(x.shape,radius,bias,alpha,beta);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.LRNGrad=function(dy,inputImage,outputImage,depthRadius,bias,alpha,beta){var program=new lrn_grad_gpu_1.LRNGradProgram(inputImage.shape,depthRadius,bias,alpha,beta);return this.compileAndRun(program,[inputImage,outputImage,dy])};MathBackendWebGL.prototype.tile=function(x,reps){var program=new tile_gpu_1.TileProgram(x.shape,reps);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.pad=function(x,paddings,constantValue){var program=new pad_gpu_1.PadProgram(x.shape,paddings,constantValue);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.transpose=function(x,perm){var program=new transpose_gpu_1.TransposeProgram(x.shape,perm);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.gather=function(x,indices,axis){var program=new gather_gpu_1.GatherProgram(x.shape,indices.size,axis);return this.compileAndRun(program,[x,indices])};MathBackendWebGL.prototype.batchToSpaceND=function(x,blockShape,crops){util.assert(x.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var prod=blockShape.reduce(function(a,b){return a*b});var reshaped=array_ops_util.getReshaped(x.shape,blockShape,prod);var permuted=array_ops_util.getPermuted(reshaped.length,blockShape.length);var reshapedPermuted=array_ops_util.getReshapedPermuted(x.shape,blockShape,prod);var sliceBeginCoords=array_ops_util.getSliceBeginCoords(crops,blockShape.length);var sliceSize=array_ops_util.getSliceSize(reshapedPermuted,crops,blockShape.length);return x.reshape(reshaped).transpose(permuted).reshape(reshapedPermuted).slice(sliceBeginCoords,sliceSize)};MathBackendWebGL.prototype.spaceToBatchND=function(x,blockShape,paddings){util.assert(x.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var prod=blockShape.reduce(function(a,b){return a*b});var completePaddings=[[0,0]];completePaddings.push.apply(completePaddings,paddings);for(var i=1+blockShape.length;i<x.shape.length;++i){completePaddings.push([0,0])}var paddedX=x.pad(completePaddings);var reshapedPaddedShape=array_ops_util.getReshaped(paddedX.shape,blockShape,prod,false);var permutedReshapedPaddedPermutation=array_ops_util.getPermuted(reshapedPaddedShape.length,blockShape.length,false);var flattenShape=array_ops_util.getReshapedPermuted(paddedX.shape,blockShape,prod,false);return paddedX.reshape(reshapedPaddedShape).transpose(permutedReshapedPaddedPermutation).reshape(flattenShape)};MathBackendWebGL.prototype.reduce=function(x,reduceType,dtype){var batchSize=x.shape[0];var inSize=x.shape[1];var windowSize=reduce_util.computeOptimalWindowSize(inSize);var reduceInfo={windowSize:windowSize,inSize:inSize,batchSize:batchSize};var program=new reduce_gpu_1.ReduceProgram(reduceInfo,reduceType);var _a=program.outputShape,rows=_a[0],cols=_a[1];var output=this.makeOutputArray([rows,cols],dtype);this.compileAndRun(program,[x],output);if(output.shape[1]===1){return output}return this.reduce(output,reduceType,dtype)};MathBackendWebGL.prototype.argReduce=function(x,reduceType,bestIndicesA){if(bestIndicesA===void 0){bestIndicesA=null}var batchSize=x.shape[0];var inSize=x.shape[1];if(bestIndicesA!=null){batchSize=bestIndicesA.shape[0];inSize=bestIndicesA.shape[1]}var windowSize=reduce_util.computeOptimalWindowSize(inSize);var reduceInfo={windowSize:windowSize,inSize:inSize,batchSize:batchSize};var program=new argminmax_gpu_1.ArgMinMaxProgram(reduceInfo,reduceType,bestIndicesA==null);var _a=program.outputShape,rows=_a[0],cols=_a[1];var output=this.makeOutputArray([rows,cols],"int32");var inputs=[x];if(bestIndicesA!=null){inputs.push(bestIndicesA)}this.compileAndRun(program,inputs,output);if(output.shape[1]===1){return output}return this.argReduce(x,reduceType,output)};MathBackendWebGL.prototype.sum=function(x,axes){axis_util.assertAxesAreInnerMostDims("sum",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var inSize=util.sizeFromShape(reduceShape);var a2D=x.as2D(-1,inSize);var outputDType=types_1.sumOutType(x.dtype);return this.reduce(a2D,"sum",outputDType).reshape(outShape)};MathBackendWebGL.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){var axis=0;var permutation=axis_util.getAxesPermutation([axis],x.rank);var permutedX=x;if(permutation!=null){permutedX=x.transpose(permutation);axis=axis_util.getInnerMostAxes(1,x.rank)[0]}var outShape=segment_util.computeOutShape(permutedX.shape,axis,numSegments);var inSize=util.sizeFromShape([permutedX.shape[axis]]);var a2D=permutedX.as2D(-1,inSize);var outputDType=types_1.sumOutType(x.dtype);var result=this.segOpCompute(a2D,"unsortedSegmentSum",segmentIds,outputDType,numSegments).reshape(outShape);if(permutation!=null){result=result.transpose(axis_util.getUndoAxesPermutation(permutation))}return result};MathBackendWebGL.prototype.segOpCompute=function(x,segOpType,segmentIds,dtype,numSegments){var batchSize=x.shape[0];var inSize=x.shape[1];var windowSize=segment_util.segOpComputeOptimalWindowSize(inSize,numSegments);var segOpInfo={windowSize:windowSize,inSize:inSize,batchSize:batchSize,numSegments:numSegments};var program=new segment_gpu_1.SegmentOpProgram(segOpInfo,segOpType);var _a=program.outputShape,rows=_a[0],cols=_a[1];var output=this.makeOutputArray([rows,cols],dtype);this.compileAndRun(program,[x,segmentIds],output);if(output.shape[1]===numSegments){return output}segmentIds=tensor_ops_1.range(0,numSegments).tile([inSize/windowSize]);return this.segOpCompute(output,segOpType,segmentIds,dtype,numSegments)};MathBackendWebGL.prototype.argMin=function(x,axis){var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMin",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var inSize=util.sizeFromShape(reduceShape);var a2D=x.as2D(-1,inSize);return this.argReduce(a2D,"min").reshape(outShape)};MathBackendWebGL.prototype.argMax=function(x,axis){var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMax",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var inSize=util.sizeFromShape(reduceShape);var a2D=x.as2D(-1,inSize);return this.argReduce(a2D,"max").reshape(outShape)};MathBackendWebGL.prototype.cumsum=function(x,axis,exclusive,reverse){if(axis!==x.rank-1){throw new Error("WebGL cumsum shader expects an inner-most axis="+(x.rank-1)+" "+("but got axis="+axis))}var program=new cumsum_gpu_1.CumSumProgram(x.shape,exclusive,reverse);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.equal=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.EQUAL,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.notEqual=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.NOT_EQUAL,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.less=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.lessEqual=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS_EQUAL,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.greater=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.greaterEqual=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER_EQUAL,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.logicalNot=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOGICAL_NOT);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.logicalAnd=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_AND,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.logicalOr=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_OR,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.select=function(condition,a,b){var program=new select_gpu_1.SelectProgram(condition.rank,a.shape,a.rank);var output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[condition,a,b],output)};MathBackendWebGL.prototype.where=function(condition){log_1.warn("tf.where() in webgl locks the UI thread. "+"Call tf.whereAsync() instead");var condVals=condition.dataSync();return where_impl_1.whereImpl(condition.shape,condVals)};MathBackendWebGL.prototype.topk=function(x,k,sorted){var xVals=x.dataSync();return topk_impl_1.topkImpl(xVals,x.shape,x.dtype,k,sorted)};MathBackendWebGL.prototype.min=function(x,axes){axis_util.assertAxesAreInnerMostDims("min",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var inSize=util.sizeFromShape(reduceShape);var a2D=x.as2D(-1,inSize);return this.reduce(a2D,"min",a2D.dtype).reshape(outShape)};MathBackendWebGL.prototype.minimum=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MIN,a.shape,b.shape);return this.compileAndRun(program,[a,b])};MathBackendWebGL.prototype.mod=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MOD,a.shape,b.shape);var customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[a,b],null,customSetup)};MathBackendWebGL.prototype.max=function(x,axes){axis_util.assertAxesAreInnerMostDims("max",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var inSize=util.sizeFromShape(reduceShape);var a2D=x.as2D(-1,inSize);return this.reduce(a2D,"max",a2D.dtype).reshape(outShape)};MathBackendWebGL.prototype.maximum=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MAX,a.shape,b.shape);return this.compileAndRun(program,[a,b])};MathBackendWebGL.prototype.all=function(x,axes){axis_util.assertAxesAreInnerMostDims("all",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var inSize=util.sizeFromShape(reduceShape);var a2D=x.as2D(-1,inSize);return this.reduce(a2D,"all",a2D.dtype).reshape(outShape)};MathBackendWebGL.prototype.any=function(x,axes){axis_util.assertAxesAreInnerMostDims("any",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1];var inSize=util.sizeFromShape(reduceShape);var a2D=x.as2D(-1,inSize);return this.reduce(a2D,"any",a2D.dtype).reshape(outShape)};MathBackendWebGL.prototype.squaredDifference=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SQUARED_DIFFERENCE,a.shape,b.shape);return this.compileAndRun(program,[a,b])};MathBackendWebGL.prototype.realDivide=function(a,b){var op=binaryop_gpu.DIV;var outputDtype="float32";var program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,outputDtype);return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.floorDiv=function(a,b){var op=binaryop_gpu.INT_DIV;var outputDtype="int32";var program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,outputDtype);return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.add=function(a,b){if(a.dtype==="complex64"&&b.dtype==="complex64"){return this.complexSeparableBinaryOp(a,b,binaryop_gpu.ADD)}var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ADD,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.complexSeparableBinaryOp=function(a,b,op){var _this=this;var aData=this.texData.get(a.dataId);var bData=this.texData.get(b.dataId);var _a=[[aData.complexTensors.real,bData.complexTensors.real],[aData.complexTensors.imag,bData.complexTensors.imag]].map(function(complexParts){var aPart=complexParts[0],bPart=complexParts[1];var program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape);var output=_this.makeOutputArray(program.outputShape,types_1.upcastType(aPart.dtype,bPart.dtype));var aHandle=_this.makeComplexComponentTensorHandle(a,aPart);var bHandle=_this.makeComplexComponentTensorHandle(b,bPart);return _this.compileAndRun(program,[aHandle,bHandle],output)}),real=_a[0],imag=_a[1];var complex=this.complex(real,imag);real.dispose();imag.dispose();return complex};MathBackendWebGL.prototype.makeComplexComponentTensorHandle=function(complexTensor,complexPart){return{dataId:complexPart.dataId,dtype:complexPart.dtype,shape:complexTensor.shape}};MathBackendWebGL.prototype.addN=function(tensors){var res=tensors[0];for(var i=1;i<tensors.length;i++){res=this.add(res,tensors[i])}return res};MathBackendWebGL.prototype.subtract=function(a,b){if(a.dtype==="complex64"&&b.dtype==="complex64"){return this.complexSeparableBinaryOp(a,b,binaryop_gpu.SUB)}var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SUB,a.shape,b.shape);var output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[a,b],output)};MathBackendWebGL.prototype.pow=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.POW,a.shape,b.shape);var customSetup=program.getCustomSetupFunc();var output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[a,b],output,customSetup)};MathBackendWebGL.prototype.ceil=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.CEIL);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.floor=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.FLOOR);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.sign=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIGN);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.round=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ROUND);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.exp=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.EXP);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.expm1=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.EXPM1);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.log=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOG);var customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[x],null,customSetup)};MathBackendWebGL.prototype.log1p=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOG1P);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.sqrt=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SQRT);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.rsqrt=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RSQRT);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.square=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SQUARE);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.reciprocal=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RECIPROCAL);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.relu=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RELU);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.elu=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ELU);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.eluDer=function(dy,y){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ELU_DER,dy.shape,y.shape);return this.compileAndRun(program,[dy,y])};MathBackendWebGL.prototype.selu=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SELU);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.int=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TO_INT);var output=this.makeOutputArray(program.outputShape,"int32");return this.compileAndRun(program,[x],output)};MathBackendWebGL.prototype.clip=function(x,min,max){var program=new clip_gpu_1.ClipProgram(x.shape,min,max);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.abs=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ABS);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.sigmoid=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIGMOID);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.softplus=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SOFTPLUS);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.sin=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIN);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.cos=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.COS);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.tan=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TAN);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.asin=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ASIN);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.acos=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ACOS);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.atan=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ATAN);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.atan2=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ATAN2,a.shape,b.shape);return this.compileAndRun(program,[a,b])};MathBackendWebGL.prototype.sinh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SINH);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.cosh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.COSH);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.tanh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TANH);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.asinh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ASINH);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.acosh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ACOSH);var customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[x],null,customSetup)};MathBackendWebGL.prototype.atanh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ATANH);var customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[x],null,customSetup)};MathBackendWebGL.prototype.erf=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ERF);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.step=function(x,alpha){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.STEP(alpha));return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.conv2d=function(x,filter,convInfo){var program=new conv_gpu_1.Conv2DProgram(convInfo);return this.compileAndRun(program,[x,filter])};MathBackendWebGL.prototype.conv2dDerInput=function(dy,filter,convInfo){var program=new conv_backprop_gpu_1.Conv2DDerInputProgram(convInfo);return this.compileAndRun(program,[dy,filter])};MathBackendWebGL.prototype.conv2dDerFilter=function(x,dy,convInfo){var program=new conv_backprop_gpu_1.Conv2DDerFilterProgram(convInfo);return this.compileAndRun(program,[x,dy])};MathBackendWebGL.prototype.depthwiseConv2D=function(x,filter,convInfo){var program=new conv_gpu_depthwise_1.DepthwiseConv2DProgram(convInfo);return this.compileAndRun(program,[x,filter])};MathBackendWebGL.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){var program=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerInputProgram(convInfo);return this.compileAndRun(program,[dy,filter])};MathBackendWebGL.prototype.depthwiseConv2DDerFilter=function(x,dy,convInfo){var program=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerFilterProgram(convInfo);return this.compileAndRun(program,[x,dy])};MathBackendWebGL.prototype.maxPool=function(x,convInfo){var program=new pool_gpu_1.Pool2DProgram(convInfo,"max",false);var output=this.makeOutputArray(program.outputShape,x.dtype);return this.compileAndRun(program,[x],output)};MathBackendWebGL.prototype.avgPool=function(x,convInfo){var program=new pool_gpu_1.Pool2DProgram(convInfo,"avg",false);var output=this.makeOutputArray(program.outputShape,"float32");return this.compileAndRun(program,[x],output)};MathBackendWebGL.prototype.maxPoolBackprop=function(dy,x,y,convInfo){var getPositions=true;var maxPoolPositionsProgram=new pool_gpu_1.Pool2DProgram(convInfo,"max",getPositions);var maxPoolPositions=this.compileAndRun(maxPoolPositionsProgram,[x]);var maxPoolBackPropProgram=new max_pool_backprop_gpu_1.MaxPool2DBackpropProgram(convInfo);var output=this.makeOutputArray(maxPoolBackPropProgram.outputShape,x.dtype);var result=this.compileAndRun(maxPoolBackPropProgram,[dy,maxPoolPositions],output);maxPoolPositions.dispose();return result};MathBackendWebGL.prototype.avgPoolBackprop=function(dy,x,convInfo){var avgPoolBackpropProgram=new avg_pool_backprop_gpu_1.AvgPool2DBackpropProgram(convInfo);var output=this.makeOutputArray(avgPoolBackpropProgram.outputShape,x.dtype);return this.compileAndRun(avgPoolBackpropProgram,[dy],output)};MathBackendWebGL.prototype.cast=function(x,dtype){return backend_util.castTensor(x,dtype,this)};MathBackendWebGL.prototype.reshape=function(x,shape){return backend_util.reshapeTensor(x,shape)};MathBackendWebGL.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){var program=new resize_bilinear_gpu_1.ResizeBilinearProgram(x.shape,newHeight,newWidth,alignCorners);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){var program=new resize_bilinear_backprop_gpu_1.ResizeBilinearBackpropProgram(dy,x,alignCorners);return this.compileAndRun(program,[dy])};MathBackendWebGL.prototype.resizeNearestNeighbor=function(x,newHeight,newWidth,alignCorners){var program=new resize_nearest_neighbor_gpu_1.ResizeNearestNeighborProgram(x.shape,newHeight,newWidth,alignCorners);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){var program=new resize_nearest_neighbor_backprop_gpu_1.ResizeNearestNeigborBackpropProgram(dy,x,alignCorners);return this.compileAndRun(program,[dy])};MathBackendWebGL.prototype.multinomial=function(logits,normalized,numSamples,seed){var probs=normalized?logits:softmax_1.softmax(logits);var batchSize=probs.shape[0];var numOutcomes=probs.shape[1];var program=new multinomial_gpu_1.MultinomialProgram(batchSize,numOutcomes,numSamples);var output=this.makeOutputArray(program.outputShape,"int32");var customSetup=program.getCustomSetupFunc(seed);return this.compileAndRun(program,[probs],output,customSetup)};MathBackendWebGL.prototype.oneHot=function(indices,depth,onValue,offValue){var program=new onehot_gpu_1.OneHotProgram(indices.size,depth,onValue,offValue);return this.compileAndRun(program,[indices])};MathBackendWebGL.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){log_1.warn("tf.nonMaxSuppression() in webgl locks the UI thread. "+"Call tf.nonMaxSuppressionAsync() instead");var boxesVals=boxes.dataSync();var scoresVals=scores.dataSync();return non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold)};MathBackendWebGL.prototype.cropAndResize=function(image,boxes,boxIndex,cropSize,method,extrapolationValue){var program=new crop_and_resize_gpu_1.CropAndResizeProgram(image.shape,boxes.shape,cropSize,method,extrapolationValue);return this.compileAndRun(program,[image,boxes,boxIndex])};MathBackendWebGL.prototype.depthToSpace=function(x,blockSize,dataFormat){util.assert(blockSize>1,"blockSize should be > 1 for depthToSpace, but was: "+blockSize);var batchSize=x.shape[0];var inputHeight=dataFormat==="NHWC"?x.shape[1]:x.shape[2];var inputWidth=dataFormat==="NHWC"?x.shape[2]:x.shape[3];var inputDepth=dataFormat==="NHWC"?x.shape[3]:x.shape[1];var outputHeight=inputHeight*blockSize;var outputWidth=inputWidth*blockSize;var outputDepth=inputDepth/(blockSize*blockSize);var outputShape=dataFormat==="NHWC"?[batchSize,outputHeight,outputWidth,outputDepth]:[batchSize,outputDepth,outputHeight,outputWidth];var program=new depth_to_space_gpu_1.DepthToSpaceProgram(outputShape,blockSize,dataFormat);return this.compileAndRun(program,[x])};MathBackendWebGL.prototype.split=function(x,sizeSplits,axis){return split_shared_1.split(x,sizeSplits,axis)};MathBackendWebGL.prototype.makeOutputArray=function(shape,dtype){return tensor_1.Tensor.make(shape,{},dtype)};MathBackendWebGL.prototype.compileAndRun=function(program,inputs,output,customSetup,pageToCpu){var _this=this;if(pageToCpu===void 0){pageToCpu=true}if(output==null){output=this.makeOutputArray(program.outputShape,inputs[0].dtype)}if(output.size===0){this.texData.get(output.dataId).values=util_1.getTypedArrayFromDType(output.dtype,0);return output}var inputsData=inputs.map(function(input){if(input.dtype==="complex64"){throw new Error("GPGPUProgram does not support complex64 input. For complex64 "+"dtypes, please separate the program into real and imaginary "+"parts.")}var texData=_this.texData.get(input.dataId);if(texData.texture==null&&util.sizeFromShape(input.shape)<=exports.SIZE_UPLOAD_UNIFORM){return{shape:input.shape,texData:null,isUniform:true,uniformValues:_this.readSync(input.dataId)}}_this.uploadToGPU(input.dataId);return{shape:input.shape,texData:texData,isUniform:false}});this.uploadToGPU(output.dataId);var outputData={shape:output.shape,texData:this.texData.get(output.dataId),isUniform:false};var key=gpgpu_math.makeShaderKey(program,inputsData,outputData);var binary=this.getAndSaveBinary(key,function(){return gpgpu_math.compileProgram(_this.gpgpu,program,inputsData,outputData)});var shouldTimeProgram=this.activeTimers!=null;var query;if(shouldTimeProgram){query=this.startTimer()}gpgpu_math.runProgram(binary,inputsData,outputData,customSetup);if(environment_1.ENV.get("WEBGL_PAGING_ENABLED")&&pageToCpu&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING){var numBytesToPage=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;while(numBytesToPage>0&&this.lruDataGPU.length>0){var dataId=this.lruDataGPU.shift();var _a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype;numBytesToPage-=this.computeBytes(shape,dtype);this.read(dataId)}}if(shouldTimeProgram){query=this.endTimer(query);this.activeTimers.push(this.getQueryTime(query))}return output};MathBackendWebGL.prototype.getAndSaveBinary=function(key,getBinary){if(!(key in this.binaryCache)){this.binaryCache[key]=getBinary()}return this.binaryCache[key]};MathBackendWebGL.prototype.getTextureManager=function(){return this.textureManager};MathBackendWebGL.prototype.dispose=function(){if(this.disposed){return}for(var key in this.binaryCache){this.gpgpu.deleteProgram(this.binaryCache[key].webGLProgram)}this.textureManager.dispose();this.canvas.remove();if(this.fromPixelsCanvas!=null){this.fromPixelsCanvas.remove()}if(this.gpgpuCreatedLocally){this.gpgpu.dispose()}this.disposed=true};MathBackendWebGL.prototype.floatPrecision=function(){var _this=this;return globals_1.tidy(function(){if(_this.abs(tensor_ops_1.scalar(1e-8)).get()>0){return 32}return 16})};MathBackendWebGL.prototype.uploadToGPU=function(dataId){var texData=this.texData.get(dataId);var shape=texData.shape,values=texData.values,texture=texData.texture,dtype=texData.dtype,usage=texData.usage;if(environment_1.ENV.get("WEBGL_PAGING_ENABLED")&&texture!=null){var index=this.lruDataGPU.indexOf(dataId);if(index>=0){this.lruDataGPU.splice(this.lruDataGPU.indexOf(dataId),1);this.lruDataGPU.push(dataId)}return}var shouldTimeProgram=this.activeTimers!=null;var start;if(shouldTimeProgram){start=performance.now()}var texShape=webgl_util.getTextureShapeFromLogicalShape(this.gpgpu.gl,shape);texData.texShape=texShape;var newTexture=this.acquireTexture(dataId,texShape,usage);texData.texture=newTexture;if(values!=null){this.gpgpu.uploadMatrixToTexture(newTexture,texShape[0],texShape[1],typedArrayToFloat32(values,dtype));texData.values=null;if(shouldTimeProgram){this.uploadWaitMs+=performance.now()-start}}};MathBackendWebGL.prototype.cacheOnCPU=function(dataId,float32Values){var dontKeepCopyOnGPU=this.delayedStorage;var texData=this.texData.get(dataId);var texture=texData.texture,texShape=texData.texShape,dtype=texData.dtype,usage=texData.usage;if(dontKeepCopyOnGPU&&texture!=null){this.releaseTexture(dataId,texture,texShape,usage);texData.texture=null;texData.texShape=null}texData.usage=tex_util_1.TextureUsage.UPLOAD;if(float32Values!=null){texData.values=float32ToTypedArray(float32Values,dtype)}};MathBackendWebGL.prototype.releaseTexture=function(dataId,texture,texShape,texType){var _a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype;if(environment_1.ENV.get("WEBGL_PAGING_ENABLED")){var idx=this.lruDataGPU.indexOf(dataId);if(idx>=0){this.lruDataGPU.splice(idx,1)}}this.numBytesInGPU-=this.computeBytes(shape,dtype);this.textureManager.releaseTexture(texture,texShape,texType)};MathBackendWebGL.prototype.acquireTexture=function(dataId,texShape,texType){var _a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype;if(environment_1.ENV.get("WEBGL_PAGING_ENABLED")){this.lruDataGPU.push(dataId)}this.numBytesInGPU+=this.computeBytes(shape,dtype);return this.textureManager.acquireTexture(texShape,texType)};MathBackendWebGL.prototype.computeBytes=function(shape,dtype){return util.sizeFromShape(shape)*util.bytesPerElement(dtype)};return MathBackendWebGL}();exports.MathBackendWebGL=MathBackendWebGL;if(environment_1.ENV.get("IS_BROWSER")){environment_1.ENV.registerBackend("webgl",function(){return new MathBackendWebGL},2,tensor_1.setTensorTracker)}function float32ToTypedArray(a,dtype){if(dtype==="float32"||dtype==="complex64"){return a}else if(dtype==="int32"||dtype==="bool"){var result=dtype==="int32"?new Int32Array(a.length):new Uint8Array(a.length);for(var i=0;i<result.length;++i){result[i]=Math.round(a[i])}return result}else{throw new Error("Unknown dtype "+dtype)}}function typedArrayToFloat32(a,dtype){return a instanceof Float32Array?a:new Float32Array(a)}},{"../environment":51,"../globals":53,"../log":124,"../ops/array_ops_util":126,"../ops/axis_util":127,"../ops/concat_util":134,"../ops/reduce_util":151,"../ops/segment_util":156,"../ops/slice_util":159,"../ops/softmax":160,"../ops/tensor_ops":162,"../tensor":178,"../types":184,"../util":185,"./backend":67,"./backend_util":69,"./complex_util":71,"./non_max_suppression_impl":72,"./split_shared":73,"./topk_impl":74,"./webgl/argminmax_gpu":75,"./webgl/avg_pool_backprop_gpu":76,"./webgl/batchnorm_gpu":77,"./webgl/binaryop_complex_gpu":78,"./webgl/binaryop_gpu":79,"./webgl/clip_gpu":80,"./webgl/concat_gpu":81,"./webgl/conv_backprop_gpu":82,"./webgl/conv_backprop_gpu_depthwise":83,"./webgl/conv_gpu":84,"./webgl/conv_gpu_depthwise":85,"./webgl/crop_and_resize_gpu":86,"./webgl/cumsum_gpu":87,"./webgl/depth_to_space_gpu":88,"./webgl/encode_float_gpu":89,"./webgl/from_pixels_gpu":90,"./webgl/gather_gpu":91,"./webgl/gpgpu_context":92,"./webgl/gpgpu_math":93,"./webgl/gpgpu_util":94,"./webgl/lrn_gpu":95,"./webgl/lrn_grad_gpu":96,"./webgl/max_pool_backprop_gpu":97,"./webgl/mulmat_gpu":98,"./webgl/mulmat_packed_gpu":99,"./webgl/multinomial_gpu":100,"./webgl/onehot_gpu":101,"./webgl/pack_gpu":102,"./webgl/pad_gpu":103,"./webgl/pool_gpu":104,"./webgl/reduce_gpu":105,"./webgl/resize_bilinear_backprop_gpu":106,"./webgl/resize_bilinear_gpu":107,"./webgl/resize_nearest_neighbor_backprop_gpu":108,"./webgl/resize_nearest_neighbor_gpu":109,"./webgl/reverse_gpu":110,"./webgl/segment_gpu":111,"./webgl/select_gpu":112,"./webgl/slice_gpu":114,"./webgl/strided_slice_gpu":115,"./webgl/tex_util":116,"./webgl/texture_manager":117,"./webgl/tile_gpu":118,"./webgl/transpose_gpu":119,"./webgl/unaryop_gpu":120,"./webgl/unpack_gpu":121,"./webgl/webgl_util":122,"./where_impl":123}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function mergeRealAndImagArrays(real,imag){if(real.length!==imag.length){throw new Error("Cannot merge real and imag arrays of different lengths. real:"+(real.length+", imag: "+imag.length+"."))}var result=new Float32Array(real.length*2);for(var i=0;i<result.length;i+=2){result[i]=real[i/2];result[i+1]=imag[i/2]}return result}exports.mergeRealAndImagArrays=mergeRealAndImagArrays;function splitRealAndImagArrays(complex){var real=new Float32Array(complex.length/2);var imag=new Float32Array(complex.length/2);for(var i=0;i<complex.length;i+=2){real[i/2]=complex[i];imag[i/2]=complex[i+1]}return{real:real,imag:imag}}exports.splitRealAndImagArrays=splitRealAndImagArrays},{}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tensor_ops_1=require("../ops/tensor_ops");function nonMaxSuppressionImpl(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){var candidates=Array.from(scores).map(function(score,boxIndex){return{score:score,boxIndex:boxIndex}}).filter(function(c){return c.score>scoreThreshold}).sort(function(c1,c2){return c2.score-c1.score});var selected=[];for(var i=0;i<candidates.length;i++){var _a=candidates[i],score=_a.score,boxIndex=_a.boxIndex;if(score<scoreThreshold){break}var ignoreCandidate=false;for(var j=selected.length-1;j>=0;--j){var iou=intersectionOverUnion(boxes,boxIndex,selected[j]);if(iou>=iouThreshold){ignoreCandidate=true;break}}if(!ignoreCandidate){selected.push(boxIndex);if(selected.length>=maxOutputSize){break}}}return tensor_ops_1.tensor1d(selected,"int32")}exports.nonMaxSuppressionImpl=nonMaxSuppressionImpl;function intersectionOverUnion(boxes,i,j){var iCoord=boxes.subarray(i*4,i*4+4);var jCoord=boxes.subarray(j*4,j*4+4);var yminI=Math.min(iCoord[0],iCoord[2]);var xminI=Math.min(iCoord[1],iCoord[3]);var ymaxI=Math.max(iCoord[0],iCoord[2]);var xmaxI=Math.max(iCoord[1],iCoord[3]);var yminJ=Math.min(jCoord[0],jCoord[2]);var xminJ=Math.min(jCoord[1],jCoord[3]);var ymaxJ=Math.max(jCoord[0],jCoord[2]);var xmaxJ=Math.max(jCoord[1],jCoord[3]);var areaI=(ymaxI-yminI)*(xmaxI-xminI);var areaJ=(ymaxJ-yminJ)*(xmaxJ-xminJ);if(areaI<=0||areaJ<=0){return 0}var intersectionYmin=Math.max(yminI,yminJ);var intersectionXmin=Math.max(xminI,xminJ);var intersectionYmax=Math.min(ymaxI,ymaxJ);var intersectionXmax=Math.min(xmaxI,xmaxJ);var intersectionArea=Math.max(intersectionYmax-intersectionYmin,0)*Math.max(intersectionXmax-intersectionXmin,0);return intersectionArea/(areaI+areaJ-intersectionArea)}},{"../ops/tensor_ops":162}],73:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function split(x,sizeSplits,axis){var begin=Array(x.rank).fill(0);var size=x.shape.slice();return sizeSplits.map(function(s){size[axis]=s;var slice=x.slice(begin,size);begin[axis]+=s;return slice})}exports.split=split},{}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tensor_ops_1=require("../ops/tensor_ops");var util_1=require("../util");function topkImpl(x,xShape,xDtype,k,sorted){var lastDim=xShape[xShape.length-1];var _a=[x.length/lastDim,lastDim],batch=_a[0],size=_a[1];var allTopKVals=util_1.getTypedArrayFromDType(xDtype,batch*k);var allTopKIndices=util_1.getTypedArrayFromDType("int32",batch*k);for(var b=0;b<batch;b++){var offset=b*size;var vals=x.subarray(offset,offset+size);var valAndInd=[];for(var i=0;i<vals.length;i++){valAndInd.push({value:vals[i],index:i})}valAndInd.sort(function(a,b){return b.value-a.value});var outOffset=b*k;var topKVals=allTopKVals.subarray(outOffset,outOffset+k);var topKIndices=allTopKIndices.subarray(outOffset,outOffset+k);for(var i=0;i<k;i++){topKVals[i]=valAndInd[i].value;topKIndices[i]=valAndInd[i].index}}var outputShape=xShape.slice();outputShape[outputShape.length-1]=k;return[tensor_ops_1.tensor(allTopKVals,outputShape,xDtype),tensor_ops_1.tensor(allTopKIndices,outputShape,"int32")]}exports.topkImpl=topkImpl},{"../ops/tensor_ops":162,"../util":185}],75:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ArgMinMaxProgram=function(){function ArgMinMaxProgram(reduceInfo,op,firstPass){this.variableNames=["A"];var windowSize=reduceInfo.windowSize;var batchSize=reduceInfo.batchSize;var inSize=reduceInfo.inSize;var outSize=Math.ceil(inSize/windowSize);if(!firstPass){this.variableNames.push("bestIndicesA")}this.outputShape=[batchSize,outSize];var compOp=op==="max"?">":"<";var indexSnippet=firstPass?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+windowSize+";\n\n        int bestIndex = 0;\n        float bestValue = getA(batch, inOffset);\n\n        for (int i = 0; i < "+windowSize+"; i++) {\n          int inIdx = "+indexSnippet+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+compOp+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}return ArgMinMaxProgram}();exports.ArgMinMaxProgram=ArgMinMaxProgram},{}],76:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var AvgPool2DBackpropProgram=function(){function AvgPool2DBackpropProgram(convInfo){this.variableNames=["dy"];this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var padTop=filterHeight-1-convInfo.padInfo.top;var padLeft=filterWidth-1-convInfo.padInfo.left;var avgMultiplier=1/(filterHeight*filterWidth);this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n      const float avgMultiplier = float("+avgMultiplier+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return AvgPool2DBackpropProgram}();exports.AvgPool2DBackpropProgram=AvgPool2DBackpropProgram},{}],77:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var broadcast_util=require("../../ops/broadcast_util");var BatchNormProgram=function(){function BatchNormProgram(xShape,meanShape,varianceShape,offsetShape,scaleShape,varianceEpsilon){this.outputShape=[];this.supportsBroadcasting=true;this.variableNames=["x","mean","variance"];broadcast_util.assertAndGetBroadcastShape(xShape,meanShape);broadcast_util.assertAndGetBroadcastShape(xShape,varianceShape);var offsetSnippet="0.0";if(offsetShape!=null){broadcast_util.assertAndGetBroadcastShape(xShape,offsetShape);this.variableNames.push("offset");offsetSnippet="getOffsetAtOutCoords()"}var scaleSnippet="1.0";if(scaleShape!=null){broadcast_util.assertAndGetBroadcastShape(xShape,scaleShape);this.variableNames.push("scale");scaleSnippet="getScaleAtOutCoords()"}this.outputShape=xShape;this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+offsetSnippet+";\n        float scale = "+scaleSnippet+";\n        float inv = scale * inversesqrt(variance + float("+varianceEpsilon+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "}return BatchNormProgram}();exports.BatchNormProgram=BatchNormProgram},{"../../ops/broadcast_util":130}],78:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var broadcast_util=require("../../ops/broadcast_util");exports.COMPLEX_MULTIPLY={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};var BinaryOpComplexProgram=function(){function BinaryOpComplexProgram(op,aShape,bShape){this.variableNames=["AReal","AImag","BReal","BImag"];this.supportsBroadcasting=true;this.outputShape=broadcast_util.assertAndGetBroadcastShape(aShape,bShape);this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+op+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "}return BinaryOpComplexProgram}();exports.BinaryOpComplexProgram=BinaryOpComplexProgram},{"../../ops/broadcast_util":130}],79:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var broadcast_util=require("../../ops/broadcast_util");var CHECK_NAN_SNIPPET="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";exports.ADD="return a + b;";exports.SUB="return a - b;";exports.MUL="return a * b;";exports.DIV="if (a == b) return 1.0;\n  return a / b;";exports.INT_DIV="\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n";exports.POW="\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n";exports.SQUARED_DIFFERENCE="return (a - b) * (a - b);";exports.EQUAL="return float(a == b);";exports.NOT_EQUAL="return float(a != b);";exports.LESS="return float(a < b);";exports.LESS_EQUAL="return float(a <= b);";exports.GREATER="return float(a > b);";exports.GREATER_EQUAL="return float(a >= b);";exports.LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);";exports.LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);";exports.MAX=CHECK_NAN_SNIPPET+"\n  return max(a, b);\n";exports.MIN=CHECK_NAN_SNIPPET+"\n  return min(a, b);\n";exports.MOD="if (b == 0.0) return NAN;\n  return mod(a, b);";exports.ATAN2=CHECK_NAN_SNIPPET+"\n  return atan(a, b);\n";exports.ELU_DER="return (b >= 1.0) ? a : a * (b + 1.0);";var BinaryOpProgram=function(){function BinaryOpProgram(op,aShape,bShape){this.variableNames=["A","B"];this.supportsBroadcasting=true;this.outputShape=broadcast_util.assertAndGetBroadcastShape(aShape,bShape);this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+op+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}BinaryOpProgram.prototype.getCustomSetupFunc=function(){var _this=this;return function(gpgpu,webGLProgram){if(_this.startLoc==null){_this.startLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"NAN");if(_this.startLoc==null){return}}gpgpu.gl.uniform1f(_this.startLoc,NaN)}};return BinaryOpProgram}();exports.BinaryOpProgram=BinaryOpProgram},{"../../ops/broadcast_util":130}],80:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ClipProgram=function(){function ClipProgram(aShape,min,max){this.variableNames=["A"];this.outputShape=aShape;this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, float("+min+"), float("+max+")));\n      }\n    "}return ClipProgram}();exports.ClipProgram=ClipProgram},{}],81:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var concat_util=require("../../ops/concat_util");var ConcatProgram=function(){function ConcatProgram(aShape,bShape){this.variableNames=["A","B"];this.outputShape=[];this.outputShape=concat_util.computeOutShape([aShape,bShape],1);this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+aShape[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+aShape[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "}return ConcatProgram}();exports.ConcatProgram=ConcatProgram},{"../../ops/concat_util":134}],82:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Conv2DDerFilterProgram=function(){function Conv2DDerFilterProgram(convInfo){this.variableNames=["x","dy"];this.outputShape=convInfo.filterShape;var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var padTop=convInfo.padInfo.top;var padLeft=convInfo.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+convInfo.batchSize+"; b++) {\n          for (int yR = 0; yR < "+convInfo.outHeight+"; yR++) {\n            int xR = wR + yR * "+strideHeight+" - "+padTop+";\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+convInfo.outWidth+"; yC++) {\n              int xC = wC + yC * "+strideWidth+" - "+padLeft+";\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DDerFilterProgram}();exports.Conv2DDerFilterProgram=Conv2DDerFilterProgram;var Conv2DDerInputProgram=function(){function Conv2DDerInputProgram(convInfo){this.variableNames=["dy","W"];this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var padTop=filterHeight-1-convInfo.padInfo.top;var padLeft=filterWidth-1-convInfo.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+filterHeight+" - 1 - wR;\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+filterWidth+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+convInfo.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DDerInputProgram}();exports.Conv2DDerInputProgram=Conv2DDerInputProgram},{}],83:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DepthwiseConv2DDerFilterProgram=function(){function DepthwiseConv2DDerFilterProgram(convInfo){this.variableNames=["x","dy"];this.outputShape=convInfo.filterShape;var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var padTop=convInfo.padInfo.top;var padLeft=convInfo.padInfo.left;var channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+channelMul+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+convInfo.batchSize+"; b++) {\n          for (int yR = 0; yR < "+convInfo.outHeight+"; yR++) {\n            int xR = wR + yR * "+strideHeight+" - "+padTop+";\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+convInfo.outWidth+"; yC++) {\n              int xC = wC + yC * "+strideWidth+" - "+padLeft+";\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DDerFilterProgram}();exports.DepthwiseConv2DDerFilterProgram=DepthwiseConv2DDerFilterProgram;var DepthwiseConv2DDerInputProgram=function(){function DepthwiseConv2DDerInputProgram(convInfo){this.variableNames=["dy","W"];this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var padTop=filterHeight-1-convInfo.padInfo.top;var padLeft=filterWidth-1-convInfo.padInfo.left;var channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+filterHeight+" - 1 - wR;\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+filterWidth+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+channelMul+"; dm++) {\n              int d2 = d1 * "+channelMul+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DDerInputProgram}();exports.DepthwiseConv2DDerInputProgram=DepthwiseConv2DDerInputProgram},{}],84:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Conv2DProgram=function(){function Conv2DProgram(convInfo){this.variableNames=["x","W"];this.outputShape=convInfo.outShape;var padTop=convInfo.padInfo.top;var padLeft=convInfo.padInfo.left;var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var dilationHeight=convInfo.dilationHeight;var dilationWidth=convInfo.dilationWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var inputDepthNearestVec4=Math.floor(convInfo.inChannels/4)*4;var inputDepthVec4Remainder=convInfo.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+dilationHeight+";\n\n          if (xR < 0 || xR >= "+convInfo.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            if (xC < 0 || xC >= "+convInfo.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+inputDepthNearestVec4+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(inputDepthVec4Remainder===1)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+inputDepthNearestVec4+") *\n                getW(wR, wC, "+inputDepthNearestVec4+", d2);\n            } else if ("+(inputDepthVec4Remainder===2)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+inputDepthNearestVec4+"),\n                getX(batch, xR, xC, "+inputDepthNearestVec4+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+inputDepthNearestVec4+", d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(inputDepthVec4Remainder===3)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+inputDepthNearestVec4+"),\n                getX(batch, xR, xC, "+inputDepthNearestVec4+" + 1),\n                getX(batch, xR, xC, "+inputDepthNearestVec4+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+inputDepthNearestVec4+", d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 1, d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DProgram}();exports.Conv2DProgram=Conv2DProgram},{}],85:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DepthwiseConv2DProgram=function(){function DepthwiseConv2DProgram(convInfo){this.variableNames=["x","W"];this.outputShape=convInfo.outShape;var xNumRows=convInfo.inHeight;var xNumCols=convInfo.inWidth;var padTop=convInfo.padInfo.top;var padLeft=convInfo.padInfo.left;var strideHeight=convInfo.strideHeight;var strideWidth=convInfo.strideWidth;var dilationHeight=convInfo.dilationHeight;var dilationWidth=convInfo.dilationWidth;var filterHeight=convInfo.filterHeight;var filterWidth=convInfo.filterWidth;var channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+channelMul+";\n        int q = d2 - d1 * "+channelMul+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+dilationHeight+";\n\n          if (xR < 0 || xR >= "+xNumRows+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            if (xC < 0 || xC >= "+xNumCols+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DProgram}();exports.DepthwiseConv2DProgram=DepthwiseConv2DProgram},{}],86:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CropAndResizeProgram=function(){function CropAndResizeProgram(imageShape,boxShape,cropSize,method,extrapolationValue){this.variableNames=["Image","Boxes","BoxInd"];this.outputShape=[];var batch=imageShape[0],imageHeight=imageShape[1],imageWidth=imageShape[2],depth=imageShape[3];var numBoxes=boxShape[0];var cropHeight=cropSize[0],cropWidth=cropSize[1];this.outputShape=[numBoxes,cropHeight,cropWidth,depth];var methodId=method==="bilinear"?1:0;var _a=[imageHeight-1+".0",imageWidth-1+".0"],inputHeightFloat=_a[0],inputWidthFloat=_a[1];var _b=cropHeight>1?[""+(imageHeight-1)/(cropHeight-1),"(y2-y1) * height_ratio","y1*"+inputHeightFloat+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+inputHeightFloat],heightRatio=_b[0],heightScale=_b[1],inY=_b[2];var _c=cropWidth>1?[""+(imageWidth-1)/(cropWidth-1),"(x2-x1) * width_ratio","x1*"+inputWidthFloat+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+inputWidthFloat],widthRatio=_c[0],widthScale=_c[1],inX=_c[2];this.userCode="\n      const float height_ratio = float("+heightRatio+");\n      const float width_ratio = float("+widthRatio+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+batch+") {\n          return;\n        }\n\n        float height_scale = "+heightScale+";\n        float width_scale = "+widthScale+";\n\n        float in_y = "+inY+";\n        if( in_y < 0.0 || in_y > "+inputHeightFloat+" ) {\n          setOutput(float("+extrapolationValue+"));\n          return;\n        }\n        float in_x = "+inX+";\n        if( in_x < 0.0 || in_x > "+inputWidthFloat+" ) {\n          setOutput(float("+extrapolationValue+"));\n          return;\n        }\n\n        vec2 sourceFracIndexRC = vec2(in_y,in_x);\n        if("+methodId+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));\n\n          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n          float top = topLeft + (topRight - topLeft) * fracRC.y;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          float newValue = top + (bottom - top) * fracRC.x;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestRC = ivec2(floor(\n            sourceFracIndexRC + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);\n          setOutput(newValue);\n        }\n      }\n    "}return CropAndResizeProgram}();exports.CropAndResizeProgram=CropAndResizeProgram},{}],87:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var shader_compiler_1=require("./shader_compiler");var CumSumProgram=function(){function CumSumProgram(shape,exclusive,reverse){this.variableNames=["x"];this.outputShape=shape;var rank=shape.length;var finalDim=shape[shape.length-1];var comparator=reverse?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(reverse?"return "+finalDim+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+shader_compiler_1.getCoordsDataType(rank)+" coords = getOutputCoords();\n        int end = "+getFinalCoord(rank,"coords")+";\n        float val = 0.0;\n        for (int i = "+finalDim+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+comparator+" end) {\n            continue;\n          }\n          if (idx == end && "+exclusive+") {\n            continue;\n          }\n          "+getFinalCoord(rank,"coords")+" = idx;\n          val += getX("+getCoords(rank,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}return CumSumProgram}();exports.CumSumProgram=CumSumProgram;function getCoords(rank,name){if(rank===1){return""+name}else if(rank===2){return name+".x, "+name+".y"}else if(rank===3){return name+".x, "+name+".y, "+name+".z"}else if(rank===4){return name+".x, "+name+".y, "+name+".z, "+name+".w"}else{throw Error("Cumulative sum for rank "+rank+" is not yet supported")}}function getFinalCoord(rank,name){if(rank===1){return""+name}else if(rank===2){return name+".y"}else if(rank===3){return name+".z"}else if(rank===4){return name+".w"}else{throw Error("Cumulative sum for rank "+rank+" is not yet supported")}}},{"./shader_compiler":113}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DepthToSpaceProgram=function(){function DepthToSpaceProgram(outputShape,blockSize,dataFormat){this.variableNames=["x"];this.outputShape=[];this.outputShape=outputShape;this.blockSize=blockSize;this.dataFormat=dataFormat;this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+blockSize+";\n      int offset_h = imod(h, "+blockSize+");\n      int in_w = w / "+blockSize+";\n      int offset_w = imod(w, "+blockSize+");\n      int offset_d = (offset_h * "+blockSize+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}DepthToSpaceProgram.prototype.getHeightCoordString=function(){if(this.dataFormat==="NHWC"){return"coords[1]"}else{return"coords[2]"}};DepthToSpaceProgram.prototype.getWidthCoordString=function(){if(this.dataFormat==="NHWC"){return"coords[2]"}else{return"coords[3]"}};DepthToSpaceProgram.prototype.getDepthCoordString=function(){if(this.dataFormat==="NHWC"){return"coords[3]"}else{return"coords[1]"}};DepthToSpaceProgram.prototype.getOutputDepthSize=function(){if(this.dataFormat==="NHWC"){return this.outputShape[3]}else{return this.outputShape[1]}};DepthToSpaceProgram.prototype.getInputSamplingString=function(){if(this.dataFormat==="NHWC"){return"getX(b, in_h, in_w, in_d)"}else{return"getX(b, in_d, in_h, in_w)"}};return DepthToSpaceProgram}();exports.DepthToSpaceProgram=DepthToSpaceProgram},{}],89:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var EncodeFloatProgram=function(){function EncodeFloatProgram(outputShape){this.variableNames=["A"];this.outputShape=outputShape;this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        gl_FragColor = encode_float(x);\n      }\n    "}return EncodeFloatProgram}();exports.EncodeFloatProgram=EncodeFloatProgram},{}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var FromPixelsProgram=function(){function FromPixelsProgram(outputShape){this.variableNames=["A"];var height=outputShape[0],width=outputShape[1];this.outputShape=outputShape;this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+width+".0, "+height+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}return FromPixelsProgram}();exports.FromPixelsProgram=FromPixelsProgram},{}],91:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var shader_compiler_1=require("./shader_compiler");var GatherProgram=function(){function GatherProgram(aShape,indicesLength,axis){this.variableNames=["A","indices"];var outputShape=aShape.slice();outputShape[axis]=indicesLength;this.outputShape=outputShape;this.rank=outputShape.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank);var sourceCoords=getSourceCoords(aShape,axis);this.userCode="\n      void main() {\n        "+dtype+" resRC = getOutputCoords();\n        setOutput(getA("+sourceCoords+"));\n      }\n    "}return GatherProgram}();exports.GatherProgram=GatherProgram;function getSourceCoords(aShape,axis){var rank=aShape.length;if(rank>4){throw Error("Gather for rank "+rank+" is not yet supported")}if(rank===1){return"int(getIndices(resRC))"}var currentCoords=["resRC.x","resRC.y","resRC.z","resRC.w"];var sourceCoords=[];for(var i=0;i<aShape.length;i++){if(i===axis){sourceCoords.push("int(getIndices("+currentCoords[i]+"))")}else{sourceCoords.push(""+currentCoords[i])}}return sourceCoords.join()}},{"./shader_compiler":113}],92:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var environment_1=require("../../environment");var util=require("../../util");var gpgpu_util=require("./gpgpu_util");var tex_util=require("./tex_util");var webgl_util=require("./webgl_util");var GPGPUContext=function(){function GPGPUContext(gl){this.outputTexture=null;this.program=null;this.disposed=false;this.autoDebugValidate=false;this.vertexAttrsAreBound=false;this.itemsToPoll=[];if(gl!=null){this.gl=gl}else{this.gl=gpgpu_util.createWebGLContext()}if(environment_1.ENV.get("WEBGL_VERSION")===1){this.textureFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"OES_texture_float");this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float");if(!environment_1.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")){this.textureHalfFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"OES_texture_half_float");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}}else{this.colorBufferFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"EXT_color_buffer_float")}this.loseContextExtension=webgl_util.getExtensionOrThrow(this.gl,"WEBGL_lose_context");this.vertexBuffer=gpgpu_util.createVertexBuffer(this.gl);this.indexBuffer=gpgpu_util.createIndexBuffer(this.gl);this.framebuffer=webgl_util.createFramebuffer(this.gl);this.textureConfig=gpgpu_util.getTextureConfig(this.gl,this.textureHalfFloatExtension)}GPGPUContext.prototype.dispose=function(){var _this=this;if(this.disposed){return}if(this.program!=null){console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram."+" This is probably a resource leak, delete the program with "+"GPGPUContext.deleteProgram before disposing.")}if(this.outputTexture!=null){console.warn("Disposing a GPGPUContext that still has a bound output matrix "+"texture.  This is probably a resource leak, delete the output "+"matrix texture with GPGPUContext.deleteMatrixTexture before "+"disposing.")}var gl=this.gl;webgl_util.callAndCheck(gl,function(){return gl.finish()});webgl_util.callAndCheck(gl,function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,null)});webgl_util.callAndCheck(gl,function(){return gl.deleteFramebuffer(_this.framebuffer)});webgl_util.callAndCheck(gl,function(){return gl.bindBuffer(gl.ARRAY_BUFFER,null)});webgl_util.callAndCheck(gl,function(){return gl.deleteBuffer(_this.vertexBuffer)});webgl_util.callAndCheck(gl,function(){return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)});webgl_util.callAndCheck(gl,function(){return gl.deleteBuffer(_this.indexBuffer)});this.loseContextExtension.loseContext();this.disposed=true};GPGPUContext.prototype.enableAutomaticDebugValidation=function(enabled){this.autoDebugValidate=enabled;webgl_util.enableDebugWebGLErrorChecking(enabled)};GPGPUContext.prototype.createFloat32MatrixTexture=function(rows,columns){this.throwIfDisposed();return gpgpu_util.createFloat32MatrixTexture(this.gl,rows,co